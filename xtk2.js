/*
 * 
 *                  xxxxxxx      xxxxxxx
 *                   x:::::x    x:::::x 
 *                    x:::::x  x:::::x  
 *                     x:::::xx:::::x   
 *                      x::::::::::x    
 *                       x::::::::x     
 *                       x::::::::x     
 *                      x::::::::::x    
 *                     x:::::xx:::::x   
 *                    x:::::x  x:::::x  
 *                   x:::::x    x:::::x 
 *              THE xxxxxxx      xxxxxxx TOOLKIT
 *                    
 *                  http://www.goXTK.com
 *                   
 * Copyright (c) 2012 The X Toolkit Developers <dev@goXTK.com>
 *                   
 *    The X Toolkit (XTK) is licensed under the MIT License:
 *      http://www.opensource.org/licenses/mit-license.php
 * 
 *      "Free software" is a matter of liberty, not price.
 *      "Free" as in "free speech", not as in "free beer".
 *                                         - Richard M. Stallman
 * 
 * FUELED BY:
 *  - the wonderful Constructive Solid Geometry library by Evan Wallace (http://madebyevan.com)
 *    LICENSE: https://raw.github.com/xtk/X/master/lib/csg/LICENSE
 *
 *  - parts of the Google Closure Library (http://code.google.com/closure/library)
 *    LICENSE: https://raw.github.com/xtk/google-closure-library/master/LICENSE
 *
 *  - zlib.js, the ultimate gzip/zlib javascript implementation (https://github.com/imaya/zlib.js)
 *    LICENSE: https://raw.github.com/imaya/zlib.js/master/LICENSE
 *
 * MORE CREDITS: https://raw.github.com/xtk/X/master/LICENSE
 *
 */
function m(a){throw a;}var p=void 0,q=!0,s=null,t=!1;function ba(){return function(){}}function ca(a){return function(b){this[a]=b}}function u(a){return function(){return this[a]}}var v,fa=this;function ga(){}
function ha(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ia(a){return a!==p}function ja(a){return"array"==ha(a)}function la(a){var b=ha(a);return"array"==b||"object"==b&&"number"==typeof a.length}function na(a){return"string"==typeof a}function y(a){return"number"==typeof a}function oa(a){return"function"==ha(a)}function pa(a){var b=typeof a;return"object"==b&&a!=s||"function"==b}function qa(a){return a[ra]||(a[ra]=++sa)}var ra="closure_uid_"+(1E9*Math.random()>>>0),sa=0;
function ta(a,b,c){return a.call.apply(a.bind,arguments)}function ua(a,b,c){a||m(Error());if(2<arguments.length){var e=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,e);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function va(a,b,c){va=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ta:ua;return va.apply(s,arguments)}
function wa(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=Array.prototype.slice.call(arguments);b.unshift.apply(b,c);return a.apply(this,b)}}var xa=Date.now||function(){return+new Date};function A(a,b){var c=a.split("."),e=fa;!(c[0]in e)&&e.execScript&&e.execScript("var "+c[0]);for(var d;c.length&&(d=c.shift());)!c.length&&ia(b)?e[d]=b:e=e[d]?e[d]:e[d]={}}
function C(a,b){function c(){}c.prototype=b.prototype;a.z=b.prototype;a.prototype=new c;a.prototype.constructor=a};function ya(a,b,c){this.Ya=this.Xa=this.Wa=0;3==arguments.length?(this.Wa=Number(a),this.Xa=Number(b),this.Ya=Number(c)):a instanceof ya?(this.Wa=Number(a.x()),this.Xa=Number(a.y()),this.Ya=Number(a.d())):(this.Wa=Number(a[0]),this.Xa=Number(a[1]),this.Ya=Number(a[2]))}
ya.prototype={l:function(){return new ya(this.Wa,this.Xa,this.Ya)},cc:function(a){return this.Wa*a.x()+this.Xa*a.y()+this.Ya*a.d()},re:function(a,b){return za(this,Aa(Ca(a,this),b))},length:function(){return Math.sqrt(this.cc(this))},wc:function(a){return new ya(this.Xa*a.d()-this.Ya*a.y(),this.Ya*a.x()-this.Wa*a.d(),this.Wa*a.y()-this.Xa*a.x())},x:u("Wa"),y:u("Xa"),d:u("Ya")};function Da(a){var b=a.length();return new ya(a.Wa/b,a.Xa/b,a.Ya/b)}
function Aa(a,b){return new ya(a.Wa*b,a.Xa*b,a.Ya*b)}function Ca(a,b){return new ya(a.Wa-b.x(),a.Xa-b.y(),a.Ya-b.d())}function za(a,b){return new ya(a.Wa+b.x(),a.Xa+b.y(),a.Ya+b.d())}function Ea(a){return new ya(-a.Wa,-a.Xa,-a.Ya)};var D=D||{};D.Bk=q;D.Ia=function(a){eval("X.DEV === undefined")||window.console.time(a)};D.Ba=function(a){eval("X.DEV === undefined")||window.console.timeEnd(a)};window["X.counter"]=new function(){this.Xh=0;this.sk=function(){return this.Xh++}};function Fa(a,b){for(var c in b){var e=b.__lookupGetter__(c),d=b.__lookupSetter__(c);c in a||(e||d?(e&&a.__defineGetter__(c,e),d&&a.__defineSetter__(c,d)):a[c]=b[c])}}var Ga=window.Mh;
Function.prototype.bind||(Function.prototype.bind=function(a){function b(){return f.apply(this instanceof c?this:a||window,d.concat(e.call(arguments)))}function c(){}"function"!==typeof this&&m(new TypeError("Function.prototype.bind - what is trying to be bound is not callable"));var e=Array.prototype.slice,d=e.call(arguments,1),f=this;c.prototype=this.prototype;b.prototype=new c;return b});
for(var Ha=0,Ia=["ms","moz","webkit","o"],Ja=0;Ja<Ia.length&&!window.requestAnimationFrame;++Ja)window.requestAnimationFrame=window[Ia[Ja]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[Ia[Ja]+"CancelAnimationFrame"]||window[Ia[Ja]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a){var b=Date.now(),c=Math.max(0,16-(b-Ha)),e=window.setTimeout(function(){a(b+c)},c);Ha=b+c;return e});
window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)});
"slice"in ArrayBuffer.prototype||(ArrayBuffer.prototype.slice=function(a,b){a===p&&m(Error("Not enough arguments."));var c=b||this.byteLength;0>a&&(a=this.byteLength+a);0>c&&(c=this.byteLength+c);c<a&&(c=a=0);0>a&&(a=0);0>c&&(c=0);a>this.byteLength&&(a=this.byteLength);c>this.byteLength&&(c=this.byteLength);for(var e=new ArrayBuffer(c-a),d=new Uint8Array(this),f=new Uint8Array(e),g=a,h=0;g<c;++g,++h)f[h]=d[g];return e});A("$",Ga);A("Function.prototype.bind",Function.prototype.bind);
A("window.requestAnimationFrame",window.requestAnimationFrame);A("window.cancelAnimationFrame",window.cancelAnimationFrame);var Ka=0;function La(){}v=La.prototype;v.key=0;v.Bc=t;v.he=t;v.Aa=function(a,b,c,e,d,f){oa(a)?this.Vg=q:a&&a.handleEvent&&oa(a.handleEvent)?this.Vg=t:m(Error("Invalid listener argument"));this.dc=a;this.ph=b;this.src=c;this.type=e;this.capture=!!d;this.tf=f;this.he=t;this.key=++Ka;this.Bc=t};v.handleEvent=function(a){return this.Vg?this.dc.call(this.tf||this.src,a):this.dc.handleEvent.call(this.dc,a)};function Ma(a,b){for(var c in a)b.call(p,a[c],c,a)}function Na(a){var b=[],c=0,e;for(e in a)b[c++]=a[e];return b}var Oa="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Qa(a,b){for(var c,e,d=1;d<arguments.length;d++){e=arguments[d];for(c in e)a[c]=e[c];for(var f=0;f<Oa.length;f++)c=Oa[f],Object.prototype.hasOwnProperty.call(e,c)&&(a[c]=e[c])}};function Ra(a){if(!Sa.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(Ta,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(Ua,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(Va,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(Wa,"&quot;"));return a}var Ta=/&/g,Ua=/</g,Va=/>/g,Wa=/\"/g,Sa=/[&<>\"]/;var Xa,Ya,Za,$a,ab,bb,db;function eb(){return fa.navigator?fa.navigator.userAgent:s}function fb(){return fa.navigator}$a=Za=Ya=Xa=t;var gb;if(gb=eb()){var hb=fb();Xa=0==gb.indexOf("Opera");Ya=!Xa&&-1!=gb.indexOf("MSIE");Za=!Xa&&-1!=gb.indexOf("WebKit");$a=!Xa&&!Za&&"Gecko"==hb.product}var ib=Xa,K=Ya,jb=$a,mb=Za,nb,qb=fb();nb=qb&&qb.platform||"";ab=-1!=nb.indexOf("Mac");bb=-1!=nb.indexOf("Win");db=-1!=nb.indexOf("Linux");var rb=!!fb()&&-1!=(fb().appVersion||"").indexOf("X11");
function sb(){var a=fa.document;return a?a.documentMode:p}var tb;a:{var ub="",vb;if(ib&&fa.opera)var wb=fa.opera.version,ub="function"==typeof wb?wb():wb;else if(jb?vb=/rv\:([^\);]+)(\)|;)/:K?vb=/MSIE\s+([^\);]+)(\)|;)/:mb&&(vb=/WebKit\/(\S+)/),vb)var xb=vb.exec(eb()),ub=xb?xb[1]:"";if(K){var yb=sb();if(yb>parseFloat(ub)){tb=String(yb);break a}}tb=ub}var zb={};
function Ab(a){var b;if(!(b=zb[a])){b=0;for(var c=String(tb).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),e=String(a).replace(/^[\s\xa0]+|[\s\xa0]+$/g,"").split("."),d=Math.max(c.length,e.length),f=0;0==b&&f<d;f++){var g=c[f]||"",h=e[f]||"",k=RegExp("(\\d*)(\\D*)","g"),j=RegExp("(\\d*)(\\D*)","g");do{var l=k.exec(g)||["","",""],n=j.exec(h)||["","",""];if(0==l[0].length&&0==n[0].length)break;b=((0==l[1].length?0:parseInt(l[1],10))<(0==n[1].length?0:parseInt(n[1],10))?-1:(0==l[1].length?0:parseInt(l[1],
10))>(0==n[1].length?0:parseInt(n[1],10))?1:0)||((0==l[2].length)<(0==n[2].length)?-1:(0==l[2].length)>(0==n[2].length)?1:0)||(l[2]<n[2]?-1:l[2]>n[2]?1:0)}while(0==b)}b=zb[a]=0<=b}return b}var Bb=fa.document,Cb=!Bb||!K?p:sb()||("CSS1Compat"==Bb.compatMode?parseInt(tb,10):5);var Db=!K||K&&9<=Cb,Eb=K&&!Ab("9");!mb||Ab("528");jb&&Ab("1.9b")||K&&Ab("8")||ib&&Ab("9.5")||mb&&Ab("528");jb&&!Ab("8")||K&&Ab("9");var Fb=Array.prototype,Gb=Fb.indexOf?function(a,b,c){return Fb.indexOf.call(a,b,c)}:function(a,b,c){c=c==s?0:0>c?Math.max(0,a.length+c):c;if(na(a))return!na(b)||1!=b.length?-1:a.indexOf(b,c);for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},Ib=Fb.forEach?function(a,b,c){Fb.forEach.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=na(a)?a.split(""):a,f=0;f<e;f++)f in d&&b.call(c,d[f],f,a)},Jb=Fb.map?function(a,b,c){return Fb.map.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=Array(e),f=
na(a)?a.split(""):a,g=0;g<e;g++)g in f&&(d[g]=b.call(c,f[g],g,a));return d},Kb=Fb.some?function(a,b,c){return Fb.some.call(a,b,c)}:function(a,b,c){for(var e=a.length,d=na(a)?a.split(""):a,f=0;f<e;f++)if(f in d&&b.call(c,d[f],f,a))return q;return t};function Lb(a,b){var c=Gb(a,b);0<=c&&Fb.splice.call(a,c,1)}function Mb(a,b,c){return 2>=arguments.length?Fb.slice.call(a,b):Fb.slice.call(a,b,c)};function Nb(){0!=Ob&&(this.zl=Error().stack,qa(this))}var Ob=0;function Pb(a,b){this.type=a;this.currentTarget=this.target=b}v=Pb.prototype;v.Ac=t;v.defaultPrevented=t;v.we=q;v.stopPropagation=function(){this.Ac=q};v.preventDefault=function(){this.defaultPrevented=q;this.we=t};function Qb(a){Qb[" "](a);return a}Qb[" "]=ga;function Ub(a,b){a&&this.Aa(a,b)}C(Ub,Pb);v=Ub.prototype;v.target=s;v.relatedTarget=s;v.offsetX=0;v.offsetY=0;v.clientX=0;v.clientY=0;v.screenX=0;v.screenY=0;v.button=0;v.keyCode=0;v.charCode=0;v.ctrlKey=t;v.altKey=t;v.shiftKey=t;v.metaKey=t;v.Yj=t;v.rb=s;
v.Aa=function(a,b){var c=this.type=a.type;Pb.call(this,c);this.target=a.target||a.srcElement;this.currentTarget=b;var e=a.relatedTarget;if(e){if(jb){var d;a:{try{Qb(e.nodeName);d=q;break a}catch(f){}d=t}d||(e=s)}}else"mouseover"==c?e=a.fromElement:"mouseout"==c&&(e=a.toElement);this.relatedTarget=e;this.offsetX=mb||a.offsetX!==p?a.offsetX:a.layerX;this.offsetY=mb||a.offsetY!==p?a.offsetY:a.layerY;this.clientX=a.clientX!==p?a.clientX:a.pageX;this.clientY=a.clientY!==p?a.clientY:a.pageY;this.screenX=
a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.Yj=ab?a.metaKey:a.ctrlKey;this.state=a.state;this.rb=a;a.defaultPrevented&&this.preventDefault();delete this.Ac};v.stopPropagation=function(){Ub.z.stopPropagation.call(this);this.rb.stopPropagation?this.rb.stopPropagation():this.rb.cancelBubble=q};
v.preventDefault=function(){Ub.z.preventDefault.call(this);var a=this.rb;if(a.preventDefault)a.preventDefault();else if(a.returnValue=t,Eb)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};v.Hi=u("rb");var Vb={},Wb={},Xb={},Yb={};function L(a,b,c,e,d){if(ja(b)){for(var f=0;f<b.length;f++)L(a,b[f],c,e,d);return s}a=Zb(a,b,c,t,e,d);b=a.key;Vb[b]=a;return b}
function Zb(a,b,c,e,d,f){b||m(Error("Invalid event type"));d=!!d;var g=Wb;b in g||(g[b]={ma:0,Ma:0});g=g[b];d in g||(g[d]={ma:0,Ma:0},g.ma++);var g=g[d],h=qa(a),k;g.Ma++;if(g[h]){k=g[h];for(var j=0;j<k.length;j++)if(g=k[j],g.dc==c&&g.tf==f){if(g.Bc)break;e||(k[j].he=t);return k[j]}}else k=g[h]=[],g.ma++;var l=$b,n=Db?function(a){return l.call(n.src,n.dc,a)}:function(a){a=l.call(n.src,n.dc,a);if(!a)return a},j=n,g=new La;g.Aa(c,j,a,b,d,f);g.he=e;j.src=a;j.dc=g;k.push(g);Xb[h]||(Xb[h]=[]);Xb[h].push(g);
a.addEventListener?(a==fa||!a.customEvent_)&&a.addEventListener(b,j,d):a.attachEvent(b in Yb?Yb[b]:Yb[b]="on"+b,j);return g}function ac(a,b,c,e,d){if(ja(b))for(var f=0;f<b.length;f++)ac(a,b[f],c,e,d);else a=Zb(a,b,c,q,e,d),Vb[a.key]=a}function bc(a,b,c,e,d){if(ja(b))for(var f=0;f<b.length;f++)bc(a,b[f],c,e,d);else{e=!!e;a:{f=Wb;if(b in f&&(f=f[b],e in f&&(f=f[e],a=qa(a),f[a]))){a=f[a];break a}a=s}if(a)for(f=0;f<a.length;f++)if(a[f].dc==c&&a[f].capture==e&&a[f].tf==d){cc(a[f].key);break}}}
function cc(a){var b=Vb[a];if(!b||b.Bc)return t;var c=b.src,e=b.type,d=b.ph,f=b.capture;c.removeEventListener?(c==fa||!c.customEvent_)&&c.removeEventListener(e,d,f):c.detachEvent&&c.detachEvent(e in Yb?Yb[e]:Yb[e]="on"+e,d);c=qa(c);Xb[c]&&(d=Xb[c],Lb(d,b),0==d.length&&delete Xb[c]);b.Bc=q;if(b=Wb[e][f][c])b.gh=q,dc(e,f,c,b);delete Vb[a];return q}
function dc(a,b,c,e){if(!e.se&&e.gh){for(var d=0,f=0;d<e.length;d++)e[d].Bc?e[d].ph.src=s:(d!=f&&(e[f]=e[d]),f++);e.length=f;e.gh=t;0==f&&(delete Wb[a][b][c],Wb[a][b].ma--,0==Wb[a][b].ma&&(delete Wb[a][b],Wb[a].ma--),0==Wb[a].ma&&delete Wb[a])}}function ec(a){var b=0;if(a!=s){if(a=qa(a),Xb[a]){a=Xb[a];for(var c=a.length-1;0<=c;c--)cc(a[c].key),b++}}else Ma(Vb,function(a,c){cc(c);b++})}
function fc(a,b){var c=qa(a),e=Xb[c];if(e){var d=ia(b),f=ia(p);return d&&f?(e=Wb[b],!!e&&!!e[p]&&c in e[p]):!d&&!f?q:Kb(e,function(a){return d&&a.type==b||f&&a.capture==p})}return t}function gc(a,b,c,e,d){var f=1;b=qa(b);if(a[b]){var g=--a.Ma,h=a[b];h.se?h.se++:h.se=1;try{for(var k=h.length,j=0;j<k;j++){var l=h[j];l&&!l.Bc&&(f&=hc(l,d)!==t)}}finally{a.Ma=Math.max(g,a.Ma),h.se--,dc(c,e,b,h)}}return Boolean(f)}function hc(a,b){a.he&&cc(a.key);return a.handleEvent(b)}
function $b(a,b){if(a.Bc)return q;var c=a.type,e=Wb;if(!(c in e))return q;var e=e[c],d,f;if(!Db){var g;if(!(g=b))a:{g=["window","event"];for(var h=fa;d=g.shift();)if(h[d]!=s)h=h[d];else{g=s;break a}g=h}d=g;g=q in e;h=t in e;if(g){if(0>d.keyCode||d.returnValue!=p)return q;a:{var k=t;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(j){k=q}if(k||d.returnValue==p)d.returnValue=q}}k=new Ub;k.Aa(d,this);d=q;try{if(g){for(var l=[],n=k.currentTarget;n;n=n.parentNode)l.push(n);f=e[q];f.Ma=f.ma;for(var w=l.length-
1;!k.Ac&&0<=w&&f.Ma;w--)k.currentTarget=l[w],d&=gc(f,l[w],c,q,k);if(h){f=e[t];f.Ma=f.ma;for(w=0;!k.Ac&&w<l.length&&f.Ma;w++)k.currentTarget=l[w],d&=gc(f,l[w],c,t,k)}}else d=hc(a,k)}finally{l&&(l.length=0)}return d}c=new Ub(b,this);return d=hc(a,c)}var ic=0;function jc(a){return a+"_"+ic++};function kc(){Nb.call(this);this.Dl={};this.wl=this}C(kc,Nb);kc.prototype.customEvent_=q;v=kc.prototype;v.Lf=s;v.Qf=ca("Lf");v.addEventListener=function(a,b,c,e){L(this,a,b,c,e)};v.removeEventListener=function(a,b,c,e){bc(this,a,b,c,e)};
v.dispatchEvent=function(a){var b=a.type||a,c=Wb;if(b in c){if(na(a))a=new Pb(a,this);else if(a instanceof Pb)a.target=a.target||this;else{var e=a;a=new Pb(b,this);Qa(a,e)}var e=1,d,c=c[b],b=q in c,f;if(b){d=[];for(f=this;f;f=f.Lf)d.push(f);f=c[q];f.Ma=f.ma;for(var g=d.length-1;!a.Ac&&0<=g&&f.Ma;g--)a.currentTarget=d[g],e&=gc(f,d[g],a.type,q,a)&&a.we!=t}if(t in c)if(f=c[t],f.Ma=f.ma,b)for(g=0;!a.Ac&&g<d.length&&f.Ma;g++)a.currentTarget=d[g],e&=gc(f,d[g],a.type,t,a)&&a.we!=t;else for(d=this;!a.Ac&&
d&&f.Ma;d=d.Lf)a.currentTarget=d,e&=gc(f,d,a.type,t,a)&&a.we!=t;a=Boolean(e)}else a=q;return a};function O(){kc.call(this);this.f="base";this.pa=window["X.counter"].sk();this.j=t}C(O,kc);O.prototype.__defineGetter__("classname",u("f"));O.prototype.__defineGetter__("id",u("pa"));A("X.base",O);function lc(a,b){this.Va=new ya(a);this.ua=new ya(b)}lc.prototype={l:function(){return new lc(this.Va.l(),this.ua.l())},yc:function(){this.ua=Ea(this.ua)}};function mc(a,b){this.ua=a;this.Od=b}mc.prototype={l:function(){return new mc(this.ua.l(),this.Od)},yc:function(){this.ua=Ea(this.ua);this.Od=-this.Od}};function nc(a,b){this.Ob=a;this.Ce=b;var c=a[0].Va,e=a[2].Va,e=Da(Ca(a[1].Va,c).wc(Ca(e,c)));this.Ua=new mc(e,e.cc(c))}nc.prototype={l:function(){var a=this.Ob.map(function(a){return a.l()});return new nc(a,this.Ce)},yc:function(){this.Ob.reverse().map(function(a){a.yc()});this.Ua.yc()}};
function oc(a,b,c,e,d,f){for(var g=0,h=[],k=0;k<a.Ob.length;k++){var j=b.ua.cc(a.Ob[k].Va)-b.Od,j=-1E-5>j?2:1E-5<j?1:0,g=g|j;h.push(j)}switch(g){case 0:(0<b.ua.cc(a.Ua.ua)?c:e).push(a);break;case 1:d.push(a);break;case 2:f.push(a);break;case 3:c=[];e=[];for(k=0;k<a.Ob.length;k++){var l=(k+1)%a.Ob.length,j=h[k],n=h[l],g=a.Ob[k],l=a.Ob[l];2!=j&&c.push(g);1!=j&&e.push(2!=j?g.l():g);3==(j|n)&&(j=(b.Od-b.ua.cc(g.Va))/b.ua.cc(Ca(l.Va,g.Va)),j=new lc(g.Va.re(l.Va,j),g.ua.re(l.ua,j)),c.push(j),e.push(j.l()))}3<=
c.length&&d.push(new nc(c,a.Ce));3<=e.length&&f.push(new nc(e,a.Ce))}};function pc(a){this.ya=this.za=this.Ua=s;this.Z=[];a&&qc(this,a)}pc.prototype={l:function(){var a=new pc,b=this.Ua&&this.Ua.l();a.Ua=b;b=this.za&&this.za.l();a.za=b;b=this.ya&&this.ya.l();a.ya=b;a.Be(this.Z.map(function(a){return a.l()}));return a},Y:function(){for(var a=0;a<this.Z.length;a++)this.Z[a].yc();this.Ua.yc();this.za&&this.za.Y();this.ya&&this.ya.Y();a=this.za;this.za=this.ya;this.ya=a},Be:ca("Z")};
function qc(a,b){if(b.length){a.Ua||(a.Ua=b[0].Ua.l());for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Ua,a.Z,a.Z,c,e);c.length&&(a.za||(a.za=new pc),qc(a.za,c));e.length&&(a.ya||(a.ya=new pc),qc(a.ya,e))}}function rc(a){var b=a.Z.slice();a.za&&(b=b.concat(rc(a.za)));a.ya&&(b=b.concat(rc(a.ya)));return b}function tc(a,b){a.Z=uc(b,a.Z);a.za&&tc(a.za,b);a.ya&&tc(a.ya,b)}
function uc(a,b){if(!a.Ua)return b.slice();for(var c=[],e=[],d=0;d<b.length;d++)oc(b[d],a.Ua,c,e,c,e);a.za&&(c=uc(a.za,c));e=a.ya?uc(a.ya,e):[];return c.concat(e)};function vc(){this.Z=[]}function wc(a){var b=new vc;b.Be(a);return b}
vc.prototype={l:function(){var a=new vc;a.Be(this.Z.map(function(a){return a.l()}));return a},Xf:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);tc(b,a);tc(a,b);a.Y();tc(a,b);a.Y();qc(b,rc(a));return wc(rc(b))},va:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);b.Y();tc(b,a);tc(a,b);a.Y();tc(a,b);a.Y();qc(b,rc(a));b.Y();return wc(rc(b))},vf:function(a){var b=new pc(this.l().Z);a=new pc(a.l().Z);b.Y();tc(a,b);a.Y();tc(b,a);tc(a,b);qc(b,rc(a));b.Y();return wc(rc(b))},inverse:function(){var a=
this.l();a.Z.map(function(a){a.yc()});return a},Be:ca("Z")};function xc(){O.call(this);this.f="indexer";this.bf=[];this.rl=[];this.Ja={}}C(xc,O);xc.prototype.add=function(a){a==s&&m(Error("Invalid object."));var b=window.JSON.stringify(a);b in this.Ja||(this.Ja[b]=this.bf.length,this.bf.push(a));return this.Ja[b]};xc.prototype.unique=u("bf");function yc(a){O.call(this);this.f="file";this.Zd=a;this.j=q}C(yc,O);function zc(){this.Za=this.r=s}zc.prototype.__defineSetter__("file",function(a){if(a==s||ja(a)&&0==a.length)this.r=s;else{if(ja(a)){if(1==a.length){this.r=new yc(a[0]);return}this.r=Jb(a,function(a){var c=new P;c.r=new yc(a);return c})}else this.r=new yc(a);this.Za=s}});zc.prototype.__defineGetter__("file",function(){return!this.r?"":ja(this.r)?this.r.map(function(a){return a.r.Zd}):this.r.Zd});
zc.prototype.__defineGetter__("filedata",function(){return ja(this.r)?this.r.map(function(a){return a.Za}):this.Za});zc.prototype.__defineSetter__("filedata",function(a){if(a==s||ja(a)&&0==a.length)this.Za=s;if(ja(a))if(1==a.length)this.Za=a[0];else{var b=this.r.length,c;for(c=0;c<b;c++)this.r[c].Za=a[c]}else this.Za=a});function Ac(a){if("function"==typeof a.Cd)return a.Cd();if(na(a))return a.split("");if(la(a)){for(var b=[],c=a.length,e=0;e<c;e++)b.push(a[e]);return b}return Na(a)};function Bc(a,b){this.ea={};this.T=[];var c=arguments.length;if(1<c){c%2&&m(Error("Uneven number of arguments"));for(var e=0;e<c;e+=2)this.set(arguments[e],arguments[e+1])}else a&&this.df(a)}v=Bc.prototype;v.ma=0;v.Zf=0;v.sf=u("ma");v.Cd=function(){Cc(this);for(var a=[],b=0;b<this.T.length;b++)a.push(this.ea[this.T[b]]);return a};function Dc(a){for(var b=0;b<a.T.length;b++){var c=a.T[b];if(Ec(a.ea,c)&&a.ea[c]==t)return q}return t}v.clear=function(){this.ea={};this.Zf=this.ma=this.T.length=0};
v.remove=function(a){return Ec(this.ea,a)?(delete this.ea[a],this.ma--,this.Zf++,this.T.length>2*this.ma&&Cc(this),q):t};function Cc(a){if(a.ma!=a.T.length){for(var b=0,c=0;b<a.T.length;){var e=a.T[b];Ec(a.ea,e)&&(a.T[c++]=e);b++}a.T.length=c}if(a.ma!=a.T.length){for(var d={},c=b=0;b<a.T.length;)e=a.T[b],Ec(d,e)||(a.T[c++]=e,d[e]=1),b++;a.T.length=c}}v.get=function(a,b){return Ec(this.ea,a)?this.ea[a]:b};v.set=function(a,b){Ec(this.ea,a)||(this.ma++,this.T.push(a),this.Zf++);this.ea[a]=b};
v.df=function(a){var b;if(a instanceof Bc)Cc(a),b=a.T.concat(),a=a.Cd();else{b=[];var c=0,e;for(e in a)b[c++]=e;a=Na(a)}for(c=0;c<b.length;c++)this.set(b[c],a[c])};v.l=function(){return new Bc(this)};v.Wf=function(){for(var a=new Bc,b=0;b<this.T.length;b++){var c=this.T[b];a.set(this.ea[c],c)}return a};function Ec(a,b){return Object.prototype.hasOwnProperty.call(a,b)};function Fc(){O.call(this);this.f="colortable";this.Ja=new Bc;Fa(this,new zc)}C(Fc,O);Fc.prototype.add=function(a,b,c,e,d,f){(!y(a)||!y(c)||!y(e)||!y(d)||!y(f))&&m(Error("Invalid color table entry."));this.Ja.set(a,[b,c,e,d,f]);this.j=q};Fc.prototype.get=function(a){return this.Ja.get(a)};A("X.colortable.prototype.get",Fc.prototype.get);function Gc(a,b,c){this.x=ia(a)?a:0;this.y=ia(b)?b:0;this.d=ia(c)?c:0}Gc.prototype.l=function(){return new Gc(this.x,this.y,this.d)};function R(a,b,c){this.x=a;this.y=b;this.d=c}C(R,Gc);v=R.prototype;v.l=function(){return new R(this.x,this.y,this.d)};v.Mb=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.d*this.d)};v.scale=function(a){this.x*=a;this.y*=a;this.d*=a;return this};v.Y=function(){this.x=-this.x;this.y=-this.y;this.d=-this.d;return this};v.normalize=function(){return this.scale(1/this.Mb())};v.add=function(a){this.x+=a.x;this.y+=a.y;this.d+=a.d;return this};
v.va=function(a){this.x-=a.x;this.y-=a.y;this.d-=a.d;return this};function Hc(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return Math.sqrt(c*c+e*e+d*d)}function Ic(a,b){var c=a.x-b.x,e=a.y-b.y,d=a.d-b.d;return c*c+e*e+d*d}function Jc(a,b){return new R(a.x+b.x,a.y+b.y,a.d+b.d)}function Kc(a,b){return new R(a.y*b.d-a.d*b.y,a.d*b.x-a.x*b.d,a.x*b.y-a.y*b.x)};D.m=R;v=D.m.prototype;v.l=R.prototype.l;v.Mb=R.prototype.Mb;v.scale=R.prototype.scale;v.Y=R.prototype.Y;v.add=R.prototype.add;v.va=R.prototype.va;v.normalize=function(){var a=this.Mb();return 0==a?this.scale(0):this.scale(1/a)};D.m.cc=function(a,b){return a.x*b.x+a.y*b.y+a.d*b.d};D.m.wc=Kc;D.m.rf=Hc;D.m.re=function(a,b,c){return new R(a.x+c*(b.x-a.x),a.y+c*(b.y-a.y),a.d+c*(b.d-a.d))};D.m.prototype.__defineGetter__("xx",u("x"));D.m.prototype.__defineGetter__("yy",u("y"));
D.m.prototype.__defineGetter__("zz",u("d"));A("X.vector",D.m);A("X.vector.prototype.clone",D.m.prototype.l);A("X.vector.prototype.magnitude",D.m.prototype.Mb);A("X.vector.prototype.scale",D.m.prototype.scale);A("X.vector.prototype.invert",D.m.prototype.Y);A("X.vector.prototype.normalize",D.m.prototype.normalize);A("X.vector.prototype.add",D.m.prototype.add);A("X.vector.prototype.subtract",D.m.prototype.va);A("X.vector.dot",D.m.cc);A("X.vector.cross",D.m.wc);A("X.vector.distance",D.m.rf);
A("X.vector.lerp",D.m.re);function Lc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Lc.prototype.BYTES_PER_ELEMENT=8;Lc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Lc.prototype.toString=Array.prototype.join;if("undefined"==typeof Float64Array){try{Lc.BYTES_PER_ELEMENT=8}catch(Mc){}Lc.prototype.BYTES_PER_ELEMENT=Lc.prototype.BYTES_PER_ELEMENT;Lc.prototype.set=Lc.prototype.set;Lc.prototype.toString=Lc.prototype.toString;A("Float64Array",Lc)};function Nc(a){this.length=a.length||a;for(var b=0;b<this.length;b++)this[b]=a[b]||0}Nc.prototype.BYTES_PER_ELEMENT=4;Nc.prototype.set=function(a,b){b=b||0;for(var c=0;c<a.length&&b+c<this.length;c++)this[b+c]=a[c]};Nc.prototype.toString=Array.prototype.join;"undefined"==typeof Float32Array&&(Nc.BYTES_PER_ELEMENT=4,Nc.prototype.BYTES_PER_ELEMENT=Nc.prototype.BYTES_PER_ELEMENT,Nc.prototype.set=Nc.prototype.set,Nc.prototype.toString=Nc.prototype.toString,A("Float32Array",Nc));function Oc(){return new Float32Array(3)}function Pc(a,b,c){var e=Oc();e[0]=a;e[1]=b;e[2]=c;return e}function Qc(a,b){var c=a[0],e=a[1],d=a[2],c=1/Math.sqrt(c*c+e*e+d*d);b[0]=a[0]*c;b[1]=a[1]*c;b[2]=a[2]*c};function Rc(){return new Float32Array(4)}function Sc(a,b,c,e){var d=Rc();d[0]=a;d[1]=b;d[2]=c;d[3]=e;return d};function Tc(){return new Float32Array(16)}function Uc(){var a=Tc();a[0]=a[5]=a[10]=a[15]=1;return a}function Vc(a,b,c,e,d,f,g,h,k,j,l,n,w,r,x,z,E){a[0]=b;a[1]=c;a[2]=e;a[3]=d;a[4]=f;a[5]=g;a[6]=h;a[7]=k;a[8]=j;a[9]=l;a[10]=n;a[11]=w;a[12]=r;a[13]=x;a[14]=z;a[15]=E;return a}function Wc(a,b,c,e,d){a[12]=b;a[13]=c;a[14]=e;a[15]=d;return a}function Xc(a,b,c){b*=4;a[b]=c[0];a[b+1]=c[1];a[b+2]=c[2];a[b+3]=c[3]}function Yc(a,b,c){b*=4;c[0]=a[b];c[1]=a[b+1];c[2]=a[b+2];c[3]=a[b+3]}
function T(a,b,c,e,d,f){a[b]=c;a[b+4]=e;a[b+8]=d;a[b+12]=f}function bd(a,b,c){a[b]=c[0];a[b+4]=c[1];a[b+8]=c[2];a[b+12]=c[3]}function cd(a,b,c){c[0]=a[b];c[1]=a[b+4];c[2]=a[b+8];c[3]=a[b+12]}
function dd(a,b,c){var e=a[0],d=a[1],f=a[2],g=a[3],h=a[4],k=a[5],j=a[6],l=a[7],n=a[8],w=a[9],r=a[10],x=a[11],z=a[12],E=a[13],H=a[14];a=a[15];var J=b[0],B=b[1],F=b[2],G=b[3],M=b[4],Q=b[5],N=b[6],U=b[7],da=b[8],I=b[9],aa=b[10],ma=b[11],S=b[12],V=b[13],Pa=b[14];b=b[15];c[0]=e*J+h*B+n*F+z*G;c[1]=d*J+k*B+w*F+E*G;c[2]=f*J+j*B+r*F+H*G;c[3]=g*J+l*B+x*F+a*G;c[4]=e*M+h*Q+n*N+z*U;c[5]=d*M+k*Q+w*N+E*U;c[6]=f*M+j*Q+r*N+H*U;c[7]=g*M+l*Q+x*N+a*U;c[8]=e*da+h*I+n*aa+z*ma;c[9]=d*da+k*I+w*aa+E*ma;c[10]=f*da+j*I+r*aa+
H*ma;c[11]=g*da+l*I+x*aa+a*ma;c[12]=e*S+h*V+n*Pa+z*b;c[13]=d*S+k*V+w*Pa+E*b;c[14]=f*S+j*V+r*Pa+H*b;c[15]=g*S+l*V+x*Pa+a*b;return c}
function ed(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],k=a[6],j=a[7],l=a[8],n=a[9],w=a[10],r=a[11],x=a[12],z=a[13],E=a[14],H=a[15],J=c*h-e*g,B=c*k-d*g,F=c*j-f*g,G=e*k-d*h,M=e*j-f*h,Q=d*j-f*k,N=l*z-n*x,U=l*E-w*x,da=l*H-r*x,I=n*E-w*z,aa=n*H-r*z,ma=w*H-r*E,S=J*ma-B*aa+F*I+G*da-M*U+Q*N;if(0==S)return t;S=1/S;b[0]=(h*ma-k*aa+j*I)*S;b[1]=(-e*ma+d*aa-f*I)*S;b[2]=(z*Q-E*M+H*G)*S;b[3]=(-n*Q+w*M-r*G)*S;b[4]=(-g*ma+k*da-j*U)*S;b[5]=(c*ma-d*da+f*U)*S;b[6]=(-x*Q+E*F-H*B)*S;b[7]=(l*Q-w*F+r*B)*S;b[8]=(g*
aa-h*da+j*N)*S;b[9]=(-c*aa+e*da-f*N)*S;b[10]=(x*M-z*F+H*J)*S;b[11]=(-l*M+n*F-r*J)*S;b[12]=(-g*I+h*U-k*N)*S;b[13]=(c*I-e*U+d*N)*S;b[14]=(-x*G+z*B-E*J)*S;b[15]=(l*G-n*B+w*J)*S;return q}function fd(a,b,c){var e=b[0],d=b[1];b=b[2];c[0]=e*a[0]+d*a[4]+b*a[8]+a[12];c[1]=e*a[1]+d*a[5]+b*a[9]+a[13];c[2]=e*a[2]+d*a[6]+b*a[10]+a[14]}
function gd(a,b,c){var e=b[0],d=b[1],f=b[2];b=b[3];c[0]=e*a[0]+d*a[4]+f*a[8]+b*a[12];c[1]=e*a[1]+d*a[5]+f*a[9]+b*a[13];c[2]=e*a[2]+d*a[6]+f*a[10]+b*a[14];c[3]=e*a[3]+d*a[7]+f*a[11]+b*a[15];return c}function hd(a,b,c,e){return Wc(a,a[0]*b+a[4]*c+a[8]*e+a[12],a[1]*b+a[5]*c+a[9]*e+a[13],a[2]*b+a[6]*c+a[10]*e+a[14],a[3]*b+a[7]*c+a[11]*e+a[15])}new Float64Array(3);new Float64Array(3);new Float64Array(4);new Float64Array(4);new Float64Array(4);new Float64Array(16);D.g={};D.g.Yg=function(a,b,c,e){c=c.va(b);c.normalize();e=D.m.wc(c,e);e.normalize();var d=D.m.wc(e,c);d.normalize();c.Y();T(a,0,e.x,e.y,e.d,0);T(a,1,d.x,d.y,d.d,0);T(a,2,c.x,c.y,c.d,0);hd(a,-b.x,-b.y,-b.d);return a};D.g.aa=function(a,b,c,e){var d=1/(b*a[3]+c*a[7]+e*a[11]+a[15]);return new D.m((b*a[0]+c*a[4]+e*a[8]+a[12])*d,(b*a[1]+c*a[5]+e*a[9]+a[13])*d,(b*a[2]+c*a[6]+e*a[10]+a[14])*d)};
D.g.pk=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);cd(a,b,e);cd(a,c,d);bd(a,b,d);bd(a,c,e);return a};D.g.ok=function(a,b,c){var e=new Float32Array(4),d=new Float32Array(4);Yc(a,b,e);Yc(a,c,d);Xc(a,b,d);Xc(a,c,e);return a};D.g.Dd=Uc;D.g.l=function(a){var b=Tc();b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};
D.g.Wf=function(a,b){if(b==a){var c=a[1],e=a[2],d=a[3],f=a[6],g=a[7],h=a[11];b[1]=a[4];b[2]=a[8];b[3]=a[12];b[4]=c;b[6]=a[9];b[7]=a[13];b[8]=e;b[9]=f;b[11]=a[14];b[12]=d;b[13]=g;b[14]=h}else b[0]=a[0],b[1]=a[4],b[2]=a[8],b[3]=a[12],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[7]=a[13],b[8]=a[2],b[9]=a[6],b[10]=a[10],b[11]=a[14],b[12]=a[3],b[13]=a[7],b[14]=a[11],b[15]=a[15];return b};
D.g.ui=function(a){var b=a[0],c=a[1],e=a[2],d=a[3],f=a[4],g=a[5],h=a[6],k=a[7],j=a[8],l=a[9],n=a[10],w=a[11],r=a[12],x=a[13],z=a[14];a=a[15];return(b*g-c*f)*(n*a-w*z)-(b*h-e*f)*(l*a-w*x)+(b*k-d*f)*(l*z-n*x)+(c*h-e*g)*(j*a-w*r)-(c*k-d*g)*(j*z-n*r)+(e*k-d*h)*(j*x-l*r)};D.g.Y=ed;D.g.yf=function(a,b,c,e,d){var f=b/2;b=d-e;var g=Math.sin(f);if(0==b||0==g||0==c)return a;f=Math.cos(f)/g;return Vc(a,f/c,0,0,0,0,f,0,0,0,0,-(d+e)/b,-1,0,0,-(2*e*d)/b,0)};
D.g.fj=function(a,b,c,e,d,f,g){return Vc(a,2*f/(c-b),0,0,0,0,2*f/(d-e),0,0,(c+b)/(c-b),(d+e)/(d-e),-(g+f)/(g-f),-1,0,0,-(2*g*f)/(g-f),0)};D.g.gj=function(a,b,c,e,d,f,g){return Vc(a,2/(c-b),0,0,0,0,2/(d-e),0,0,0,0,-2/(g-f),0,-(c+b)/(c-b),-(d+e)/(d-e),-(g+f)/(g-f),1)};D.g.multiply=dd;D.g.bh=gd;D.g.translate=hd;D.g.scale=function(a,b,c,e){return Vc(a,a[0]*b,a[1]*b,a[2]*b,a[3]*b,a[4]*c,a[5]*c,a[6]*c,a[7]*c,a[8]*e,a[9]*e,a[10]*e,a[11]*e,a[12],a[13],a[14],a[15])};
D.g.rotate=function(a,b,c,e,d){var f=a[0],g=a[1],h=a[2],k=a[3],j=a[4],l=a[5],n=a[6],w=a[7],r=a[8],x=a[9],z=a[10],E=a[11],H=Math.cos(b),J=Math.sin(b),B=1-H;b=c*c*B+H;var F=c*e*B+d*J,G=c*d*B-e*J,M=c*e*B-d*J,Q=e*e*B+H,N=e*d*B+c*J,U=c*d*B+e*J;c=e*d*B-c*J;d=d*d*B+H;return Vc(a,f*b+j*F+r*G,g*b+l*F+x*G,h*b+n*F+z*G,k*b+w*F+E*G,f*M+j*Q+r*N,g*M+l*Q+x*N,h*M+n*Q+z*N,k*M+w*Q+E*N,f*U+j*c+r*d,g*U+l*c+x*d,h*U+n*c+z*d,k*U+w*c+E*d,a[12],a[13],a[14],a[15])};
D.g.xe=function(a,b){var c=a[4],e=a[5],d=a[6],f=a[7],g=a[8],h=a[9],k=a[10],j=a[11],l=Math.cos(b),n=Math.sin(b);a[4]=c*l+g*n;a[5]=e*l+h*n;a[6]=d*l+k*n;a[7]=f*l+j*n;a[8]=c*-n+g*l;a[9]=e*-n+h*l;a[10]=d*-n+k*l;a[11]=f*-n+j*l;return a};D.g.ye=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[8],h=a[9],k=a[10],j=a[11],l=Math.cos(b),n=Math.sin(b);a[0]=c*l+g*-n;a[1]=e*l+h*-n;a[2]=d*l+k*-n;a[3]=f*l+j*-n;a[8]=c*n+g*l;a[9]=e*n+h*l;a[10]=d*n+k*l;a[11]=f*n+j*l;return a};
D.g.ze=function(a,b){var c=a[0],e=a[1],d=a[2],f=a[3],g=a[4],h=a[5],k=a[6],j=a[7],l=Math.cos(b),n=Math.sin(b);a[0]=c*l+g*n;a[1]=e*l+h*n;a[2]=d*l+k*n;a[3]=f*l+j*n;a[4]=c*-n+g*l;a[5]=e*-n+h*l;a[6]=d*-n+k*l;a[7]=f*-n+j*l;return a};A("X.matrix.identity",D.g.Dd);A("X.matrix.clone",D.g.l);A("X.matrix.transpose",D.g.Wf);A("X.matrix.determinant",D.g.ui);A("X.matrix.invert",D.g.Y);A("X.matrix.multiply",D.g.multiply);A("X.matrix.multiplyByVector",D.g.aa);A("X.matrix.multiplyByVec4",D.g.bh);
A("X.matrix.makePerspective",D.g.yf);A("X.matrix.makeFrustum",D.g.fj);A("X.matrix.makeOrtho",D.g.gj);A("X.matrix.makeLookAt",D.g.Yg);A("X.matrix.translate",D.g.translate);A("X.matrix.scale",D.g.scale);A("X.matrix.rotate",D.g.rotate);A("X.matrix.rotateX",D.g.xe);A("X.matrix.rotateY",D.g.ye);A("X.matrix.rotateZ",D.g.ze);A("X.matrix.swapRows",D.g.pk);A("X.matrix.swapCols",D.g.ok);function id(){O.call(this);this.f="transform";this.Q=D.g.Dd()}C(id,O);id.prototype.__defineGetter__("matrix",u("Q"));id.prototype.__defineSetter__("matrix",function(a){(a==s||!(a instanceof Float32Array))&&m(Error("Invalid matrix."));this.Q=a;this.q()});v=id.prototype;v.xe=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));D.g.xe(this.Q,a*Math.PI/180);this.q()};v.ye=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));D.g.ye(this.Q,a*Math.PI/180);this.q()};
v.ze=function(a){(!y(a)||-360>a||360<a)&&m(Error("Invalid angle."));D.g.ze(this.Q,a*Math.PI/180);this.q()};v.Eh=function(a){y(a)||m(Error("Invalid distance."));D.g.translate(this.Q,a,0,0);this.q()};v.Fh=function(a){y(a)||m(Error("Invalid distance."));D.g.translate(this.Q,0,a,0);this.q()};v.Gh=function(a){y(a)||m(Error("Invalid distance."));D.g.translate(this.Q,0,0,a);this.q()};function jd(a,b,c){a.Q[b+4*c]*=-1;a.q()}v.Ci=function(){jd(this,0,0)};v.Di=function(){jd(this,1,1)};
v.Ei=function(){jd(this,2,2)};v.q=function(){this.j=q};A("X.transform",id);A("X.transform.prototype.rotateX",id.prototype.xe);A("X.transform.prototype.rotateY",id.prototype.ye);A("X.transform.prototype.rotateZ",id.prototype.ze);A("X.transform.prototype.translateX",id.prototype.Eh);A("X.transform.prototype.translateY",id.prototype.Fh);A("X.transform.prototype.translateZ",id.prototype.Gh);A("X.transform.prototype.flipX",id.prototype.Ci);A("X.transform.prototype.flipY",id.prototype.Di);
A("X.transform.prototype.flipZ",id.prototype.Ei);A("X.transform.prototype.modified",id.prototype.q);function kd(){O.call(this);this.f="texture";this.Yb=this.hb=this.r=s;this.We=this.Xe=0;this.ig=t;Fa(this,new zc)}C(kd,O);kd.prototype.__defineSetter__("rawData",function(a){this.Yb=a;this.j=q});kd.prototype.__defineSetter__("rawDataHeight",function(a){this.We=a;this.j=q});kd.prototype.__defineSetter__("rawDataWidth",function(a){this.Xe=a;this.j=q});kd.prototype.__defineSetter__("grayscale",function(a){this.ig=a;this.j=q});A("X.texture",kd);function W(a,b){O.call(this);this.f="triplets";this.mb=Infinity;this.jb=-Infinity;this.nb=Infinity;this.kb=-Infinity;this.ob=Infinity;this.lb=-Infinity;this.Qd=[0,0,0];this.hg=q;this.F=0;this.ba=new Float32Array(a);b!=s&&(this.ba=b.ba.subarray(0,b.ba.length),this.F=this.ba.length,this.mb=b.mb,this.jb=b.jb,this.nb=b.nb,this.kb=b.kb,this.ob=b.ob,this.lb=b.lb,this.Qd=b.Qd.slice(),this.hg=t)}C(W,O);v=W.prototype;
v.add=function(a,b,c){this.mb=Math.min(this.mb,a);this.jb=Math.max(this.jb,a);this.nb=Math.min(this.nb,b);this.kb=Math.max(this.kb,b);this.ob=Math.min(this.ob,c);this.lb=Math.max(this.lb,c);this.Qd=[(this.mb+this.jb)/2,(this.nb+this.kb)/2,(this.ob+this.lb)/2];this.hg=t;this.j=q;this.ba[this.F++]=a;this.ba[this.F++]=b;this.ba[this.F++]=c;return this.F/3};v.Na=function(){if(this.F!=this.ba.length){var a=new Float32Array(this.F);a.set(this.ba.subarray(0,this.F));this.ba=a}};
v.get=function(a){a*=3;return[this.ba[a],this.ba[a+1],this.ba[a+2]]};v.remove=function(){m(Error("Not implemented."))};v.clear=function(){this.ba=new Float32Array(this.ba.length);this.j=q};W.prototype.__defineGetter__("count",function(){this.Na();return this.ba.length/3});W.prototype.__defineGetter__("length",function(){this.Na();return this.ba.length});A("X.triplets",W);A("X.triplets.prototype.add",W.prototype.add);A("X.triplets.prototype.resize",W.prototype.Na);A("X.triplets.prototype.get",W.prototype.get);
A("X.triplets.prototype.remove",W.prototype.remove);A("X.triplets.prototype.clear",W.prototype.clear);function ld(){this.Ha=md;this.ha=new id;this.A=[1,1,1];this.qc=this.I=this.oa=this.o=this.h=s;this.Rc=[];this.O=q;this.Oc=this.rd=1;this.Hc=s;this.gd=t;this.xa=1;this.Da=0;this.qd=q}var md="TRIANGLES";ld.prototype.__defineSetter__("type",function(a){return this.Ha=a});ld.prototype.__defineGetter__("type",u("Ha"));ld.prototype.__defineGetter__("texture",function(){this.I||(this.I=new kd);return this.I});ld.prototype.__defineGetter__("transform",u("ha"));ld.prototype.__defineGetter__("points",u("h"));
ld.prototype.__defineSetter__("points",ca("h"));ld.prototype.__defineGetter__("normals",u("o"));ld.prototype.__defineSetter__("normals",ca("o"));ld.prototype.__defineGetter__("colors",u("oa"));ld.prototype.__defineSetter__("colors",ca("oa"));ld.prototype.__defineGetter__("color",u("A"));ld.prototype.__defineSetter__("color",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid color."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].color=a;this.A=a;this.j=q});
ld.prototype.__defineGetter__("opacity",u("xa"));ld.prototype.__defineSetter__("opacity",function(a){(!y(a)||1<a||0>a)&&m(Error("Invalid opacity."));for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=s&&(b[e].opacity=a);this.xa=a;this.j=q});ld.prototype.__defineGetter__("caption",u("Hc"));ld.prototype.__defineSetter__("caption",function(a){this.Hc=a;this.j=q});ld.prototype.__defineGetter__("visible",u("O"));
ld.prototype.__defineSetter__("visible",function(a){for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e]!=s&&(b[e].visible=a);this.O=a;this.j=q});ld.prototype.__defineGetter__("pointsize",u("rd"));ld.prototype.__defineSetter__("pointsize",function(a){y(a)||m(Error("Invalid point size."));this.rd=a;this.j=q});ld.prototype.__defineGetter__("magicmode",u("gd"));ld.prototype.__defineSetter__("magicmode",function(a){"boolean"!=typeof a&&m(Error("Invalid magic mode setting."));this.gd=a;this.j=q});
ld.prototype.__defineGetter__("linewidth",u("Oc"));ld.prototype.__defineSetter__("linewidth",function(a){y(a)||m(Error("Invalid line width."));this.Oc=a;this.j=q});ld.prototype.__defineGetter__("pickable",u("qd"));ld.prototype.__defineSetter__("pickable",function(a){"boolean"!=typeof a&&m(Error("Invalid pickable setting."));this.qd=a;this.j=q});ld.prototype.__defineGetter__("textureCoordinateMap",u("qc"));ld.prototype.__defineSetter__("textureCoordinateMap",ca("ul"));function nd(){this.qa=Infinity;this.U=this.ga=-Infinity;this.W=Infinity;this.Ub=[0,0,0];this.Sb=[1,1,1]}nd.prototype.__defineGetter__("lowerThreshold",u("U"));nd.prototype.__defineSetter__("lowerThreshold",ca("U"));nd.prototype.__defineGetter__("upperThreshold",u("W"));nd.prototype.__defineSetter__("upperThreshold",ca("W"));nd.prototype.__defineGetter__("min",u("qa"));nd.prototype.__defineGetter__("max",u("ga"));nd.prototype.__defineGetter__("minColor",u("Ub"));
nd.prototype.__defineSetter__("minColor",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid min. color."));this.Ub=a});nd.prototype.__defineGetter__("maxColor",u("Sb"));nd.prototype.__defineSetter__("maxColor",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid max. color."));this.Sb=a});function od(){O.call(this);this.f="scalars";this.bd=this.K=s;this.vg=q;this.Le=0;Fa(this,new zc);Fa(this,new nd);this.Ub=[0,1,0];this.Sb=[1,0,0]}C(od,O);od.prototype.__defineGetter__("array",u("K"));od.prototype.__defineSetter__("array",function(a){this.bd=this.K=a;this.j=q});od.prototype.__defineGetter__("interpolation",u("Le"));od.prototype.__defineSetter__("interpolation",ca("Le"));A("X.scalars",od);function Y(a){O.call(this);this.f="object";this.c=[];this.H=this.wa=s;Fa(this,new ld);a!=s&&this.vc(a)}C(Y,O);
Y.prototype.vc=function(a){this.Ha=a.Ha;this.ha=new id;this.ha.Q=new Float32Array(a.ha.Q);this.A=a.A.slice();a.h&&(this.h=new W(a.h.length,a.h));a.o&&(this.o=new W(a.o.length,a.o));a.oa&&(this.oa=new W(a.oa.length,a.oa));this.I=a.I;this.qc=a.qc;a.r&&(this.r=new yc((new String(a.r.Zd)).toString()));this.xa=a.xa;this.c.length=0;var b=a.c;if(b)for(var c=b.length,e=0,e=0;e<c;e++)this.c.push(new D[b[e].f](b[e]));this.O=a.O;this.rd=a.rd;this.Oc=a.Oc;a.Hc&&(this.Hc=(new String(a.Hc)).toString());this.gd=
a.gd;this.qd=a.qd;this.Rc=a.Rc.slice();this.j=q};Y.prototype.__defineGetter__("colortable",function(){this.wa||(this.wa=new Fc);return this.wa});Y.prototype.__defineGetter__("scalars",function(){this.H||(this.H=new od);return this.H});Y.prototype.__defineGetter__("children",u("c"));Y.prototype.q=function(){var a=new pd;a.G=this;this.dispatchEvent(a)};Y.prototype.remove=function(){var a=new qd;a.G=this;this.dispatchEvent(a)};
Y.prototype.Sa=function(){ec(this);if(0<this.c.length)for(var a=this.c,b=a.length,c=0,c=0;c<b;c++)"undefined"!=typeof a[c]&&this.c[c].Sa();this.c.length=0;this.H=this.wa=s};function rd(a,b){(a==s||b==s||!(a instanceof Y)||!(b instanceof Y))&&m(Error("Fatal: Two valid X.objects are required for comparison."));return 1==a.xa?-1:1==b.xa?1:a.Da!=s&&b.Da!=s&&a.Da>b.Da?-1:1}A("X.object",Y);A("X.object.prototype.modified",Y.prototype.q);A("X.object.prototype.remove",Y.prototype.remove);
A("X.object.prototype.destroy",Y.prototype.Sa);function sd(){}function td(a){for(var b=a.h.count,c=[],e=0,e=0;e<b;e+=3){var d=a.h.get(e),f=a.h.get(e+1),g=a.h.get(e+2),h=a.o.get(e),k=a.o.get(e+1),j=a.o.get(e+2),l=a.A;a.oa&&0<a.oa.length&&(l=a.oa.get(e));var n=[];n.push(new lc(d,h));n.push(new lc(f,k));n.push(new lc(g,j));c.push(new nc(n,l))}return wc(c)}
function ud(a,b){(b==s||!(b instanceof vc))&&m(Error("Invalid CSG object."));var c=new xc,e=[];Jb(b.Z,function(a){var b=[],g=a.Ce,b=Jb(a.Ob,function(a){a.color=g;return c.add(a)});for(a=a=2;a<b.length;a++)e.push([b[0],b[a-1],b[a]])}.bind(a));a.Wh=Jb(c.unique(),function(a){return[a.Va.x(),a.Va.y(),a.Va.d()]});a.Vh=Jb(c.unique(),function(a){return[a.ua.x(),a.ua.y(),a.ua.d()]});a.Uh=Jb(c.unique(),function(a){return!a.color?s:[a.color[0],a.color[1],a.color[2]]});a.h=new W(9*e.length);a.o=new W(9*e.length);
a.oa=new W(9*e.length);Jb(e,function(a){var b=a[0],c=a[1];a=a[2];var e=this.Wh,k=this.Vh,j=this.Uh;this.h.add(e[b][0],e[b][1],e[b][2]);this.h.add(e[c][0],e[c][1],e[c][2]);this.h.add(e[a][0],e[a][1],e[a][2]);this.o.add(k[b][0],k[b][1],k[b][2]);this.o.add(k[c][0],k[c][1],k[c][2]);this.o.add(k[a][0],k[a][1],k[a][2]);j[b]&&this.oa.add(j[b][0],j[b][1],j[b][2]);j[c]&&this.oa.add(j[c][0],j[c][1],j[c][2]);j[a]&&this.oa.add(j[a][0],j[a][1],j[a][2])}.bind(a));0==a.oa.F&&(a.oa=s);a.Ha=md}
sd.prototype.Xf=function(a){(a==s||!(a instanceof vc)&&!(a instanceof Y))&&m(Error("Invalid object."));var b=a;a instanceof Y&&(b=td(b));a=new Y;Fa(a,new sd);ud(a,td(this).Xf(b));return a};sd.prototype.va=function(a){(a==s||!(a instanceof vc)&&!(a instanceof Y))&&m(Error("Invalid object."));var b=a;a instanceof Y&&(b=td(b));a=new Y;Fa(a,new sd);ud(a,td(this).va(b));return a};
sd.prototype.vf=function(a){(a==s||!(a instanceof vc)&&!(a instanceof Y))&&m(Error("Invalid object."));var b=a;a instanceof Y&&(b=td(b));a=new Y;Fa(a,new sd);ud(a,td(this).vf(b));return a};sd.prototype.inverse=function(){var a=new Y;Fa(a,new sd);ud(a,td(this).inverse());return a};A("X.constructable",sd);A("X.constructable.prototype.intersect",sd.prototype.vf);A("X.constructable.prototype.inverse",sd.prototype.inverse);A("X.constructable.prototype.subtract",sd.prototype.va);
A("X.constructable.prototype.union",sd.prototype.Xf);function vd(a){Pb.call(this,a);this.f="event"}C(vd,Pb);var wd=jc("pan"),xd=jc("rotate"),yd=jc("zoom"),zd=jc("scroll");jc("render");var Ad=jc("resetview"),Bd=jc("windowlevel"),Cd=jc("modified"),Dd=jc("remove"),Ed=jc("progress"),Fd=jc("hover"),Gd=jc("hover_end"),Hd=jc("computing"),Id=jc("computing_end"),Jd=jc("computing_progress");function Kd(){vd.call(this,Bd);this.Qe=this.cf=0}C(Kd,vd);function Ld(){vd.call(this,wd);this.Da=new D.m(0,0,0)}C(Ld,vd);
function Md(){vd.call(this,xd);this.Da=new D.m(0,0,0)}C(Md,vd);function Nd(){vd.call(this,yd);this.ub=this.Bb=t}C(Nd,vd);function Od(){vd.call(this,zd);this.V=t}C(Od,vd);function Pd(){vd.call(this,Fd);this.fe=this.ee=0}C(Pd,vd);function Qd(){vd.call(this,Gd)}C(Qd,vd);function Rd(){vd.call(this,Ad)}C(Rd,vd);function pd(){vd.call(this,Cd);this.v=this.G=s}C(pd,vd);function qd(){vd.call(this,Dd);this.v=this.G=s}C(qd,vd);function Sd(){vd.call(this,Ed);this.zd=0}C(Sd,vd);
function Td(){vd.call(this,Hd);this.G=s}C(Td,vd);function Ud(){vd.call(this,Jd);this.zd=0}C(Ud,vd);function Vd(){vd.call(this,Id);this.G=s}C(Vd,vd);A("X.event.events.PAN",wd);A("X.event.events.ROTATE",xd);A("X.event.events.ZOOM",yd);A("X.event.events.SCROLL",zd);function Wd(a,b,c){a==s&&m(Error("Invalid GL Buffer."));b==s&&m(Error("Invalid number of items."));c==s&&m(Error("Invalid item size."));O.call(this);this.f="buffer";this.P=a;this.cd=b;this.Rb=c}C(Wd,O);var Xd;function Yd(a,b){var c;c=a.className;c=na(c)&&c.match(/\S+/g)||[];for(var e=Mb(arguments,1),d=c.length+e.length,f=c,g=0;g<e.length;g++)0<=Gb(f,e[g])||f.push(e[g]);a.className=c.join(" ");return c.length==d};function Zd(a,b){this.width=a;this.height=b}v=Zd.prototype;v.l=function(){return new Zd(this.width,this.height)};v.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};v.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};v.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};v.scale=function(a,b){var c=y(b)?b:a;this.width*=a;this.height*=c;return this};var $d=!K||K&&9<=Cb;!jb&&!K||K&&K&&9<=Cb||jb&&Ab("1.9.1");K&&Ab("9");function ae(a,b){this.x=ia(a)?a:0;this.y=ia(b)?b:0}v=ae.prototype;v.l=function(){return new ae(this.x,this.y)};function be(a,b){return new ae(a.x-b.x,a.y-b.y)}v.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};v.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};v.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};
v.translate=function(a,b){a instanceof ae?(this.x+=a.x,this.y+=a.y):(this.x+=a,y(b)&&(this.y+=b));return this};v.scale=function(a,b){var c=y(b)?b:a;this.x*=a;this.y*=c;return this};function ce(a){return a?new de(ee(a)):Xd||(Xd=new de)}function fe(a){return na(a)?document.getElementById(a):a}var ge={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function he(a,b,c){return ie(document,arguments)}
function ie(a,b){var c=b[0],e=b[1];if(!$d&&e&&(e.name||e.type)){c=["<",c];e.name&&c.push(' name="',Ra(e.name),'"');if(e.type){c.push(' type="',Ra(e.type),'"');var d={};Qa(d,e);delete d.type;e=d}c.push(">");c=c.join("")}var f=a.createElement(c);e&&(na(e)?f.className=e:ja(e)?Yd.apply(s,[f].concat(e)):Ma(e,function(a,b){"style"==b?f.style.cssText=a:"class"==b?f.className=a:"for"==b?f.htmlFor=a:b in ge?f.setAttribute(ge[b],a):0==b.lastIndexOf("aria-",0)||0==b.lastIndexOf("data-",0)?f.setAttribute(b,a):
f[b]=a}));if(2<b.length){e=function(b){b&&f.appendChild(na(b)?a.createTextNode(b):b)};for(c=2;c<b.length;c++){var g=b[c];if(la(g)&&!(pa(g)&&0<g.nodeType)){var d=Ib,h;a:{if((h=g)&&"number"==typeof h.length){if(pa(h)){h="function"==typeof h.item||"string"==typeof h.item;break a}if(oa(h)){h="function"==typeof h.item;break a}}h=t}if(h)if(h=g.length,0<h){for(var k=Array(h),j=0;j<h;j++)k[j]=g[j];g=k}else g=[];d(g,e)}else e(g)}}return f}function je(a){return"CSS1Compat"==a.compatMode}
function ke(a){a&&a.parentNode&&a.parentNode.removeChild(a)}function le(a){for(;a&&1!=a.nodeType;)a=a.nextSibling;return a}function me(a,b){if(a.contains&&1==b.nodeType)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a}function ee(a){return 9==a.nodeType?a:a.ownerDocument||a.document}function de(a){this.ia=a||fa.document||document}v=de.prototype;v.me=ce;
v.u=function(a){return na(a)?this.ia.getElementById(a):a};v.Mh=de.prototype.u;v.Vc=function(a,b,c){return ie(this.ia,arguments)};v.createElement=function(a){return this.ia.createElement(a)};v.createTextNode=function(a){return this.ia.createTextNode(String(a))};function ne(a){return je(a.ia)}
function oe(a){var b=a.ia;a=!mb&&je(b)?b.documentElement:b.body;b=b.parentWindow||b.defaultView;return K&&Ab("10")&&b.pageYOffset!=a.scrollTop?new ae(a.scrollLeft,a.scrollTop):new ae(b.pageXOffset||a.scrollLeft,b.pageYOffset||a.scrollTop)}v.appendChild=function(a,b){a.appendChild(b)};v.contains=me;function pe(a,b,c,e){this.top=a;this.right=b;this.bottom=c;this.left=e}v=pe.prototype;v.l=function(){return new pe(this.top,this.right,this.bottom,this.left)};v.contains=function(a){return!this||!a?t:a instanceof pe?a.left>=this.left&&a.right<=this.right&&a.top>=this.top&&a.bottom<=this.bottom:a.x>=this.left&&a.x<=this.right&&a.y>=this.top&&a.y<=this.bottom};
v.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};v.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};v.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};
v.translate=function(a,b){a instanceof ae?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,y(b)&&(this.top+=b,this.bottom+=b));return this};v.scale=function(a,b){var c=y(b)?b:a;this.left*=a;this.right*=a;this.top*=c;this.bottom*=c;return this};function qe(a,b,c,e){this.left=a;this.top=b;this.width=c;this.height=e}v=qe.prototype;v.l=function(){return new qe(this.left,this.top,this.width,this.height)};v.Ug=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var e=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(e<=a)return this.left=b,this.top=e,this.width=c-b,this.height=a-e,q}return t};
v.contains=function(a){return a instanceof qe?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};function re(a,b){var c=b.x<a.left?a.left-b.x:Math.max(b.x-(a.left+a.width),0),e=b.y<a.top?a.top-b.y:Math.max(b.y-(a.top+a.height),0);return c*c+e*e}v.rf=function(a){return Math.sqrt(re(this,a))};
v.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};v.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};v.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};
v.translate=function(a,b){a instanceof ae?(this.left+=a.x,this.top+=a.y):(this.left+=a,y(b)&&(this.top+=b));return this};v.scale=function(a,b){var c=y(b)?b:a;this.left*=a;this.width*=a;this.top*=c;this.height*=c;return this};function se(a,b){var c=ee(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,s))?c[b]||c.getPropertyValue(b)||"":""}function te(a,b){return se(a,b)||(a.currentStyle?a.currentStyle[b]:s)||a.style&&a.style[b]}function ue(a){a=a?ee(a):document;return K&&!(K&&9<=Cb)&&!ne(ce(a))?a.body:a.documentElement}
function ve(a){var b=a.getBoundingClientRect();K&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b}
function we(a){if(K&&!(K&&8<=Cb))return a.offsetParent;var b=ee(a),c=te(a,"position"),e="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=te(a,"position"),e=e&&"static"==c&&a!=b.documentElement&&a!=b.body,!e&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return s}
function xe(a){for(var b=new pe(0,Infinity,Infinity,0),c=ce(a),e=c.ia.body,d=c.ia.documentElement,f=!mb&&je(c.ia)?c.ia.documentElement:c.ia.body;a=we(a);)if((!K||0!=a.clientWidth)&&(!mb||0!=a.clientHeight||a!=e)&&a!=e&&a!=d&&"visible"!=te(a,"overflow")){var g=ye(a),h;h=a;if(jb&&!Ab("1.9")){var k=parseFloat(se(h,"borderLeftWidth"));if(ze(h))var j=h.offsetWidth-h.clientWidth-k-parseFloat(se(h,"borderRightWidth")),k=k+j;h=new ae(k,parseFloat(se(h,"borderTopWidth")))}else h=new ae(h.clientLeft,h.clientTop);
g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}e=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,e);b.top=Math.max(b.top,f);c=(c.ia.parentWindow||c.ia.defaultView||window).document;c=je(c)?c.documentElement:c.body;c=new Zd(c.clientWidth,c.clientHeight);b.right=Math.min(b.right,e+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?
b:s}
function ye(a){var b,c=ee(a),e=te(a,"position"),d=jb&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==e&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new ae(0,0),g=ue(c);if(a==g)return f;if(a.getBoundingClientRect)b=ve(a),a=oe(ce(c)),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!d)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);
if(mb&&"fixed"==te(b,"position")){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&b!=a);if(ib||mb&&"absolute"==e)f.y-=c.body.offsetTop;for(b=a;(b=we(b))&&b!=c.body&&b!=g;)if(f.x-=b.scrollLeft,!ib||"TR"!=b.tagName)f.y-=b.scrollTop}return f}
function Ae(a){var b=new ae;if(1==a.nodeType){if(a.getBoundingClientRect){var c=ve(a);b.x=c.left;b.y=c.top}else{var c=oe(ce(a)),e=ye(a);b.x=e.x-c.x;b.y=e.y-c.y}if(jb&&!Ab(12)){var d;K?d="-ms-transform":mb?d="-webkit-transform":ib?d="-o-transform":jb&&(d="-moz-transform");var f;d&&(f=te(a,d));f||(f=te(a,"transform"));f?(a=f.match(Be),a=!a?new ae(0,0):new ae(parseFloat(a[1]),parseFloat(a[2]))):a=new ae(0,0);b=new ae(b.x+a.x,b.y+a.y)}}else d=oa(a.Hi),f=a,a.targetTouches?f=a.targetTouches[0]:d&&a.rb.targetTouches&&
(f=a.rb.targetTouches[0]),b.x=f.clientX,b.y=f.clientY;return b}function Ce(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a}function De(a){if("none"!=te(a,"display"))return Ee(a);var b=a.style,c=b.display,e=b.visibility,d=b.position;b.visibility="hidden";b.position="absolute";b.display="inline";a=Ee(a);b.display=c;b.position=d;b.visibility=e;return a}
function Ee(a){var b=a.offsetWidth,c=a.offsetHeight,e=mb&&!b&&!c;return(!ia(b)||e)&&a.getBoundingClientRect?(a=ve(a),new Zd(a.right-a.left,a.bottom-a.top)):new Zd(b,c)}function Fe(a,b){a.style.display=b?"":"none"}function ze(a){return"rtl"==te(a,"direction")}function Ge(a,b){if(/^\d+px?$/.test(b))return parseInt(b,10);var c=a.style.left,e=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;a.style.left=b;var d=a.style.pixelLeft;a.style.left=c;a.runtimeStyle.left=e;return d}
function He(a,b){var c=a.currentStyle?a.currentStyle[b]:s;return c?Ge(a,c):0}var Ie={thin:2,medium:4,thick:6};function Je(a,b){if("none"==(a.currentStyle?a.currentStyle[b+"Style"]:s))return 0;var c=a.currentStyle?a.currentStyle[b+"Width"]:s;return c in Ie?Ie[c]:Ge(a,c)}var Be=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;function Ke(a,b){kc.call(this);this.J=a;var c=pa(this.J)&&1==this.J.nodeType?this.J:this.J?this.J.body:s;this.cj=!!c&&ze(c);this.Ll=L(this.J,jb?"DOMMouseScroll":"mousewheel",this,b)}C(Ke,kc);
Ke.prototype.handleEvent=function(a){var b=0,c=0,e=0;a=a.rb;if("mousewheel"==a.type){c=1;if(K||mb&&(bb||Ab("532.0")))c=40;e=Le(-a.wheelDelta,c);ia(a.wheelDeltaX)?(b=Le(-a.wheelDeltaX,c),c=Le(-a.wheelDeltaY,c)):c=e}else e=a.detail,100<e?e=3:-100>e&&(e=-3),ia(a.axis)&&a.axis===a.HORIZONTAL_AXIS?b=e:c=e;y(this.Zg)&&(b=Math.min(Math.max(b,-this.Zg),this.Zg));y(this.$g)&&(c=Math.min(Math.max(c,-this.$g),this.$g));this.cj&&(b=-b);b=new Me(e,a,b,c);this.dispatchEvent(b)};
function Le(a,b){return mb&&(ab||db)&&0!=a%b?a:a/b}function Me(a,b,c,e){b&&this.Aa(b,p);this.type="mousewheel";this.detail=a;this.Al=c;this.Wc=e}C(Me,Ub);K||mb&&Ab("525");function Ne(a){O.call(this);this.f="interactor";this.Oa=a;this.Re=this.pg=this.og=this.qg=this.ng=this.rg=s;this.Xd=q;this.Zb=this.Tb=this.vb=t;this.od=[0,0];this.Me=new D.m(0,0,0);this.ed=new D.m(0,0,0);this.Wg=0;this.yg=this.Vd=s;this.xg=t;this.S={MOUSECLICKS_ENABLED:q,KEYBOARD_ENABLED:q,HOVERING_ENABLED:q,CONTEXTMENU_ENABLED:t,TOUCH_ENABLED:q,TOUCH_BOUNCING_ENABLED:t}}C(Ne,O);Ne.prototype.__defineGetter__("config",u("S"));Ne.prototype.__defineGetter__("leftButtonDown",u("vb"));
Ne.prototype.__defineGetter__("middleButtonDown",u("Tb"));Ne.prototype.__defineGetter__("rightButtonDown",u("Zb"));
Ne.prototype.Aa=function(){this.S.MOUSEWHEEL_ENABLED?(this.Re=new Ke(this.Oa),this.rg=L(this.Re,"mousewheel",this.Jd.bind(this))):(cc(this.rg),this.Re=s);this.S.MOUSECLICKS_ENABLED?(this.ng=L(this.Oa,"mousedown",this.xj.bind(this)),this.qg=L(this.Oa,"mouseup",this.Cj.bind(this))):(cc(this.ng),cc(this.qg));this.Oa.oncontextmenu=this.S.CONTEXTMENU_ENABLED?s:function(){return t};window.onkeydown=this.S.KEYBOARD_ENABLED?this.jh.bind(this):s;this.S.TOUCH_ENABLED?(this.S.TOUCH_BOUNCING_ENABLED||document.body.addEventListener("touchmove",
function(a){a.preventDefault()},t),this.di=L(this.Oa,"touchstart",this.Rj.bind(this)),this.ci=L(this.Oa,"touchmove",this.Pj.bind(this)),this.bi=L(this.Oa,"touchend",this.Lj.bind(this))):(cc(this.di),cc(this.ci),cc(this.bi));cc(this.og);cc(this.pg);this.og=L(this.Oa,"mousemove",this.zj.bind(this));this.pg=L(this.Oa,"mouseout",this.Aj.bind(this))};
Ne.prototype.xj=function(a){0==a.button?this.vb=q:1==a.button?this.Tb=q:2==a.button&&(this.Zb=q);eval("this.onMouseDown("+this.vb+","+this.Tb+","+this.Zb+")");Oe(this);a.preventDefault()};Ne.prototype.wj=ba();Ne.prototype.Cj=function(a){0==a.button?this.vb=t:1==a.button?this.Tb=t:2==a.button&&(this.Zb=t);eval("this.onMouseUp("+this.vb+","+this.Tb+","+this.Zb+")");Oe(this);a.preventDefault()};Ne.prototype.__defineGetter__("mousePosition",u("od"));v=Ne.prototype;v.Bj=ba();
v.Aj=function(a){this.Xd=t;this.S.KEYBOARD_ENABLED&&(window.onkeydown=s);this.Zb=this.Tb=this.vb=t;Oe(this);this.Me=new D.m(0,0,0);a.preventDefault()};v.yj=ba();v.Rj=function(a){a.preventDefault();a.Aa(a.rb.targetTouches[0],a.currentTarget);eval("this.onTouchStart("+a.clientX+","+a.clientY+")");this.ed=new D.m(a.clientX,a.clientY,0);this.yg=setTimeout(this.Nj.bind(this,a),500)};v.Qj=ba();
v.Nj=function(a){eval("this.onTouchHover("+a.clientX+","+a.clientY+")");a=new Nd;a.Bb=q;a.ub=this instanceof Pe;this.dispatchEvent(a);this.ae=q};v.Mj=ba();function Qe(a){clearTimeout(a.yg);if(a.ae){var b=new Nd;b.Bb=t;b.ub=a instanceof Pe;a.dispatchEvent(b)}a.ae=t}v.Lj=function(a){a.preventDefault();eval("this.onTouchEnd()");Qe(this)};v.Kj=ba();
v.Pj=function(a){a.preventDefault();this.ae||Qe(this);this.touchmoveEvent=a=a.rb;eval("this.onTouchMove(this['touchmoveEvent'])");var b=a.targetTouches;if(1==b.length){a=b[0];var c=[a.clientX,a.clientY];a=new D.m(c[0],c[1],0);var b=c[0]>3*this.Oa.clientWidth/4,e=c[0]<this.Oa.clientWidth/4,d=c[1]<this.Oa.clientHeight/4,c=c[1]>3*this.Oa.clientHeight/4,c=!b&&!e&&!d&&!c,d=this.ed.va(a);this.ed=a.l();if(this.ae)a=new Ld,5<d.x?d.x=1:-5>d.x&&(d.x=-1),5<d.y?d.y=1:-5>d.y&&(d.y=-1),a.Da=d,this.dispatchEvent(a);
else if(this instanceof Re&&(b||e))a=new Od,a.V=0>d.y,this.dispatchEvent(a);else if(this instanceof Pe||c)d.scale(3),a=new Md,a.Da=d,this.dispatchEvent(a)}else 2==b.length&&(a=b[0],b=b[1],a=[a.clientX,a.clientY],b=[b.clientX,b.clientY],a=new D.m(a[0],a[1],0),b=new D.m(b[0],b[1],0),d=Ic(a,b),b=d-this.Wg,this.Wg=d,this.ed.va(a),this.ed=a.l(),10<Math.abs(b)&&(a=new Nd,a.Bb=0<b,a.ub=this instanceof Pe,this.dispatchEvent(a)))};v.Oj=ba();
v.zj=function(a){this.mousemoveEvent=a;eval("this.onMouseMove(this['mousemoveEvent'])");this.Xd=q;this.S.KEYBOARD_ENABLED&&window.onkeydown==s&&(window.onkeydown=this.jh.bind(this));a.preventDefault();var b=a.shiftKey;this.xg=b;this.od=[a.offsetX,a.offsetY];var c=new D.m(this.od[0],this.od[1],0);a=this.Me.va(c);this.Me=c.l();this.S.HOVERING_ENABLED&&((0<Math.abs(a.x)||0<Math.abs(a.y)||this.Tb||this.vb||this.Zb)&&Oe(this),this.Vd=setTimeout(function(){Oe(this);var a=new Pd;a.ee=c.x;a.fe=c.y;this.dispatchEvent(a);
this.Vd=s}.bind(this),300));if(0!=a.Mb()&&(!this.vb||b))if(!(this.Tb||this.vb&&b)&&this.Zb)b=new Md,a.scale(3),b.Da=a,this.dispatchEvent(b)};function Oe(a){a.Vd&&clearTimeout(a.Vd);a.dispatchEvent(new Qd)}v.Dj=ba();v.Jd=ba();v.uj=ba();
v.jh=function(a){if(this.Xd){this.keyEvent=a;eval("this.onKey(this['keyEvent'])");Oe(this);var b=a.altKey,c=a.ctrlKey,e=a.metaKey,d=a.shiftKey,f=a.keyCode;82==f&&!b&&!c&&!e&&!d?(a.preventDefault(),a=new Rd,this.dispatchEvent(a)):37<=f&&40>=f&&(a.preventDefault(),a=s,!d&&!b&&(a=new Md,this instanceof Re&&(a=new Od)),a&&(d=new D.m(0,0,0),37==f?(d.x=5,a.V=t,b&&(a.V=q,a.Bb=q,a.ub=t)):39==f?(d.x=-5,a.V=q,b&&(a.Bb=t,a.ub=t)):38==f?(d.y=5,a.V=q,b&&(a.Bb=q,a.ub=q)):40==f&&(d.y=-5,a.V=t,b&&(a.Bb=t,a.ub=q)),
a.Da=d,this.dispatchEvent(a)))}};A("X.interactor",Ne);A("X.interactor.prototype.init",Ne.prototype.Aa);A("X.interactor.prototype.onMouseDown",Ne.prototype.wj);A("X.interactor.prototype.onMouseUp",Ne.prototype.Bj);A("X.interactor.prototype.onMouseMove",Ne.prototype.yj);A("X.interactor.prototype.onMouseWheel",Ne.prototype.Dj);A("X.interactor.prototype.onKey",Ne.prototype.uj);A("X.interactor.prototype.onTouchStart",Ne.prototype.Qj);A("X.interactor.prototype.onTouchMove",Ne.prototype.Oj);
A("X.interactor.prototype.onTouchEnd",Ne.prototype.Kj);A("X.interactor.prototype.onTouchHover",Ne.prototype.Mj);function Re(a){Ne.call(this,a);this.f="interactor2D"}C(Re,Ne);Re.prototype.Jd=function(a){Re.z.Jd.call(this,a);var b=new Od;a.Wc==s&&(a.Wc=0);b.V=0>a.Wc;this.dispatchEvent(b)};function Se(a,b){(!y(a)||!y(b))&&m(Error("A camera needs valid width and height values."));O.call(this);this.f="camera";this.lc=new D.m(0,100,0);this.Jc=new D.m(0,0,0);this.V=new D.m(0,0,1);this.D=a;this.w=b;this.p=this.te(this.lc,this.Jc)}C(Se,O);Se.prototype.observe=function(a){(a==s||!(a instanceof Ne))&&m(Error("Could not observe the interactor."));L(a,xd,this.Hj.bind(this));L(a,wd,this.Ej.bind(this));L(a,yd,this.Uj.bind(this))};
Se.prototype.Hj=function(a){a instanceof Md||m(Error("Received no valid rotate event."));this.rotate(a.Da)};Se.prototype.Uj=function(a){a instanceof Nd||m(Error("Received no valid zoom event."));a.Bb?this.$f(a.ub):this.ag(a.ub)};Se.prototype.Ej=function(a){a instanceof Ld||m(Error("Received no valid pan event."));this.Kf(a.Da)};Se.prototype.__defineGetter__("view",u("p"));
Se.prototype.__defineSetter__("view",function(a){(a==s||!(a instanceof Float32Array))&&m(Error("Invalid view matrix."));this.p=a});Se.prototype.__defineGetter__("position",function(){return[this.lc.x,this.lc.y,this.lc.d]});Se.prototype.__defineSetter__("position",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid position."));this.lc=new D.m(a[0],a[1],a[2]);this.reset()});Se.prototype.__defineGetter__("focus",function(){return[this.Jc.x,this.Jc.y,this.Jc.d]});
Se.prototype.__defineSetter__("focus",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid focus"));this.Jc=new D.m(a[0],a[1],a[2]);this.reset()});Se.prototype.__defineGetter__("up",function(){return[this.V.x,this.V.y,this.V.d]});Se.prototype.__defineSetter__("up",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid up vector."));this.V=new D.m(a[0],a[1],a[2]);this.reset()});v=Se.prototype;v.reset=function(){this.p=this.te(this.lc,this.Jc)};
v.rotate=function(a){ja(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||m(Error("Invalid distance vector for rotate operation."));return a};v.Kf=function(a){ja(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||m(Error("Invalid distance vector for pan operation."));this.p[12]-=a.x;this.p[13]+=a.y};v.$f=function(a){var b=20;a!=s&&!a&&(b=1);this.p[14]+=b};v.ag=function(a){var b=20;a!=s&&!a&&(b=1);this.p[14]-=b};
v.te=function(a,b){(!(a instanceof D.m)||!(b instanceof D.m))&&m(Error("3D vectors required for calculating the view."));return D.g.Dd()};A("X.camera",Se);A("X.camera.prototype.pan",Se.prototype.Kf);A("X.camera.prototype.rotate",Se.prototype.rotate);A("X.camera.prototype.zoomIn",Se.prototype.$f);A("X.camera.prototype.zoomOut",Se.prototype.ag);function Te(a,b){Se.call(this,a,b);this.f="camera3D";this.fg=45;this.Ve=D.g.yf(D.g.Dd(),this.fg,a/b,1,1E4)}C(Te,Se);Te.prototype.rotate=function(a){a=Te.z.rotate.call(this,a);var b=-a.x/5*Math.PI/180;a=-a.y/5*Math.PI/180;var c=new D.m(this.p[1],this.p[5],this.p[9]),e=new D.m(this.p[0],this.p[4],this.p[8]);c.normalize();e.normalize();D.g.rotate(this.p,b,c.x,c.y,c.d);D.g.rotate(this.p,a,e.x,e.y,e.d)};Te.prototype.te=function(a,b){var c=Te.z.te.call(this,a,b);D.g.Yg(c,a,b,this.V);return c};
function Ue(a,b,c,e){var d=new Float32Array(4),f=new Float32Array(4),g=new Float32Array(16),h=new Float32Array(16);new Float32Array(16);D.g.multiply(a.Ve,a.p,h);D.g.Y(h,g);d[0]=b;d[1]=c;d[2]=2*e-1;d[3]=1;D.g.bh(g,d,f);f[3]=1/f[3];f[0]*=f[3];f[1]*=f[3];f[2]*=f[3];return f}A("X.camera3D",Te);function Ve(){O.call(this);this.f="parser";this.L=s;this.F=0;this.$h=0<(new Int8Array((new Int16Array([1])).buffer))[0];this.Pc=q;this.tl=-Infinity;this.sl=Infinity}C(Ve,O);Ve.prototype.parse=function(){m(Error("The function parse() should be overloaded."))};function We(a){for(var b=Infinity,c=-Infinity,e=a.length,d=0,d=0;d<e;d++)if(!isNaN(a[d]))var f=a[d],b=Math.min(b,f),c=Math.max(c,f);return[b,c]}
function Xe(a,b,c){b===p&&(b=0);c===p&&(c=a.length);for(var e="",d=0,d=b;d<c;++d)e+=String.fromCharCode(a[d]);return e}
function Z(a,b,c){c!=s||(c=1);var e=1,d=Uint8Array;switch(b){case "schar":d=Int8Array;break;case "ushort":d=Uint16Array;e=2;break;case "sshort":d=Int16Array;e=2;break;case "uint":d=Uint32Array;e=4;break;case "sint":d=Int32Array;e=4;break;case "float":d=Float32Array;e=4;break;case "complex":d=Float64Array;e=8;break;case "double":d=Float64Array,e=8}b=new d(a.L.slice(a.F,a.F+=c*e));if(a.$h!=a.Pc){a=b;b=new Uint8Array(a.buffer,a.byteOffset,a.byteLength);for(d=0;d<a.byteLength;d+=e)for(var f=d+e-1,g=d;f>
g;f--,g++){var h=b[g];b[g]=b[f];b[f]=h}b=a}return 1==c?b[0]:b}
function Ye(a,b){var c=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE],e=Sc(0,0,0,1),d=Rc();gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(0,0,b[2]-1,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(0,b[1]-
1,0,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(b[0]-1,0,0,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(b[0]-1,b[1]-1,0,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];
c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(b[0]-1,0,b[2]-1,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(0,b[1]-1,b[2]-1,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];e=Sc(b[0]-1,b[1]-1,b[2]-1,1);gd(a,e,d);c[0]=d[0]<c[0]?d[0]:c[0];c[1]=d[0]>c[1]?d[0]:c[1];c[2]=d[1]<c[2]?d[1]:
c[2];c[3]=d[1]>c[3]?d[1]:c[3];c[4]=d[2]<c[4]?d[2]:c[4];c[5]=d[2]>c[5]?d[2]:c[5];return c}function Ze(a,b,c,e){var d=Array(b[2]),f=Array(b[2]);window.console.log(a);window.console.log(this);for(var g=b[1]*b[0],h=0,k=0,j=0,l=0,n=0,l=0;l<b[2];l++){var w=a.subarray(l*g,(l+1)*g),n=0;f[l]=Array(b[1]);d[l]=Array(b[1]);for(j=0;j<b[1];j++){f[l][j]=new a.constructor(b[0]);d[l][j]=new a.constructor(b[0]);for(k=0;k<b[0];k++)h=w[n],f[l][j][k]=255*((h-e)/(c-e)),d[l][j][k]=h,n++}}return[d,f]}
function $e(a,b){var c=Uc();if(!(a.length==b.length&&a[0]==b[0]&&a[1]==b[1]&&a[2]==b[2])){var e=Math.acos(a[2]),d=Oc(),f=a[0],g=a[1],h=a[2],k=b[0],j=b[1],l=b[2];d[0]=g*l-h*j;d[1]=h*k-f*l;d[2]=f*j-g*k;Qc(d,d);f=Math.cos(e/2);g=Math.sin(e/2)*d[0];h=Math.sin(e/2)*d[1];e=Math.sin(e/2)*d[2];T(c,0,f*f+g*g-h*h-e*e,2*(g*h-f*e),2*(g*e+f*h),0);T(c,1,2*(g*h+f*e),f*f+h*h-g*g-e*e,2*(h*e-f*g),0);T(c,2,2*(g*e-f*h),2*(h*e+f*g),f*f+e*e-h*h-g*g,0)}e=Tc();ed(c,e);return[c,e]}
function af(a,b){return Math.abs(a-b[0])<=Math.abs(a-b[1])&&Math.abs(a-b[0])<=Math.abs(a-b[2])?b[0]:Math.abs(a-b[1])<=Math.abs(a-b[0])&&Math.abs(a-b[1])<=Math.abs(a-b[2])?b[1]:b[2]}
function bf(a,b,c,e,d,f,g,h,k,j){var l=new cf;Qc(e,e);for(var n=[],w=[],r=0;6>r;r++)for(var x=Math.floor(r/2),z=(x+1)%3,E=(x+2)%3,H=(4+2*x)%6,J=0;2>J;J++){var B=(2+J+2*x)%6,F=-(e[x]*(f[r]-b[x])+e[z]*(f[B]-b[z]))/e[E]+b[E];if(F>=f[H]&&F<=f[H+1]||F<=f[H]&&F>=f[H+1]){var G=[];G[x]=f[r];G[z]=f[B];G[E]=F;n.push(G)}else G=[],G[x]=f[r],G[z]=f[B],G[E]=F,w.push(G)}b=Pc(0,0,1);b=$e(e,b);w=b[0];b=b[1];x=[];for(f=0;f<n.length;++f)r=Sc(n[f][0],n[f][1],n[f][2],1),z=Rc(),gd(w,r,z),x.push([z[0],z[1],z[2]]);f=Pc(1,
0,0);n=Oc();fd(b,f,n);f=Pc(0,1,0);w=Oc();fd(b,f,w);r=[Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE,Number.MAX_VALUE,-Number.MAX_VALUE];for(f=f=0;f<x.length;++f)x[f][0]<r[0]&&(r[0]=x[f][0]),x[f][0]>r[1]&&(r[1]=x[f][0]),x[f][1]<r[2]&&(r[2]=x[f][1]),x[f][1]>r[3]&&(r[3]=x[f][1]),x[f][2]<r[4]&&(r[4]=x[f][2]),x[f][2]>r[5]&&(r[5]=x[f][2]);f=Sc(r[0]+(r[1]-r[0])/2,r[2]+(r[3]-r[2])/2,r[4]+(r[5]-r[4])/2,0);x=Rc();dd(b,f,x);z=r[0];E=r[1];window.console.log(r);z==E&&E++;H=E-z;J=r[2];B=
r[3];J==B&&B++;F=B-J;G=c[0];c=c[1];var M=Math.ceil(H/G);f=Math.ceil(F/c);M=af(M,[h.s[0],h.s[1],h.s[2]]);f=af(f,[h.s[0],h.s[1],h.s[2]]);var Q=new Uint8Array(4*M*f),N=new kd;N.Xe=M;N.We=f;window.console.log("w h"+M+"  "+f);Rc();var U=Sc(0,0,r[4],1),da=Tc();dd(h.Rh,b,da);var I=0,aa=0,ma=0,S=J;window.console.log(J);window.console.log(z);window.console.log(G+" "+c);M=af(M,[h.s[0]-1,h.s[1]-1,h.s[2]-1]);f=af(f,[h.s[0]-1,h.s[1]-1,h.s[2]-1]);window.console.log([h.s[0]-1,h.s[1]-1,h.s[2]-1]);window.console.log("w h2"+
M+"  "+f);for(var V=f;0<=V;V--){S+=c;ma++;aa=0;U[1]=S;f=z;for(var Pa=M;0<=Pa;Pa--){f+=G;aa++;U[0]=f;if(1==e[2])var Rb=Math.round(a),Sb=Math.round(V),Tb=Math.round(Pa);1==e[1]&&(Rb=Math.round(V),Sb=Math.round(a),Tb=Math.round(Pa));1==e[0]&&(Rb=Math.round(Pa),Sb=Math.round(V),Tb=Math.round(a));var kb=I;if(0<=Tb&&Tb<h.s[0]&&0<=Sb&&Sb<h.s[1]&&0<=Rb&&Rb<h.s[2]){var lb=g[Rb][Sb][Tb],Zc=0,sc=0,$c=0,ad=0;j?((lb=j.get(lb))||(lb=[0,0.61,0,0,1]),Zc=255*lb[1],sc=255*lb[2],$c=255*lb[3],ad=255*lb[4]):(Zc=sc=$c=
255*((lb-h.qa)/(h.ga-h.qa)),ad=255);Q[kb]=Zc;Q[++kb]=sc;Q[++kb]=$c;Q[++kb]=ad}else Q[kb]=255,Q[++kb]=0,Q[++kb]=0,Q[++kb]=255;I+=4}}N.Yb=Q;l.I=N;l.fi=r;l.Th=b;l.Sh=da;l.Zh=J;l.ql=B;l.ei=z;l.vl=E;l.kg=aa;l.jg=ma;l.tc=G;l.D=H;l.kc=c;l.w=F;window.console.log("teeeest");window.console.log(l.tc);window.console.log(l.kc);window.console.log(l.D);window.console.log(l.w);l.B=[x[0],x[1],x[2]];l.ic=[e[0],e[1],e[2]];l.Sc=[n[0],n[1],n[2]];l.V=[w[0],w[1],w[2]];l.O=t;l.xb=h;l.Ab=h.xb!=s&&!k?t:q;l.gc=d;l.Kb();l.O=
t;return l}
function ff(a,b,c,e){var d;d=e.ka;for(var f=[],g=[],h=0;6>h;h++){var k=Math.floor(h/2),j=(k+1)%3,l=(k+2)%3,n=(2+2*k)%6,w=(4+2*k)%6,r=(d[h]-b[k])*(1/c[k]);if(Infinity!=r&&-Infinity!=r){var x=b[j]+c[j]*r,r=b[l]+c[l]*r;x>=d[n]&&x<=d[n+1]&&r>=d[w]&&r<=d[w+1]?(n=[],n[k]=d[h],n[j]=x,n[l]=r,f.push(n)):(n=[],n[k]=d[h],n[j]=x,n[l]=r,g.push(n))}}d=[f,g];b=d[0];e.b[a].k=d;d=Hc(new R(b[0][0],b[0][1],b[0][2]),new R(b[1][0],b[1][1],b[1][2]));e.b[a].pl=d;f=Pc(0,0,1);g=$e(c,f)[0];h=Sc(e.$c[0],e.$c[1],e.$c[2],0);
f=Rc();gd(g,h,f);g=Rc();h=f[2];g[0]=c[0]*h;g[1]=c[1]*h;g[2]=c[2]*h;g[3]=c[3]*h;0.1>Math.abs(f[0])&&(f[0]=0.1);0.1>Math.abs(f[1])&&(f[1]=0.1);f[0]/=e.$d;f[1]/=e.$d;e.b[a].Fa=[Math.abs(f[0]),Math.abs(f[1])];e.b[a].Uc=f[2];e.b[a].C=g;window.console.log(Math.abs(d/f[2]));d=Math.round(Math.abs(d/f[2]));e.td[a]=d+1;e.b[a].n=d+1;e.b[a].k[0][0][0]>e.b[a].k[0][1][0]?0<g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][0]<e.b[a].k[0][1][0]?0>g[0]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=
e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]>e.b[a].k[0][1][1]?0<g[1]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][1]<e.b[a].k[0][1][1]?0>g[1]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]>e.b[a].k[0][1][2]?0<g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d):e.b[a].k[0][0][2]<e.b[a].k[0][1][2]&&0>g[2]&&(d=e.b[a].k[0][0],e.b[a].k[0][0]=e.b[a].k[0][1],e.b[a].k[0][1]=d);e.b[a].Te=-(c[0]*b[0][0]+c[1]*
b[0][1]+c[2]*b[0][2])}
function gf(a,b){var c=Ze(b.L,b.s,b.ga,b.qa);b.na=c[0];b.bg=c[1];D.Ia(a.f+".reslice");b.R=b.e!=s;b.wa&&(b.Ie=b.wa.Ja);b.Ul=[0,0,0];b.t=[b.Ca[0]+(b.gb[0]-1)/2,b.Ca[1]+(b.gb[1]-1)/2,b.Ca[2]+(b.gb[2]-1)/2];b.ka=[Math.min(b.Ca[0],b.Ca[0]+b.gb[0]-1),Math.max(b.Ca[0],b.Ca[0]+b.gb[0]-1),Math.min(b.Ca[1],b.Ca[1]+b.gb[1]-1),Math.max(b.Ca[1],b.Ca[1]+b.gb[1]-1),Math.min(b.Ca[2],b.Ca[2]+b.gb[2]-1),Math.max(b.Ca[2],b.Ca[2]+b.gb[2]-1)];b.b=[{},{},{}];window.console.log("sagittal");c=Pc(b.t[0],b.t[1],b.t[2]);b.b[0].ud=
c;var e=Pc(1,0,0);Qc(e,e);b.b[0].i=e;var d=[1,0,0];b.b[0].A=d;ff(0,c,e,b);b.c[0].c=Array(b.b[0].n);c[0]=b.b[0].k[0][0][0]+b.b[0].C[0]*Math.floor(b.b[0].n/2);c[1]=b.b[0].k[0][0][1]+b.b[0].C[1]*Math.floor(b.b[0].n/2);c[2]=b.b[0].k[0][0][2]+b.b[0].C[2]*Math.floor(b.b[0].n/2);c=bf(Math.floor(b.b[0].n/2),c,b.b[0].Fa,b.b[0].i,b.b[0].A,b.ka,b.na,b,b.R,b.Ie);b.R&&(c.e=b.e.c[0].c[Math.floor(b.b[0].n/2)].I);b.c[0].c[Math.floor(b.b[0].n/2)]=c;b.Cb=Math.floor(b.b[0].n/2);b.Kc=Math.floor(b.b[0].n/2);window.console.log("coronal");
c=Pc(b.t[0],b.t[1],b.t[2]);b.b[1].ud=c;e=Pc(0,1,0);Qc(e,e);b.b[1].i=e;d=[0,1,0];b.b[1].A=d;ff(1,c,e,b);b.c[1].c=Array(b.b[1].n);c[0]=b.b[1].k[0][0][0]+b.b[1].C[0]*Math.floor(b.b[1].n/2);c[1]=b.b[1].k[0][0][1]+b.b[1].C[1]*Math.floor(b.b[1].n/2);c[2]=b.b[1].k[0][0][2]+b.b[1].C[2]*Math.floor(b.b[1].n/2);c=bf(Math.floor(b.b[1].n/2),c,b.b[1].Fa,b.b[1].i,b.b[1].A,b.ka,b.na,b,b.R,b.Ie);b.R&&(c.e=b.e.c[1].c[Math.floor(b.b[1].n/2)].I);b.c[1].c[Math.floor(b.b[1].n/2)]=c;b.Db=Math.floor(b.b[1].n/2);b.Lc=Math.floor(b.b[1].n/
2);window.console.log("axial");c=Pc(b.t[0],b.t[1],b.t[2]);b.b[2].ud=c;e=Pc(0,0,1);Qc(e,e);b.b[2].i=e;d=[0,0.392,0.804];b.b[2].A=d;ff(2,c,e,b);b.c[2].c=Array(b.b[2].n);document.getElementById("canvasXTKXOver").setAttribute("nbslices",b.b[2].n);document.getElementById("canvasXTKYOver").setAttribute("nbslices",b.b[2].n);c[0]=b.b[2].k[0][0][0]+b.b[2].C[0]*Math.floor(b.b[2].n/2);c[1]=b.b[2].k[0][0][1]+b.b[2].C[1]*Math.floor(b.b[2].n/2);c[2]=b.b[2].k[0][0][2]+b.b[2].C[2]*Math.floor(b.b[2].n/2);c=bf(Math.floor(b.b[2].n/
2),c,b.b[2].Fa,b.b[2].i,b.b[2].A,b.ka,b.na,b,b.R,b.Ie);b.R&&(c.e=b.e.c[2].c[Math.floor(b.b[2].n/2)].I);b.c[2].c[Math.floor(b.b[2].n/2)]=c;b.Eb=Math.floor(b.b[2].n/2);b.Mc=Math.floor(b.b[2].n/2);D.Ba(a.f+".reslice");return b.na};function hf(){Ve.call(this);this.f="parserIMAGE"}C(hf,Ve);hf.prototype.parse=function(a,b,c,e){c instanceof ArrayBuffer||m(Error());for(var d=new Uint8Array(c),f=d.length,g=Array(f);f--;)g[f]=String.fromCharCode(d[f]);d=window.btoa(g.join(""));f=new Image;ac(f,"load",this.Wj.bind(this,f,a,b,c,e));f.src="data:image/"+e+";base64,"+d};hf.prototype.Wj=function(a,b,c){b.hb=a;b.Yb=s;a=new pd;a.G=c;a.v=b;this.dispatchEvent(a)};A("X.parserIMAGE",hf);A("X.parserIMAGE.prototype.parse",hf.prototype.parse);function jf(a,b){Se.call(this,a,b);this.f="camera2D"}C(jf,Se);jf.prototype.rotate=function(a){a=jf.z.rotate.call(this,a);var b=new Kd;0<a.x?b.cf--:0>a.x&&b.cf++;0<a.y?b.Qe++:0>a.y&&b.Qe--;this.dispatchEvent(b)};jf.prototype.$f=function(a){var b=20;a!=s&&!a&&(b=0.02);this.p[14]+=b};jf.prototype.ag=function(a){var b=20;a!=s&&!a&&(b=0.02);this.p[14]-=b};
jf.prototype.Kf=function(a){ja(a)&&2==a.length?a=new D.m(a[0],a[1],0):a instanceof D.m||m(Error("Invalid distance vector for pan operation."));this.p[12]-=a.x/this.p[14];this.p[13]+=a.y/this.p[14]};function kf(){O.call(this);this.f="shaders";this.be="";var a;a="precision mediump float;\n\n";a+="attribute vec3 vertexPosition;\n";a+="attribute vec3 vertexNormal;\n";a+="attribute vec3 vertexColor;\n";a+="attribute vec2 vertexTexturePos;\n";a+="attribute float vertexScalar;\n";a+="\n";a+="uniform mat4 view;\n";a+="uniform mat4 perspective;\n";a+="uniform vec3 center;\n";a+="uniform mat4 objectTransform;\n";a+="uniform bool useObjectColor;\n";a+="uniform bool useScalars;\n";a+="uniform bool scalarsReplaceMode;\n";
a+="uniform float scalarsMin;\n";a+="uniform float scalarsMax;\n";a+="uniform vec3 scalarsMinColor;\n";a+="uniform vec3 scalarsMaxColor;\n";a+="uniform float scalarsMinThreshold;\n";a+="uniform float scalarsMaxThreshold;\n";a+="uniform int scalarsInterpolation;\n";a+="uniform vec3 objectColor;\n";a+="uniform float pointSize;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";
a+="varying vec3 fTransformedVertexNormal;\n";a+="\n";a+="void main(void) {\n";a+="  fTransformedVertexNormal = mat3(view[0].xyz,view[1].xyz,view[2].xyz) * ";a+="mat3(objectTransform[0].xyz,objectTransform[1].xyz,objectTransform[2].xyz) * ";a+="vertexNormal;\n";a+="  fVertexNormal = vertexNormal;\n";a+="  fDiscardNow = 0.0;\n";a+="  vec3 vertexPosition2 = vertexPosition - center;\n";a+="  fVertexPosition = view * objectTransform * vec4(vertexPosition2, 1.0);\n";a+="  fragmentTexturePos = vertexTexturePos;\n";
a+="  if (useScalars) {\n";a+="    float scalarValue = vertexScalar;\n";a+="    if (scalarValue < scalarsMinThreshold || scalarValue > scalarsMaxThreshold) {\n";a+="      if (scalarsReplaceMode) {\n";a+="        fragmentColor = objectColor;\n";a+="      } else {\n";a+="        fDiscardNow = 1.0;\n";a+="      }\n";a+="    } else {\n";a+="      if (scalarsReplaceMode) {\n";a+="        if (scalarsInterpolation == 1) {\n";a+="            vec3 zeroMaxColor;\n";a+="            vec3 zeroMinColor;\n";a+=
"            zeroMaxColor[0] = scalarsMaxColor[0]*0.33;\n";a+="            zeroMaxColor[1] = scalarsMaxColor[1]*0.33;\n";a+="            zeroMaxColor[2] = scalarsMaxColor[2]*0.33;\n";a+="            zeroMinColor[0] = scalarsMinColor[0]*0.33;\n";a+="            zeroMinColor[1] = scalarsMinColor[1]*0.33;\n";a+="            zeroMinColor[2] = scalarsMinColor[2]*0.33;\n";a+="            if(scalarValue < 0.0) {fragmentColor = scalarValue/(scalarsMin) * scalarsMinColor + (1.0 - scalarValue/(scalarsMin)) * (zeroMinColor);}\n";
a+="            else {fragmentColor = scalarValue/(scalarsMax) * scalarsMaxColor + (1.0 - scalarValue/(scalarsMax)) * (zeroMaxColor);}\n";a+="        } else {\n";a+="            fragmentColor = scalarValue * scalarsMaxColor + (1.0 - scalarValue) * scalarsMinColor;\n";a+="          }\n";a+="      } else {\n";a+="        fragmentColor = vertexColor;\n";a+="      }\n";a+="    }\n";a+="  } else if (useObjectColor) {\n";a+="    fragmentColor = objectColor;\n";a+="  } else {\n";a+="    fragmentColor = vertexColor;\n";
a+="  }\n";a+="  gl_PointSize = pointSize;\n";a+="  gl_Position = perspective * fVertexPosition;\n";this.be=a+="}\n";this.Td="";a="precision mediump float;\n\n";a+="uniform bool usePicking;\n";a+="uniform bool useTexture;\n";a+="uniform bool volumeTexture;\n";a+="uniform bool useLabelMapTexture;\n";a+="uniform sampler2D textureSampler;\n";a+="uniform sampler2D textureSampler2;\n";a+="uniform float objectOpacity;\n";a+="uniform float labelmapOpacity;\n";a+="uniform vec4 labelmapColor;\n";a+="uniform float volumeLowerThreshold;\n";
a+="uniform float volumeUpperThreshold;\n";a+="uniform float volumeScalarMin;\n";a+="uniform float volumeScalarMax;\n";a+="uniform vec3 volumeScalarMinColor;\n";a+="uniform vec3 volumeScalarMaxColor;\n";a+="uniform float volumeWindowLow;\n";a+="uniform float volumeWindowHigh;\n";a+="\n";a+="varying float fDiscardNow;\n";a+="varying vec4 fVertexPosition;\n";a+="varying vec3 fragmentColor;\n";a+="varying vec2 fragmentTexturePos;\n";a+="varying vec3 fVertexNormal;\n";a+="varying vec3 fTransformedVertexNormal;\n";
a+="\n";a+="void main(void) {\n";a+=" if (fDiscardNow > 0.0) {\n";a+="   discard;\n";a+=" }\n";a+=" if (usePicking) {\n";a+="   gl_FragColor = vec4(fragmentColor, 1.0);\n";a+=" } else if (useTexture) {\n";a+="   vec4 texture1 = texture2D(textureSampler,fragmentTexturePos);\n";a+="   vec4 textureSum = texture1;\n";a+="   if (volumeTexture) {\n";a+="     float _windowLow = ((volumeWindowLow - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n";a+="     float _windowHigh = ((volumeWindowHigh - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin));\n";
a+="     vec3 _minrange = vec3(_windowLow,_windowLow,_windowLow);\n";a+="     vec3 _maxrange = vec3(_windowHigh,_windowHigh,_windowHigh);\n";a+="     vec3 fac = _maxrange - _minrange;\n";a+="     textureSum = vec4((textureSum.r - _minrange)/fac,1);\n";a+="     textureSum = textureSum.r * vec4(volumeScalarMaxColor,1) + (1.0 - textureSum.r) * vec4(volumeScalarMinColor,1);\n";a+="   }\n";a+="   if (useLabelMapTexture) {\n";a+="     vec4 texture2 = texture2D(textureSampler2,fragmentTexturePos);\n";a+=
"     if (texture2.a > 0.0) {\n";a+="         if (labelmapColor.a != -255.0) {\n";a+="           if (all(equal(floor(texture2 * vec4(255)), labelmapColor))) {\n";a+="             if (labelmapOpacity < 1.0) {\n";a+="               textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";a+="             } else {\n";a+="               textureSum = texture2;\n";a+="             }\n";a+="           }\n";a+="         } else {\n";a+="           if (labelmapOpacity < 1.0) {\n";a+="             textureSum = mix(texture2, textureSum, 1.0 - labelmapOpacity);\n";
a+="           } else {\n";a+="             textureSum = texture2;\n";a+="           }\n";a+="         }\n";a+="     }\n";a+="   }\n";a+="   if (volumeTexture) {\n";a+="     float _volumeLowerThreshold = (volumeLowerThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n";a+="     float _volumeUpperThreshold = (volumeUpperThreshold - volumeScalarMin)/ (volumeScalarMax - volumeScalarMin);\n";a+="     if (texture1.r < _volumeLowerThreshold ||\n";a+="         texture1.r > _volumeUpperThreshold ||\n";
a+="         texture1.a == 0.0 ) {\n";a+="       discard;\n";a+="     };\n";a+="   };\n";a+="   gl_FragColor = textureSum;\n";a+="   gl_FragColor.a = objectOpacity;\n";a+=" } else {\n";a+="   vec3 nNormal = normalize(fTransformedVertexNormal);\n";a+="   if (fVertexNormal == vec3(0.0,0.0,0.0)) {\n";a+="     gl_FragColor = vec4(fragmentColor,1.0);\n";a+="     return;\n";a+="   }\n";a+="   vec3 light = vec3(0.0, 0.0, 1.0);\n";a+="   vec3 lightDirection = vec3(0,0,-10);\n";a+="   lightDirection = normalize(lightDirection);\n";
a+="   vec3 eyeDirection = normalize(-fVertexPosition.xyz);\n";a+="   vec3 reflectionDirection = reflect(-lightDirection, nNormal);\n";a+="   float specular = pow(max(dot(reflectionDirection, eyeDirection), 0.0), 10.0);\n";a+="   float diffuse = 0.8 * max(dot(nNormal, light), 0.0);\n";a+="   float ambient = 0.3;\n";a+="   gl_FragColor = vec4(fragmentColor * ambient +\n";a+="                       fragmentColor * diffuse +\n";a+="                       vec3(0.2, 0.2, 0.2) * specular,\n";a+="                       objectOpacity);\n";
a+=" }\n";this.Td=a+="}\n"}C(kf,O);
var lf={bl:"vertexPosition",al:"vertexNormal",$k:"vertexColor",dl:"vertexTexturePos",cl:"vertexScalar"},mf={el:"view",Jk:"perspective",Ak:"center",Ik:"objectTransform",Wk:"useObjectColor",Gk:"objectColor",Yk:"useScalars",Sk:"scalarsReplaceMode",Pk:"scalarsMin",Mk:"scalarsMax",Qk:"scalarsMinColor",Nk:"scalarsMaxColor",Rk:"scalarsMinThreshold",Ok:"scalarsMaxThreshold",Lk:"scalarsInterpolation",Kk:"pointSize",Hk:"objectOpacity",Fk:"normal",Xk:"usePicking",Zk:"useTexture",Vk:"useLabelMapTexture",Dk:"labelmapOpacity",
Ck:"labelmapColor",Tk:"textureSampler",Uk:"textureSampler2",fl:"volumeLowerThreshold",ll:"volumeUpperThreshold",il:"volumeScalarMin",gl:"volumeScalarMax",jl:"volumeScalarMinColor",hl:"volumeScalarMaxColor",nl:"volumeWindowLow",ml:"volumeWindowHigh",kl:"volumeTexture"};function cf(a){Y.call(this);this.f="slice";this.B=[0,0,0];this.ic=[0,0,1];this.V=[0,1,0];this.Sc=[1,0,0];this.w=this.D=10;this.qc=[0,1,0,0,1,1,1,1,1,0,0,0];this.e=this.xb=s;this.Ab=q;this.gc=[1,1,1];a!=s&&this.vc(a)}C(cf,Y);cf.prototype.vc=function(a){this.B=a.B.slice();this.ic=a.ic.slice();this.V=a.V.slice();this.D=a.D;this.w=a.w;this.xb=a.xb;this.e=a.e;this.Ab=a.Ab;this.gc=a.gc;this.Yh=a.Yh;cf.z.vc.call(this,a)};cf.prototype.__defineSetter__("height",ca("w"));
cf.prototype.__defineSetter__("width",ca("D"));cf.prototype.__defineGetter__("up",u("V"));cf.prototype.__defineGetter__("right",u("Sc"));cf.prototype.create=function(){this.Kb()};cf.prototype.Sa=function(){cf.z.Sa.call(this);this.B.length=0;this.ic.length=0;this.V.length=0;this.Sc.length=0;this.qc.length=0;this.e=this.xb=s;this.gc.length=0};
cf.prototype.Kb=function(){var a=(new R(this.ic[0],this.ic[1],this.ic[2])).normalize(),b=new R(this.V[0],this.V[1],this.V[2]),c=new R(this.Sc[0],this.Sc[1],this.Sc[2]),e=new R(this.B[0],this.B[1],this.B[2]),d=Jc(c.l().Y().scale(this.D/2),b.l().Y().scale(this.w/2)),f=new R(d.x+e.x,d.y+e.y,d.d+e.d),d=Jc(c.l().Y().scale(this.D/2),b.l().scale(this.w/2)),g=new R(d.x+e.x,d.y+e.y,d.d+e.d),d=Jc(c.l().scale(this.D/2),b.l().Y().scale(this.w/2)),h=new R(d.x+e.x,d.y+e.y,d.d+e.d),d=Jc(c.l().scale(this.D/2),b.l().scale(this.w/
2)),b=new R(d.x+e.x,d.y+e.y,d.d+e.d);this.h=new W(18);this.o=new W(18);this.h.add(f.x,f.y,f.d);this.h.add(g.x,g.y,g.d);this.h.add(h.x,h.y,h.d);this.h.add(h.x,h.y,h.d);this.h.add(b.x,b.y,b.d);this.h.add(g.x,g.y,g.d);this.o.add(a.x,a.y,a.d);this.o.add(a.x,a.y,a.d);this.o.add(a.x,a.y,a.d);this.o.add(a.x,a.y,a.d);this.o.add(a.x,a.y,a.d);this.o.add(a.x,a.y,a.d);this.Ab&&(a=new Y,a.h=new W(24),a.o=new W(24),a.h.add(f.x,f.y,f.d),a.h.add(g.x,g.y,g.d),a.h.add(g.x,g.y,g.d),a.h.add(b.x,b.y,b.d),a.h.add(b.x,
b.y,b.d),a.h.add(h.x,h.y,h.d),a.h.add(h.x,h.y,h.d),a.h.add(f.x,f.y,f.d),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.o.add(0,0,0),a.A=[this.gc[0],this.gc[1],this.gc[2]],a.Ha="LINES",a.Oc=2,this.c.push(a))};A("X.slice",cf);A("X.slice.prototype.create",cf.prototype.create);A("X.slice.prototype.destroy",cf.prototype.Sa);function P(a){Y.call(this);this.f="volume";this.B=[0,0,0];this.s=[10,10,10];this.ka=[1,1,1];this.td=[10,10,10];this.pb=[1,1,1];this.hb=[];this.Mc=this.Eb=this.Lc=this.Db=this.Kc=this.Cb=0;this.nc=new Y;this.oc=new Y;this.pc=new Y;this.de=this.Qa=t;this.X=-1;this.ce=[];this.e=s;this.Ab=q;this.da=Infinity;this.ca=-Infinity;this.wg=q;this.$d=1;this.ga=0;this.L=s;this.b=[];this.t=[0,0,0];this.gb=[0,0,0];this.$c=[0,0,0];this.na=[];this.bg=[];this.Za=s;Fa(this,new zc);Fa(this,new nd);a!=s&&this.vc(a)}
C(P,Y);P.prototype.vc=function(a){this.B=a.B.slice();this.s=a.s.slice();this.pb=a.pb.slice();this.Cb=a.Cb;this.Kc=a.Kc;this.Db=a.Db;this.Lc=a.Lc;this.Eb=a.Eb;this.Mc=a.Mc;this.eg=a.eg.slice();this.nc=new Y(a.nc);this.oc=new Y(a.oc);this.pc=new Y(a.pc);this.ga=a.ga;this.L=a.L;this.Qa=a.Qa;this.de=a.de;this.X=a.X;this.e=a.e;this.Ab=a.Ab;P.z.vc.call(this,a)};
P.prototype.Kb=function(a){this.c.length=0;this.nc.c.length=0;this.oc.c.length=0;this.pc.c.length=0;this.c.push(this.nc);this.c.push(this.oc);this.c.push(this.pc);this.Ca=a.Ec;this.$c=a.Fc;this.gb=a.Dc;this.Gc=a.cb;this.Rh=a.fb;this.ga=a.max;this.L=a.data;this.j=q};
P.prototype.Sa=function(){P.z.Sa.call(this);this.hb.length=0;this.c.length=0;this.nc.c.length=0;this.nc.length=0;this.oc.c.length=0;this.oc.length=0;this.pc.c.length=0;this.pc.length=0;this.L=s;this.ka.length=0;this.b.length=0;this.t.length=0;this.gb.length=0;this.$c.length=0;this.na.length=0;this.bg.length=0;this.Za=s};
P.prototype.q=function(a){a="undefined"!==typeof a?a:q;if(0<this.c.length){this.Qa!=this.de&&(!this.Qa&&-1!=this.X&&(this.c[this.X].visible=t),this.j=q,this.de=this.Qa);if(!this.O)return;for(var b=0,b=0;3>b;b++){var c=this.c[b],e=0,d=0;0==b?(e=this.Cb,d=this.Kc,this.Kc=this.Cb):1==b?(e=this.Db,d=this.Lc,this.Lc=this.Db):2==b&&(e=this.Eb,d=this.Mc,this.Mc=this.Eb);if(this.c[b].c[parseInt(e,10)]==s){var f=Oc();f[0]=this.b[b].k[0][0][0]+this.b[b].C[0]*parseInt(e,10);f[1]=this.b[b].k[0][0][1]+this.b[b].C[1]*
parseInt(e,10);f[2]=this.b[b].k[0][0][2]+this.b[b].C[2]*parseInt(e,10);if(this.R){var g=bf(parseInt(e,10),f,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.e.na,this.e,this.e.R,this.e.wa.Ja);this.e.c[b].c[parseInt(e,10)]=g;this.e.c[b].q(q)}f=bf(parseInt(e,10),f,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.na,this,q,s);this.R&&(f.e=f.I,f.e=this.e.c[b].c[parseInt(e,10)].I);c.c[parseInt(e,10)]=f;this.c[b].q(q)}d=c.c[parseInt(d,10)];this.Qa||(d.visible=t);c=c.c[parseInt(e,10)];c.visible=q;c.xa=
1;this.Qa&&(c.c[0].O=t,b!=this.X&&(c.visible=t,c.xa=0))}this.Qa&&-1!=this.X&&nf(this,this.X)}a&&P.z.q.call(this)};P.prototype.__defineGetter__("dimensions",u("s"));P.prototype.__defineSetter__("dimensions",ca("s"));P.prototype.__defineGetter__("spacing",u("pb"));P.prototype.__defineSetter__("spacing",ca("pb"));P.prototype.__defineGetter__("bbox",u("ka"));P.prototype.__defineGetter__("range",u("td"));P.prototype.__defineGetter__("dimensionsRAS",u("eg"));
P.prototype.__defineGetter__("volumeRendering",u("Qa"));P.prototype.__defineSetter__("volumeRendering",function(a){this.Qa=a;this.q(t)});P.prototype.__defineGetter__("visible",u("O"));P.prototype.__defineSetter__("visible",function(a){if(a)this.O=a,this.q(t);else{for(var b=this.c,c=b.length,e=0,e=0;e<c;e++)b[e].visible=a;this.O=a;this.j=q}});P.prototype.__defineGetter__("center",u("B"));
P.prototype.__defineSetter__("center",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid center."));this.B=a});P.prototype.__defineGetter__("volumeRenderingCache",u("ce"));P.prototype.__defineSetter__("volumeRenderingCache",function(a){(a==s||!ja(a)||!(3>=a.length))&&m(Error("Invalid volumeRederingCache."));this.ce=a});P.prototype.__defineGetter__("image",u("hb"));P.prototype.__defineGetter__("labelmap",function(){this.e||(this.e=new of(this));return this.e});
P.prototype.__defineGetter__("indexX",u("Cb"));P.prototype.__defineSetter__("indexX",function(a){y(a)&&(0<=a&&a<this.nc.c.length)&&(this.Cb=a,this.q(t))});P.prototype.__defineGetter__("indexY",u("Db"));P.prototype.__defineSetter__("indexY",function(a){y(a)&&(0<=a&&a<this.oc.c.length)&&(this.Db=a,this.q(t))});P.prototype.__defineGetter__("indexZ",u("Eb"));P.prototype.__defineSetter__("indexZ",function(a){y(a)&&(0<=a&&a<this.pc.c.length)&&(this.Eb=a,this.q(t))});
P.prototype.__defineGetter__("windowLow",u("da"));P.prototype.__defineSetter__("windowLow",ca("da"));P.prototype.__defineGetter__("windowHigh",u("ca"));P.prototype.__defineSetter__("windowHigh",ca("ca"));P.prototype.__defineGetter__("borders",u("Ab"));P.prototype.__defineSetter__("borders",ca("Ab"));P.prototype.__defineGetter__("reslicing",u("wg"));P.prototype.__defineSetter__("reslicing",ca("wg"));P.prototype.__defineGetter__("resolutionFactor",u("$d"));
P.prototype.__defineSetter__("resolutionFactor",ca("$d"));P.prototype.__defineSetter__("xNormX",function(a){this.b[0].i[0]=a});P.prototype.__defineGetter__("xNormX",function(){return this.b[0].i[0]});P.prototype.__defineSetter__("xNormY",function(a){this.b[0].i[1]=a});P.prototype.__defineGetter__("xNormY",function(){return this.b[0].i[1]});P.prototype.__defineSetter__("xNormZ",function(a){this.b[0].i[2]=a});P.prototype.__defineGetter__("xNormZ",function(){return this.b[0].i[2]});
P.prototype.__defineSetter__("xColor",function(a){this.b[0].A=a});P.prototype.__defineGetter__("xColor",function(){return this.b[0].A});P.prototype.__defineSetter__("yNormX",function(a){this.b[1].i[0]=a});P.prototype.__defineGetter__("yNormX",function(){return this.b[1].i[0]});P.prototype.__defineSetter__("yNormY",function(a){this.b[1].i[1]=a});P.prototype.__defineGetter__("yNormY",function(){return this.b[1].i[1]});P.prototype.__defineSetter__("yNormZ",function(a){this.b[1].i[2]=a});
P.prototype.__defineGetter__("yNormZ",function(){return this.b[1].i[2]});P.prototype.__defineSetter__("yColor",function(a){this.b[1].A=a});P.prototype.__defineGetter__("yColor",function(){return this.b[1].A});P.prototype.__defineSetter__("zNormX",function(a){this.b[2].i[0]=a});P.prototype.__defineGetter__("zNormX",function(){return this.b[2].i[0]});P.prototype.__defineSetter__("zNormY",function(a){this.b[2].i[1]=a});P.prototype.__defineGetter__("zNormY",function(){return this.b[2].i[1]});
P.prototype.__defineSetter__("zNormZ",function(a){this.b[2].i[2]=a});P.prototype.__defineGetter__("zNormZ",function(){return this.b[2].i[2]});P.prototype.__defineSetter__("zColor",function(a){this.b[2].A=a});P.prototype.__defineGetter__("zColor",function(){return this.b[2].A});
P.prototype.ik=function(a){this.c[a].visible=t;for(var b=0;b<this.c[a].c.length;b++)"undefined"!=typeof this.c[a].c[b]&&(this.R&&(this.e.c[a].c[b].remove(),this.e.c[a].c[b]=s),this.c[a].c[b].remove(),this.c[a].c[b]=s);Qc(this.b[a].i,this.b[a].i);ff(a,this.b[a].ud,this.b[a].i,this);this.c[a].c=[];this.c[a].c=Array(this.b[a].n);this.R&&(b=bf(Math.floor(this.b[a].n/2),this.b[a].ud,this.b[a].Fa,this.b[a].i,this.b[a].A,this.ka,this.e.na,this.e,this.e.R,this.e.wa.Ja),this.e.c[a].c=[],this.e.c[a].c=Array(this.b[a].n),
this.e.c[a].c[Math.floor(this.b[a].n/2)]=b,this.e.c[a].q());b=bf(Math.floor(this.b[a].n/2),this.b[a].ud,this.b[a].Fa,this.b[a].i,this.b[a].A,this.ka,this.na,this,q,s);window.console.log("modified!");this.R&&(b.e=b.I,b.e=this.e.c[a].c[Math.floor(this.b[a].n/2)].I);this.c[a].c[Math.floor(this.b[a].n/2)]=b;0==a?(this.Cb=Math.floor(this.b[a].n/2),this.Kc=Math.floor(this.b[a].n/2)):1==a?(this.Db=Math.floor(this.b[a].n/2),this.Lc=Math.floor(this.b[a].n/2)):(this.Eb=Math.floor(this.b[a].n/2),this.Mc=Math.floor(this.b[a].n/
2));this.c[a].q();this.c[a].c[Math.floor(this.b[a].n/2)].O=q};
function nf(a,b){if(!a.Rd)if(!a.Qa||!a.j&&b==a.X)a.X=b;else if(-1==a.ce.indexOf(b)){a.ce.push(b);a.Rd=q;var c=new Td;c.G=a;a.dispatchEvent(c);a.onComputing(b);setTimeout(function(){var a=s;0<=this.X&&(a=this.c[this.X],a.visible=t);var a=this.c[b],c=a.c.length,d=Math.floor(c/4),e;for(e=0;e<1*d;e++){if(a.c[e]==s){var j=Oc();j[0]=this.b[b].k[0][0][0]+this.b[b].C[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].C[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].C[2]*e;if(this.R){var l=bf(e,j,this.b[b].Fa,this.b[b].i,
this.b[b].A,this.ka,this.e.na,this.e,this.e.R,this.e.wa.Ja);this.e.c[b].c[e]=l;this.e.c[b].q(q)}j=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.na,this,q,s);j.c[0].O=t;this.R&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].O=q}pf(this,0.25);setTimeout(function(){for(;e<2*d;e++){if(a.c[e]==s){var j=Oc();j[0]=this.b[b].k[0][0][0]+this.b[b].C[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].C[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].C[2]*e;if(this.R){var l=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,
this.ka,this.e.na,this.e,this.e.R,this.e.wa.Ja);this.e.c[b].c[e]=l;this.e.c[b].q(q)}j=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.na,this,q,s);j.c[0].O=t;this.R&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].O=q}pf(this,0.5);setTimeout(function(){for(;e<3*d;e++){if(a.c[e]==s){var j=Oc();j[0]=this.b[b].k[0][0][0]+this.b[b].C[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].C[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].C[2]*e;if(this.R){var l=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,
this.e.na,this.e,this.e.R,this.e.wa.Ja);this.e.c[b].c[e]=l;this.e.c[b].q(q)}j=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.na,this,q,s);j.c[0].O=t;this.R&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].O=q}pf(this,0.75);setTimeout(function(){for(e=3*d;e<c;e++){if(a.c[e]==s){var j=Oc();j[0]=this.b[b].k[0][0][0]+this.b[b].C[0]*e;j[1]=this.b[b].k[0][0][1]+this.b[b].C[1]*e;j[2]=this.b[b].k[0][0][2]+this.b[b].C[2]*e;if(this.R){var l=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.e.na,
this.e,this.e.R,this.e.wa.Ja);this.e.c[b].c[e]=l;this.e.c[b].q(q)}j=bf(e,j,this.b[b].Fa,this.b[b].i,this.b[b].A,this.ka,this.na,this,q,s);j.c[0].O=t;this.R&&(j.e=j.I,j.e=this.e.c[b].c[e].I);a.c[e]=j}a.c[e].O=q}pf(this,1);setTimeout(function(){this.Rd&&this.c[b].q(q);this.X=b;this.j=t;if(this.Rd){var a=new Vd;a.G=this;this.dispatchEvent(a);this.onComputingEnd(b)}this.Rd=t}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(this),10)}.bind(a),10)}else{c=a.c[a.X];c.visible=t;var c=a.c[b],e=c.c.length,
d;for(d=0;d<e;d++)c.c[d].O=q;a.X=b;a.j=t}}function pf(a,b){var c=new Ud;c.zd=b;a.dispatchEvent(c);a.onComputingProgress(100*b)}P.prototype.Ef=ba();P.prototype.Gf=ba();P.prototype.Ff=ba();A("X.volume",P);A("X.volume.prototype.modified",P.prototype.q);A("X.volume.prototype.destroy",P.prototype.Sa);A("X.volume.prototype.sliceInfoChanged",P.prototype.ik);A("X.volume.prototype.onComputing",P.prototype.Ef);A("X.volume.prototype.onComputingProgress",P.prototype.Gf);
A("X.volume.prototype.onComputingEnd",P.prototype.Ff);function qf(){Ve.call(this);this.f="parserOFF"}C(qf,Ve);
qf.prototype.parse=function(a,b,c){function e(){k===d&&m(Error("End of file reached unexpectedly."));for(var a=k;a<d;++a)if(10===f[a]){var b=Xe(f,k,a);k=a+1;return b}k=d;return Xe(f,k,d-1)}D.Ia(this.f+".parse");this.L=c;var d=c.byteLength,f=Z(this,"uchar",d);c=[];b.h=new W(d);b.o=new W(d);for(var g=b.h,h=b.o,k=0,j=e(),j=("OFF"===j?e():j).split(" "),l=j[0],j=j[1];l--;){var n=e(),n=n.split(" ");c.push([parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])])}for(;j--;){var n=e(),n=n.split(" "),w=c[parseInt(n[1],
10)],l=c[parseInt(n[2],10)],n=c[parseInt(n[3],10)];g.add(w[0],w[1],w[2]);g.add(l[0],l[1],l[2]);g.add(n[0],n[1],n[2]);w=new R(w[0],w[1],w[2]);n=new R(n[0],n[1],n[2]);l=Kc((new R(l[0],l[1],l[2])).va(w),n.va(w));l.normalize();h.add(l.x,l.y,l.d);h.add(l.x,l.y,l.d);h.add(l.x,l.y,l.d)}D.Ba(this.f+".parse");c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};A("X.parserOFF",qf);A("X.parserOFF.prototype.parse",qf.prototype.parse);function rf(){Ve.call(this);this.f="parserDCM"}C(rf,Ve);
rf.prototype.parse=function(a,b,c){b.Cc={};b.Cc.xf=0;this.zc(c,b);if(b.r.length==s||b.sa.length==b.r.length){b.Cc.xf=b.r.length;var e={};c={};for(var d=0;d<b.sa.length;d++)e.hasOwnProperty(b.sa[d].series_instance_uid)||(e[b.sa[d].series_instance_uid]=[],c[b.sa[d].series_instance_uid]={}),c[b.sa[d].series_instance_uid].hasOwnProperty(b.sa[d].sop_instance_uid)||(c[b.sa[d].series_instance_uid][b.sa[d].sop_instance_uid]=q,e[b.sa[d].series_instance_uid].push(b.sa[d]));var f=Object.keys(e)[0],d=e[f],g=
d.length;c={};var h="image_position_patient";1==g?(h="image_position_patient",e[f][0].dist=0):d[0].image_position_patient[0]!=d[1].image_position_patient[0]||d[0].image_position_patient[1]!=d[1].image_position_patient[1]||d[0].image_position_patient[2]!=d[1].image_position_patient[2]?(h="image_position_patient",d.sort(function(a,b){return a.image_position_patient[2]-b.image_position_patient[2]})):d[0].instance_number!=d[1].instance_number?(h="instance_number",d.sort(function(a,b){return a.instance_number-
b.instance_number})):window.console.log("Could not resolve the ordering mode");isNaN(d[0].pixel_spacing[0])&&(d[0].pixel_spacing[0]=1);isNaN(d[0].pixel_spacing[1])&&(d[0].pixel_spacing[1]=1);if(1<g)switch(h){case "image_position_patient":for(var e=[],f=1E3,k=0,j=0,l=0;l<d.length;l++)e.push(d[l].image_position_patient);for(l=0;l<e.length;l++)for(var n=0;n<e.length;n++)l!=n&&Math.abs(e[l][2]-e[n][2])<f&&(f=Math.abs(e[l][2]-e[n][2]),k=l,j=n);var e=[e[k],e[j]],j=e[0],e=e[1],f=e[0]-j[0],k=e[1]-j[1],w=
e[2]-j[2];d[0].pixel_spacing[2]=Math.sqrt(f*f+k*k+w*w);document.getElementById("rendimage2").setAttribute("zspacing",d[0].pixel_spacing[2]);document.getElementById("sliceZ").setAttribute("xspacing",d[0].pixel_spacing[0]);document.getElementById("sliceY").setAttribute("yspacing",d[0].pixel_spacing[1]);break;case "instance_number":d[0].pixel_spacing[2]=1;break;default:window.console.log("Unkown ordering mode - returning: "+h)}else d[0].pixel_spacing[2]=1;e=1;switch(h){case "image_position_patient":j=
d[0].image_position_patient;l=d[g-1].image_position_patient;f=l[0]-j[0];k=l[1]-j[1];w=l[2]-j[2];f=Math.sqrt(f*f+k*k+w*w);e+=Math.round(f/d[0].pixel_spacing[2]);window.console.log("nbSlices"+e);break;case "instance_number":e+=Math.abs(d[g-1].instance_number-d[0].instance_number);break;default:window.console.log("Unkown ordering mode - returning: "+h)}j=d[0].columns*d[0].rows;f=j*e;l=s;switch(d[0].ff){case 8:l=new Uint8Array(f);break;case 16:l=new Uint16Array(f);break;case 32:l=new Uint32Array(f);default:window.console.log("Unknown number of bits allocated - using default: 32 bits")}b.pb=
d[0].pixel_spacing;for(n=0;n<g;n++){var r=d[n].data,f=0;switch(h){case "image_position_patient":f=d[n].image_position_patient[0]-d[0].image_position_patient[0];k=d[n].image_position_patient[1]-d[0].image_position_patient[1];w=d[n].image_position_patient[2]-d[0].image_position_patient[2];f=Math.round(Math.sqrt(f*f+k*k+w*w)/d[0].pixel_spacing[2]);window.console.log(f);break;case "instance_number":f=d[n].instance_number-d[0].instance_number;break;default:window.console.log("Unkown ordering mode - returning: "+
h)}l.set(r,Math.floor(f)*j)}c.data=l;b.L=l;b.s=[d[0].columns,d[0].rows,e];c.Bl=b.s;e=We(l);g=e[0];e=e[1];c.min=b.qa=b.da=g;c.max=b.ga=b.ca=e;-Infinity==b.U&&(b.U=g);Infinity==b.W&&(b.W=e);e=d[0].image_position_patient;g=Tc();if("false"==b.reslicing||b.reslicing==t)T(g,0,d[0].pixel_spacing[0],0,0,0),T(g,1,0,d[0].pixel_spacing[1],0,0),T(g,2,0,0,d[0].pixel_spacing[2],0),T(g,3,0,0,0,1);else switch(h){case "image_position_patient":T(g,0,-d[0].pixel_spacing[0],0,0,0);T(g,1,0,-d[0].pixel_spacing[1],0,0);
T(g,2,0,0,d[0].pixel_spacing[2],0);T(g,3,0,0,0,1);break;case "instance_number":T(g,0,-1,0,0,-e[0]);T(g,1,-0,-1,-0,-e[1]);T(g,2,0,0,1,e[2]);T(g,3,0,0,0,1);break;default:window.console.log("Unkown ordering mode - returning: "+h)}c.cb=g;c.fb=Tc();ed(c.cb,c.fb);h=Sc(0,0,0,1);d=Rc();gd(g,h,d);h=Sc(1,1,1,1);e=Rc();gd(g,h,e);c.Fc=[e[0]-d[0],e[1]-d[1],e[2]-d[2]];d=Ye(g,[b.s[0],b.s[1],b.s[2]]);c.Dc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.Ec=[d[0],d[2],d[4]];b.Kb(c);b.hb=gf(this,b)}c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};
function sf(a,b,c,e){switch(c){case 16975:case 20819:case 20053:case 22351:c=function(a){for(var b="",c=128;1<=c;c/=2)b+=a&c?"1":"0";return b};e=a[b++];a=a[b++];e=parseInt(c((a&65280)>>8)+c(a&255)+(c((e&65280)>>8)+c(e&255)),2);4294967295==e&&(e=0);b+=e/2;break;default:b+=e/2}return b}
rf.prototype.zc=function(a,b){this.L=a;if("undefined"==typeof b.sa||b.sa==s)b.sa=[];for(var c={pixel_spacing:[0.1,0.1,Infinity],image_orientation_patient:[1,0,0,0,1,0],image_position_patient:[0,0,0],transfer_syntax_uid:"no_transfer_syntax_uid"},e=Z(this,"ushort",this.L.byteLength),d=66,f=s,g=s,h=s,k=s;d<e.length;)switch(f=e[d++],g=e[d++],h=e[d++],k=e[d++],"1.2.840.10008.1.2"==c.transfer_syntax_uid&&0==k&&(k=h),f){case 2:switch(g){case 16:for(var j="",f=f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>
8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.transfer_syntax_uid=j.replace(/\0/g,"");break;default:d=sf(e,d,h,k)}break;case 40:switch(g){case 16:c.rows=e[d];d+=k/2;break;case 17:c.columns=e[d];d+=k/2;break;case 256:c.ff=e[d];d+=k/2;break;case 257:c.bits_stored=e[d];d+=k/2;break;case 2:c.number_of_images=e[d];d+=k/2;break;case 48:j="";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.pixel_spacing=[parseFloat(j[0]),parseFloat(j[1]),
Infinity];break;case 4178:d+=k/2;default:d=sf(e,d,h,k)}break;case 32:switch(g){case 14:c.series_instance_uid="";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.series_instance_uid+=String.fromCharCode(g),c.series_instance_uid+=String.fromCharCode(h);break;case 19:j="";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);c.instance_number=parseInt(j,10);break;case 50:j="";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),
j+=String.fromCharCode(h);j=j.split("\\");c.image_position_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2])];break;case 55:j="";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,j+=String.fromCharCode(g),j+=String.fromCharCode(h);j=j.split("\\");c.image_orientation_patient=[parseFloat(j[0]),parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3]),parseFloat(j[4]),parseFloat(j[5])];break;default:d=sf(e,d,h,k)}break;case 65534:switch(g){default:k=0,d+=k/2}break;case 8:switch(g){case 24:c.sop_instance_uid=
"";for(f=0;f<k/2;f++)h=e[d++],g=h&255,h=(h&65280)>>8,c.sop_instance_uid+=String.fromCharCode(g),c.sop_instance_uid+=String.fromCharCode(h);break;default:d=sf(e,d,h,k)}break;case 16:switch(g){case 8720:for(f=0;f<k/2;f++)d++;break;default:d=sf(e,d,h,k)}break;default:d=sf(e,d,h,k)}switch(c.ff){case 8:c.data=new Uint8Array(c.columns*c.rows);break;case 16:c.data=new Uint16Array(c.columns*c.rows);break;case 32:c.data=new Uint32Array(c.columns*c.rows)}this.F=this.L.byteLength-2*c.columns*c.rows;e=s;switch(c.ff){case 8:e=
Z(this,"uchar",c.columns*c.rows);break;case 16:e=Z(this,"ushort",c.columns*c.rows);break;case 32:e=Z(this,"uint",c.columns*c.rows)}c.data=e;b.sa.push(c);return b};A("X.parserDCM",rf);A("X.parserDCM.prototype.parse",rf.prototype.parse);function tf(){Ve.call(this);this.f="parserVTK"}C(tf,Ve);
tf.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");var e=b.h,d=b.o,f=new Uint8Array(c),g="";b.h=e=new W(c.byteLength);b.o=d=new W(c.byteLength);c=0;for(var h=f.length;c<h;c+=32768)g+=Xe(f,c,Math.min(c+32768,h));f=g.split("\n");g=f.length;this.xd=this.yd=s;this.jc=[];this.Pa=md;this.Se=this.Vb=this.Qb=this.Wb=t;c=0;for(h=g%8;h--;)uf(this,f[c]),c++;for(h=0.125*g^0;h--;)uf(this,f[c]),c++,uf(this,f[c]),c++,uf(this,f[c]),c++,uf(this,f[c]),c++,uf(this,f[c]),c++,uf(this,f[c]),c++,uf(this,f[c]),c++,
uf(this,f[c]),c++;c=this.yd;var f=this.xd,g=f.length,k=h=this.jc.length;do{var j=this.jc[h-k],l=j.length,n;for(n=0;n<l&&!("LINES"==this.Pa&&n+1>=l);n++){var w=parseInt(j[n],10),r=c.get(w);e.add(r[0],r[1],r[2]);var x=w,z=r;"LINES"==this.Pa?(x=parseInt(j[n+1],10),z=c.get(x),e.add(z[0],z[1],z[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==n||n==l-1)&&e.add(r[0],r[1],r[2]);w<g?(z=f.get(w),d.add(z[0],z[1],z[2]),"LINES"==this.Pa?(x=f.get(x),d.add(x[0],x[1],x[2])):"TRIANGLE_STRIPS"==this.Pa&&(0==n||n==l-1)&&d.add(z[0],
z[1],z[2])):(x=new R(r[0],r[1],r[2]),x.normalize(),d.add(x.x,x.y,x.d),"LINES"==this.Pa?(x=new R(z[0],z[1],z[2]),x.normalize(),d.add(x.x,x.y,x.d)):"TRIANGLE_STRIPS"==this.Pa&&(0==n||n==l-1)&&d.add(x.x,x.y,x.d))}k--}while(0<k);b.Ha=this.Pa;D.Ba(this.f+".parse");e=new pd;e.G=b;e.v=a;this.dispatchEvent(e)};
function uf(a,b){b=b.replace(/^\s+|\s+$/g,"");var c=b.split(" "),e=c.length,d=c[0];switch(d){case "POINTS":a.Wb=q;a.Qb=t;a.Vb=t;c=parseInt(c[1],10);a.yd=new W(3*c);a.xd=new W(3*c);return;case "VERTICES":a.Qb=q;a.Wb=t;a.Vb=t;c=parseInt(c[1],10);3<=c?a.Pa=md:1==c?a.Pa="POINTS":m(Error("This VTK file is not supported!"));a.jc=[];return;case "TRIANGLE_STRIPS":a.Qb=q;a.Wb=t;a.Vb=t;a.Pa="TRIANGLE_STRIPS";a.jc=[];return;case "LINES":a.Qb=q;a.Wb=t;a.Vb=t;a.Pa="LINES";a.jc=[];return;case "POLYGONS":a.Qb=q;
a.Wb=t;a.Vb=t;a.Pa="POLYGONS";a.jc=[];return;case "POINT_DATA":a.Vb=q;a.Wb=t;a.Qb=t;return}if(a.Wb)if(1==e||isNaN(parseFloat(d)))a.Wb=t;else{if(3<=e){var d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]);a.yd.add(d,f,g)}6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.yd.add(d,f,g));9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.yd.add(e,d,c))}else a.Qb?1==e||isNaN(parseFloat(d))?a.Qb=t:(c=c.slice(1),a.jc.push(c)):a.Vb&&("NORMALS"==d?a.Se=q:1==e||isNaN(parseFloat(d))?
(a.Vb=t,a.Se=t):a.Se&&(3<=e&&(d=parseFloat(c[0]),f=parseFloat(c[1]),g=parseFloat(c[2]),a.xd.add(d,f,g)),6<=e&&(d=parseFloat(c[3]),f=parseFloat(c[4]),g=parseFloat(c[5]),a.xd.add(d,f,g)),9<=e&&(e=parseFloat(c[6]),d=parseFloat(c[7]),c=parseFloat(c[8]),a.xd.add(e,d,c))))}A("X.parserVTK",tf);A("X.parserVTK.prototype.parse",tf.prototype.parse);function vf(){Ve.call(this);this.f="parserFSM";this.Pc=t}C(vf,Ve);
vf.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");this.L=c;var e=b.h,d=b.o;b.Rc=[];var f=b.Rc;c=0;var g;do g=Z(this,"uchar"),c++;while(200>c&&10!=g);Z(this,"uchar");d=Z(this,"uint");c=Z(this,"uint");var h=Z(this,"float",3*d);g=Z(this,"uint",3*c);var k=new Uint32Array(d),j=new Float32Array(9*c);b.h=e=new W(9*c);b.o=d=new W(9*c);var l;for(l=0;l<c;l++){var n=3*l,w=g[n],r=g[n+1],x=g[n+2];f.push(w);f.push(r);f.push(x);k[w]+=1;k[r]+=1;k[x]+=1;var n=3*w,z=3*r,E=3*x,H=h[n],J=h[n+1],B=h[n+2],r=h[z],
x=h[z+1],w=h[z+2],F=h[E],G=h[E+1],M=h[E+2];e.add(H,J,B);e.add(r,x,w);e.add(F,G,M);H=new R(H,J,B);F=new R(F,G,M);r=(new R(r,x,w)).l().va(H);x=F.l().va(H);r=Kc(r,x).normalize();j[n]+=r.x;j[n+1]+=r.y;j[n+2]+=r.d;j[z]+=r.x;j[z+1]+=r.y;j[z+2]+=r.d;j[E]+=r.x;j[E+1]+=r.y;j[E+2]+=r.d}for(l=0;l<c;l++)n=3*l,w=g[n],r=g[n+1],x=g[n+2],n=3*w,z=3*r,E=3*x,f=new R(j[z],j[z+1],j[z+2]),h=new R(j[E],j[E+1],j[E+2]),n=(new R(j[n],j[n+1],j[n+2])).scale(1/k[w]).normalize(),f=f.scale(1/k[r]).normalize(),h=h.scale(1/k[x]).normalize(),
d.add(n.x,n.y,n.d),d.add(f.x,f.y,f.d),d.add(h.x,h.y,h.d);c=Z(this,"uchar",this.L.byteLength-this.F);g=s;for(n=0;n<c.length;n++)if(99==c[n]&&114==c[n+1]&&97==c[n+2]&&115==c[n+3]){for(d=g=n+9;10!=c[n]&&n<c.length;)d++,n++;g=Xe(c.subarray(g,d)).split(" ");break}g&&(b.ha.Eh(parseFloat(g[0])),b.ha.Fh(parseFloat(g[1])),b.ha.Gh(parseFloat(g[2])));b.Ha=md;D.Ba(this.f+".parse");c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};A("X.parserFSM",vf);A("X.parserFSM.prototype.parse",vf.prototype.parse);var wf={kf:function(a,b,c){return wf.update(a,0,b,c)},update:function(a,b,c,e){var d=wf.Nh,f="number"===typeof c?c:c=0;e="number"===typeof e?e:a.length;b^=4294967295;for(f=e&7;f--;++c)b=b>>>8^d[(b^a[c])&255];for(f=e>>3;f--;c+=8)b=b>>>8^d[(b^a[c])&255],b=b>>>8^d[(b^a[c+1])&255],b=b>>>8^d[(b^a[c+2])&255],b=b>>>8^d[(b^a[c+3])&255],b=b>>>8^d[(b^a[c+4])&255],b=b>>>8^d[(b^a[c+5])&255],b=b>>>8^d[(b^a[c+6])&255],b=b>>>8^d[(b^a[c+7])&255];return(b^4294967295)>>>0}};
wf.Nh=new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,
3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,
366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,
3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,
1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,
1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]);function xf(a){var b=a.length,c=0,e=Number.POSITIVE_INFINITY,d,f,g,h,k,j,l,n,w;for(n=0;n<b;++n)a[n]>c&&(c=a[n]),a[n]<e&&(e=a[n]);d=1<<c;f=new Uint32Array(d);g=1;h=0;for(k=2;g<=c;){for(n=0;n<b;++n)if(a[n]===g){j=0;l=h;for(w=0;w<g;++w)j=j<<1|l&1,l>>=1;for(w=j;w<d;w+=k)f[w]=g<<16|n;++h}++g;h<<=1;k<<=1}return[f,c,e]};function yf(a,b){this.gf=[];this.hf=32768;this.qb=this.Ad=this.M=this.Vf=0;this.input=new Uint8Array(a);this.Bg=t;this.jf=zf;this.Na=t;if(b||!(b={}))b.index&&(this.M=b.index),b.bufferSize&&(this.hf=b.bufferSize),b.bufferType&&(this.jf=b.bufferType),b.resize&&(this.Na=b.resize);switch(this.jf){case Af:this.ja=32768;this.Ta=new Uint8Array(32768+this.hf+258);break;case zf:this.ja=0;this.Ta=new Uint8Array(this.hf);this.xc=this.yi;this.Eg=this.ni;this.qf=this.si;break;default:m(Error("invalid inflate mode"))}}
var Af=0,zf=1;
yf.prototype.$b=function(){for(;!this.Bg;){var a=Bf(this,3);a&1&&(this.Bg=q);a>>>=1;switch(a){case 0:var a=this.input,b=this.M,c=this.Ta,e=this.ja,d=p,f=p,g=p,h=c.length,d=p;this.qb=this.Ad=0;d=a[b++];d===p&&m(Error("invalid uncompressed block header: LEN (first byte)"));f=d;d=a[b++];d===p&&m(Error("invalid uncompressed block header: LEN (second byte)"));f|=d<<8;d=a[b++];d===p&&m(Error("invalid uncompressed block header: NLEN (first byte)"));g=d;d=a[b++];d===p&&m(Error("invalid uncompressed block header: NLEN (second byte)"));g|=
d<<8;f===~g&&m(Error("invalid uncompressed block header: length verify"));b+f>a.length&&m(Error("input buffer is broken"));switch(this.jf){case Af:for(;e+f>c.length;)d=h-e,f-=d,c.set(a.subarray(b,b+d),e),e+=d,b+=d,this.ja=e,c=this.xc(),e=this.ja;break;case zf:for(;e+f>c.length;)c=this.xc({Kg:2});break;default:m(Error("invalid inflate mode"))}c.set(a.subarray(b,b+f),e);e+=f;this.M=b+=f;this.ja=e;this.Ta=c;break;case 1:this.qf(Cf,Df);break;case 2:Ef(this);break;default:m(Error("unknown BTYPE: "+a))}}return this.Eg()};
var Ff=new Uint16Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gf=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258]),Hf=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0]),If=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577]),Jf=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Kf=new Uint8Array(288),
Lf,Mf;Lf=0;for(Mf=Kf.length;Lf<Mf;++Lf)Kf[Lf]=143>=Lf?8:255>=Lf?9:279>=Lf?7:8;var Cf=xf(Kf),Nf=new Uint8Array(30),Of,Pf;Of=0;for(Pf=Nf.length;Of<Pf;++Of)Nf[Of]=5;var Df=xf(Nf);function Bf(a,b){for(var c=a.Ad,e=a.qb,d=a.input,f=a.M,g;e<b;)g=d[f++],g===p&&m(Error("input buffer is broken")),c|=g<<e,e+=8;g=c&(1<<b)-1;a.Ad=c>>>b;a.qb=e-b;a.M=f;return g}
function Qf(a,b){for(var c=a.Ad,e=a.qb,d=a.input,f=a.M,g=b[0],h=b[1],k;e<h;)k=d[f++],k===p&&m(Error("input buffer is broken")),c|=k<<e,e+=8;d=g[c&(1<<h)-1];g=d>>>16;a.Ad=c>>g;a.qb=e-g;a.M=f;return d&65535}
function Ef(a){function b(a,b,c){var d,e,f;for(f=0;f<a;)switch(d=Qf(this,b),d){case 16:for(d=3+Bf(this,2);d--;)c[f++]=e;break;case 17:for(d=3+Bf(this,3);d--;)c[f++]=0;e=0;break;case 18:for(d=11+Bf(this,7);d--;)c[f++]=0;e=0;break;default:e=c[f++]=d}return c}var c=Bf(a,5)+257,e=Bf(a,5)+1,d=Bf(a,4)+4,f=new Uint8Array(Ff.length),g;for(g=0;g<d;++g)f[Ff[g]]=Bf(a,3);d=xf(f);f=new Uint8Array(c);g=new Uint8Array(e);a.qf(xf(b.call(a,c,d,f)),xf(b.call(a,e,d,g)))}v=yf.prototype;
v.qf=function(a,b){var c=this.Ta,e=this.ja;this.Hg=a;for(var d=c.length-258,f,g,h;256!==(f=Qf(this,a));)if(256>f)e>=d&&(this.ja=e,c=this.xc(),e=this.ja),c[e++]=f;else{f-=257;h=Gf[f];0<Hf[f]&&(h+=Bf(this,Hf[f]));f=Qf(this,b);g=If[f];0<Jf[f]&&(g+=Bf(this,Jf[f]));e>=d&&(this.ja=e,c=this.xc(),e=this.ja);for(;h--;)c[e]=c[e++-g]}for(;8<=this.qb;)this.qb-=8,this.M--;this.ja=e};
v.si=function(a,b){var c=this.Ta,e=this.ja;this.Hg=a;for(var d=c.length,f,g,h;256!==(f=Qf(this,a));)if(256>f)e>=d&&(c=this.xc(),d=c.length),c[e++]=f;else{f-=257;h=Gf[f];0<Hf[f]&&(h+=Bf(this,Hf[f]));f=Qf(this,b);g=If[f];0<Jf[f]&&(g+=Bf(this,Jf[f]));e+h>d&&(c=this.xc(),d=c.length);for(;h--;)c[e]=c[e++-g]}for(;8<=this.qb;)this.qb-=8,this.M--;this.ja=e};
v.xc=function(){var a=new Uint8Array(this.ja-32768),b=this.ja-32768,c=this.Ta;a.set(c.subarray(32768,a.length));this.gf.push(a);this.Vf+=a.length;c.set(c.subarray(b,b+32768));this.ja=32768;return c};v.yi=function(a){var b=this.input.length/this.M+1|0,c=this.input,e=this.Ta;a&&("number"===typeof a.Kg&&(b=a.Kg),"number"===typeof a.gi&&(b+=a.gi));2>b?(a=(c.length-this.M)/this.Hg[2],a=258*(a/2)|0,a=a<e.length?e.length+a:e.length<<1):a=e.length*b;a=new Uint8Array(a);a.set(e);return this.Ta=a};
v.Eg=function(){var a=0,b=this.Ta,c=this.gf,e,d=new Uint8Array(this.Vf+(this.ja-32768)),f,g,h,k;if(0===c.length)return this.Ta.subarray(32768,this.ja);f=0;for(g=c.length;f<g;++f){e=c[f];h=0;for(k=e.length;h<k;++h)d[a++]=e[h]}f=32768;for(g=this.ja;f<g;++f)d[a++]=b[f];this.gf=[];return this.buffer=d};v.ni=function(){var a,b=this.ja;this.Na?(a=new Uint8Array(b),a.set(this.Ta.subarray(0,b))):a=this.Ta.subarray(0,b);return this.buffer=a};new Uint8Array(256);var Rf;for(Rf=0;256>Rf;++Rf)for(var Sf=Rf,Tf=7,Sf=Sf>>>1;Sf;Sf>>>=1)--Tf;var Uf=[],Vf;for(Vf=0;288>Vf;Vf++)switch(q){case 143>=Vf:Uf.push([Vf+48,8]);break;case 255>=Vf:Uf.push([Vf-144+400,9]);break;case 279>=Vf:Uf.push([Vf-256+0,7]);break;case 287>=Vf:Uf.push([Vf-280+192,8]);break;default:m("invalid literal: "+Vf)}
function Wf(){var a=Xf;switch(q){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-
31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:m("invalid length: "+a)}}var Yf=[],Xf,Zf;
for(Xf=3;258>=Xf;Xf++)Zf=Wf(),Yf[Xf]=Zf[2]<<24|Zf[1]<<16|Zf[0];new Uint32Array(Yf);function $f(){};function ag(a){this.input=a;this.M=0;this.member=[]}
ag.prototype.$b=function(){for(var a=this.input.length;this.M<a;){var b=new $f,c=p,e=p,d=p,f=c=d=p,g=p,c=c=p,h=this.input,e=this.M;b.Qg=h[e++];b.Rg=h[e++];(31!==b.Qg||139!==b.Rg)&&m(Error("invalid file signature:",b.Qg,b.Rg));b.Dg=h[e++];switch(b.Dg){case 8:break;default:m(Error("unknown compression method: "+b.Dg))}b.le=h[e++];c=h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24;b.Ol=new Date(1E3*c);b.Zl=h[e++];b.Tl=h[e++];0<(b.le&4)&&(b.Fe=h[e++]|h[e++]<<8,e+=b.Fe);if(0<(b.le&8)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=
String.fromCharCode(c);b.name=g.join("")}if(0<(b.le&16)){g=[];for(f=0;0<(c=h[e++]);)g[f++]=String.fromCharCode(c);b.comment=g.join("")}0<(b.le&2)&&(b.oi=wf.kf(h,0,e)&65535,b.oi!==(h[e++]|h[e++]<<8)&&m(Error("invalid header crc16")));c=h[h.length-4]|h[h.length-3]<<8|h[h.length-2]<<16|h[h.length-1]<<24;h.length-e-4-4<512*c&&(d=c);e=new yf(h,{index:e,bufferSize:d});b.data=d=e.$b();e=e.M;b.yl=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;wf.kf(d)!==c&&m(Error("invalid CRC-32 checksum: 0x"+wf.kf(d).toString(16)+
" / 0x"+c.toString(16)));b.Hl=c=(h[e++]|h[e++]<<8|h[e++]<<16|h[e++]<<24)>>>0;(d.length&4294967295)!==c&&m(Error("invalid input size: "+(d.length&4294967295)+" / "+c));this.member.push(b);this.M=e}a=this.member;b=d=e=0;for(h=a.length;b<h;++b)d+=a[b].data.length;d=new Uint8Array(d);for(b=0;b<h;++b)d.set(a[b].data,e),e+=a[b].data.length;return d};function bg(){Ve.call(this);this.f="parserMGZ";this.Pc=t}C(bg,Ve);
bg.prototype.parse=function(a,b,c,e){D.Ia(this.f+".parse");window.console.log(b);e&&(c=(new ag(new Uint8Array(c))).$b(),c=c.buffer);e=this.zc(c);var d=[e.Af,e.Bf,e.Cf];b.s=d;var f=e.Hh;b.pb=f;c=e.min;var g=e.max;b.qa=b.da=c;b.ga=b.ca=g;-Infinity==b.U&&(b.U=c);Infinity==b.W&&(b.W=g);c=Tc();if("false"==b.reslicing||b.reslicing==t)T(c,0,b.pb[0],0,0,0),T(c,1,0,b.pb[1],0,0),T(c,2,0,0,b.pb[2],0),T(c,3,0,0,0,1),Wc(c,0,0,0,1);else{T(c,0,e.eb[0][0],e.eb[1][0],e.eb[2][0],0);T(c,1,e.eb[0][1],e.eb[1][1],e.eb[2][1],
0);T(c,2,e.eb[0][2],e.eb[1][2],e.eb[2][2],0);T(c,3,0,0,0,1);for(var g=d[0]/2,h=d[1]/2,d=d[2]/2,k=[0,0,0],j=0;3>j;++j)k[j]=e.eb[3][j]-(c[j+0]*f[0]*g+c[j+4]*f[1]*h+c[j+8]*f[2]*d);Wc(c,k[0],k[1],k[2],1)}e.cb=c;e.fb=Tc();ed(e.cb,e.fb);g=Sc(0,0,0,1);f=Rc();gd(c,g,f);h=Sc(1,1,1,1);g=Rc();gd(c,h,g);c=Ye(c,b.s);e.Fc=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];e.Dc=[c[1]-c[0]+1,c[3]-c[2]+1,c[5]-c[4]+1];e.Ec=[c[0],c[2],c[4]];b.Kb(e);D.Ba(this.f+".parse");b.hb=gf(this,b);e=new pd;e.G=b;e.v=a;this.dispatchEvent(e)};
bg.prototype.zc=function(a){this.L=a;a={version:0,Qh:0,Oh:0,Fi:0,Ph:0,Af:0,Bf:0,Cf:0,pj:0,type:0,wi:0,wh:0,Ek:s,eb:s,Hh:s,data:s,min:Infinity,max:-Infinity};a.version=Z(this,"uint");a.Af=Z(this,"uint");a.Bf=Z(this,"uint");a.Cf=Z(this,"uint");a.pj=Z(this,"uint");a.type=Z(this,"uint");a.wi=Z(this,"uint");a.wh=Z(this,"ushort");if(0<a.wh){a.Hh=Z(this,"float",3);var b=[];b.push(Z(this,"float",3));b.push(Z(this,"float",3));b.push(Z(this,"float",3));b.push(Z(this,"float",3));a.eb=b}this.F=284;b=a.Af*a.Bf*
a.Cf;switch(a.type){case 0:a.data=Z(this,"uchar",b);break;case 1:a.data=Z(this,"uint",b);break;case 3:a.data=Z(this,"float",b);break;case 4:a.data=Z(this,"ushort",b);break;default:m(Error("Unsupported MGH/MGZ data type: "+a.type))}b=We(a.data);a.min=b[0];a.max=b[1];this.F+16<this.L.byteLength&&(a.Qh=Z(this,"float"),a.Fi=Z(this,"float"),a.Oh=Z(this,"float"),a.Ph=Z(this,"float"));return a};A("X.parserMGZ",bg);A("X.parserMGZ.prototype.parse",bg.prototype.parse);function cg(){Ve.call(this);this.f="parserLBL"}C(cg,Ve);
cg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");var e=b.Rc,d=e.length;0==d&&m(Error("No _pointIndices defined on the X.object."));this.L=c;var f=[],g=Z(this,"uchar",c.byteLength),h=g.length,k=t,j=0;for(c=1;c<h;c++)10==g[c-1]?(j=c,k=q):k&&32==g[c]&&(f.push(parseInt(Xe(g,j,c),10)),k=t);g=b.H.K?b.H.K:new Float32Array(d);h=f.length;for(c=0;c<h;c++)g[f[c]]=1;f=new Float32Array(3*d);for(c=h=0;c<d;c++)k=e[c],k>d&&m(Error("Could not find scalar for vertex.")),k=g[k],f[h++]=k,f[h++]=k,f[h++]=k;b.H.K=
g;b.H.bd=f;b.H.j=q;D.Ba(this.f+".parse");e=new pd;e.G=b;e.v=a;this.dispatchEvent(e)};A("X.parserLBL",cg);A("X.parserLBL.prototype.parse",cg.prototype.parse);function dg(){Ve.call(this);this.f="parserCRV";this.Pc=t}C(dg,Ve);
dg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");var e=b.Rc;0==e.length&&m(Error("No _pointIndices defined on the X.object."));this.L=c;this.F=3;var d=Z(this,"uint");Z(this,"uint");Z(this,"uint");var f=0,g=0,h=0,k=0,j=0,l=0,n=0,w=0,r=0,x=0,z=0;c=Array(2);var E=Array(2),H=Z(this,"float",d),J;for(J=0;J<d;J++){var B=H[J];0==J&&(c[0]=E[0]=B);0<=B?(f++,k+=B):(g++,h+=B);r+=B;z++;E[0]=Math.max(B,E[0]);c[0]=Math.min(B,c[0]);H[J]=B}0!=f&&(j=k/f);0!=g&&(l=h/g);0!=z&&(x=r/z);for(z=r=h=k=0;z<d;z++)B=
H[z],J=0,0<=B?(J=Math.pow(B-j,2),k+=J):(J=Math.pow(B-l,2),h+=J),J=Math.pow(B-x,2),r+=J;1<f&&(n=Math.sqrt(k/(f-1)));1<g&&(w=Math.sqrt(h/(g-1)));c[1]=l-2.5*w;E[1]=j+2.5*n;d=e.length;f=new Float32Array(3*d);for(z=0;z<d;z++)g=H[e[z]],h=3*z,f[h]=g,f[h+1]=g,f[h+2]=g;b.H.qa=c[1];b.H.ga=E[1];-Infinity==b.H.U&&(b.H.U=c[1]);Infinity==b.H.W&&(b.H.W=E[1]);b.H.K=H;b.H.bd=f;b.H.j=q;D.Ba(this.f+".parse");e=new pd;e.G=b;e.v=a;this.dispatchEvent(e)};A("X.parserCRV",dg);A("X.parserCRV.prototype.parse",dg.prototype.parse);function eg(a,b){var c,e;this.input=a;this.M=0;if(b||!(b={}))b.index&&(this.M=b.index),b.verify&&(this.vk=b.verify);c=a[this.M++];e=a[this.M++];switch(c&15){case 8:this.method=8;break;default:m(Error("unsupported compression method"))}0!==((c<<8)+e)%31&&m(Error("invalid fcheck flag:"+((c<<8)+e)%31));e&32&&m(Error("fdict flag is not supported"));this.xh=new yf(a,{index:this.M,bufferSize:b.bufferSize,bufferType:b.bufferType,resize:b.resize})}
eg.prototype.$b=function(){var a=this.input,b;b=this.xh.$b();this.M=this.xh.M;if(this.vk){var a=(a[this.M++]<<24|a[this.M++]<<16|a[this.M++]<<8|a[this.M++])>>>0,c=b;if("string"===typeof c){var c=c.split(""),e,d;e=0;for(d=c.length;e<d;e++)c[e]=(c[e].charCodeAt(0)&255)>>>0}e=1;d=0;for(var f=c.length,g,h=0;0<f;){g=1024<f?1024:f;f-=g;do e+=c[h++],d+=e;while(--g);e%=65521;d%=65521}a!==(d<<16|e)>>>0&&m(Error("invalid adler-32 checksum"))}return b};function fg(){Ve.call(this);this.f="parserRAW"}C(fg,Ve);
fg.prototype.parse=function(a,b,c,e){D.Ia(this.f+".parse");e&&(c=(new eg(new Uint8Array(c))).$b(),c=c.buffer);e={};e.data=new Uint8Array(c);var d=We(e.data);c=d[0];d=d[1];e.min=b.qa=b.da=c;e.max=b.ga=b.ca=d;-Infinity==b.U&&(b.U=c);Infinity==b.W&&(b.W=d);d=Uc();e.cb=d;e.fb=Uc();var f=Sc(0,0,0,1);c=Rc();gd(d,f,c);var g=Sc(1,1,1,1),f=Rc();gd(d,g,f);d=Ye(d,b.s);e.Fc=[f[0]-c[0],f[1]-c[1],f[2]-c[2]];e.Dc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];e.Ec=[d[0],d[2],d[4]];b.Kb(e);D.Ba(this.f+".parse");b.hb=gf(this,
b);e=new pd;e.G=b;e.v=a;this.dispatchEvent(e)};A("X.parserRAW",fg);A("X.parserRAW.prototype.parse",fg.prototype.parse);function gg(){Ve.call(this);this.f="parserLUT"}C(gg,Ve);
gg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");this.L=c;c=Z(this,"uchar",c.byteLength);var e=c.length,d=0,f;for(f=0;f<e;f++)if(10==c[f]){var g=Xe(c,d,f),d=f+1,g=g.replace(/^\s+|\s+$/g,"");"#"!=g[0]&&(g=g.split(" "),g=g.filter(function(a){return""!=a}),6==g.length&&(g[2]=parseInt(g[2],10)/255,g[3]=parseInt(g[3],10)/255,g[4]=parseInt(g[4],10)/255,g[5]=parseInt(g[5],10)/255,a.add(parseInt(g[0],10),g[1],g[2],g[3],g[4],g[5],10)))}D.Ba(this.f+".parse");c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};
A("X.parserLUT",gg);A("X.parserLUT.prototype.parse",gg.prototype.parse);function hg(){Ve.call(this);this.f="parserMRC"}C(hg,Ve);
hg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");c=this.zc(c);var e=c.min,d=c.max;b.s=[c.Gd,c.Hd,c.Id];b.pb=[c.Fe/c.dh,c.Kh/c.eh,c.Lh/c.fh];b.qa=b.da=e;b.ga=b.ca=d;-Infinity==b.U&&(b.U=e);Infinity==b.W&&(b.W=d);d=Tc();T(d,3,0,0,0,1);T(d,0,-1,0,0,c.Gd);T(d,1,0,0,-1,c.Hd);T(d,2,0,-1,0,c.Id);c.cb=d;c.fb=Tc();ed(c.cb,c.fb);var f=Sc(0,0,0,1),e=Rc();gd(d,f,e);var g=Sc(1,1,1,1),f=Rc();gd(d,g,f);g=[c.Gd,c.Hd,c.Id];d=Ye(d,g);c.Fc=[f[0]-e[0],f[1]-e[1],f[2]-e[2]];c.Dc=[d[1]+d[0]+1,d[3]-d[2]+1,d[5]-d[4]+
1];c.Ec=[d[0],d[2],d[4]];b.s=g;b.Kb(c);b.hb=gf(this,b);D.Ba(this.f+".parse");c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};
hg.prototype.zc=function(a){this.L=a;a={Gd:0,Hd:0,Id:0,mode:0,Ql:0,Rl:0,Sl:0,dh:0,eh:0,fh:0,Fe:0,Kh:0,Lh:0,alpha:0,ji:0,Gi:0,hj:0,ij:0,jj:0,ef:0,ge:0,uc:0,Jl:0,next:0,pi:0,Ai:s,qj:0,sj:0,Ai:s,Vi:0,Gl:0,Si:0,dj:0,mj:0,nj:0,tk:0,uk:0,qk:s,wk:0,yk:0,zk:0,xl:0,Yl:0,ck:0,rj:0,data:s,min:Infinity,max:-Infinity,Nl:0,Ah:s,Xl:s,Vl:s,orientation:s,Pl:s};this.F=0;a.Gd=Z(this,"sint");a.Hd=Z(this,"sint");a.Id=Z(this,"sint");a.mode=Z(this,"sint");var b=a.Gd*a.Hd*a.Id;this.F=1024;switch(a.mode){case 0:a.data=Z(this,
"schar",b);break;case 1:a.data=Z(this,"sshort",b);break;case 2:a.data=Z(this,"float",b);break;case 3:a.data=Z(this,"uint",b);break;case 4:a.data=Z(this,"double",b);break;case 6:a.data=Z(this,"ushort",b);break;case 16:a.data=Z(this,"uchar",b);break;default:m(Error("Unsupported MRC data type: "+a.mode))}this.F=28;a.dh=Z(this,"sint");a.eh=Z(this,"sint");a.fh=Z(this,"sint");a.Fe=Z(this,"float");a.Kh=Z(this,"float");a.Lh=Z(this,"float");a.alpha=Z(this,"float");a.ji=Z(this,"float");a.Gi=Z(this,"float");
a.hj=Z(this,"sint");a.ij=Z(this,"sint");a.jj=Z(this,"sint");a.ef=Z(this,"float");a.ge=Z(this,"float");a.uc=Z(this,"float");a.Il=Z(this,"sint");a.next=Z(this,"sint");a.pi=Z(this,"short");a.qj=Z(this,"short");a.sj=Z(this,"short");a.Vi=Z(this,"sint");a.Fl=Z(this,"sint");a.Si=Z(this,"short");a.dj=Z(this,"short");a.mj=Z(this,"short");a.nj=Z(this,"short");a.tk=Z(this,"short");a.uk=Z(this,"short");a.qk=Z(this,"float",6);this.F=196;a.wk=Z(this,"float");a.yk=Z(this,"float");a.zk=Z(this,"float");this.F=216;
a.ck=Z(this,"float");a.rj=Z(this,"sint");a.Kl=Z(this,"schar",10);if(0!=a.next)switch(this.F=parseInt(a.next+1024,10),a.mode){case 0:a.data=Z(this,"schar",b);break;case 1:a.data=Z(this,"sshort",b);break;case 2:a.data=Z(this,"float",b);break;case 3:a.data=Z(this,"uint",b);break;case 4:a.data=Z(this,"double",b);break;case 6:a.data=Z(this,"ushort",b);break;case 16:a.data=Z(this,"uchar",b);break;default:m(Error("Unsupported MRC data type: "+a.mode))}0>a.uc-(a.ge-a.uc)?(a.min=a.ef,a.max=a.uc+(a.uc-a.ef)):
(a.min=a.uc-(a.ge-a.uc),a.max=a.ge);return a};A("X.parserMRC",hg);A("X.parserMRC.prototype.parse",hg.prototype.parse);function ig(){Ve.call(this);this.f="parserNRRD"}C(ig,Ve);
ig.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");this.L=c;c=Z(this,"uchar",c.byteLength);var e=c.length,d=s,f=0,g;for(g=1;g<e;g++)if(10==c[g-1]&&10==c[g]){d=Xe(c,0,g-2);f=g+1;break}var h,k,j,l,e=d.split(/\r?\n/),d=0;for(g=e.length;d<g;d++)if(h=e[d],h.match(/NRRD\d+/))this.bj=q;else if(!h.match(/^#/)&&(l=h.match(/(.*):(.*)/)))k=l[1].trim(),h=l[2].trim(),(j=this.Bi[k])?j.call(this,h):this[k]=h;this.bj||m(Error("Not an NRRD file"));"raw"!==this.encoding&&("gzip"!==this.encoding&&"gz"!==this.encoding)&&
m(Error("Only raw or gz/gzip encoding is allowed"));if(!this.fa&&(this.fa=[new R(1,0,0),new R(0,1,0),new R(0,0,1)],this.Tf)){e=[];for(l=0;2>=l;l++)e.push(!isNaN(this.Tf[l])?this.fa[l].scale(this.Tf[l]):p)}f=c.subarray(f);if("gzip"==this.encoding||"gz"==this.encoding)f=(new ag(new Uint8Array(f))).$b();f=f.buffer;c={data:s,min:Infinity,max:-Infinity};c.data=new this.Pb(f);l=We(c.data);f=c.min=l[0];l=c.max=l[1];b.qa=b.da=f;b.ga=b.ca=l;b.s=[this.Rf[0],this.Rf[1],this.Rf[2]];e=(new R(this.fa[0][0],this.fa[0][1],
this.fa[0][2])).Mb();d=(new R(this.fa[1][0],this.fa[1][1],this.fa[1][2])).Mb();g=(new R(this.fa[2][0],this.fa[2][1],this.fa[2][2])).Mb();b.pb=[e,d,g];-Infinity==b.U&&(b.U=f);Infinity==b.W&&(b.W=l);e=l=1;"left-posterior-superior"==this.Ah&&(e=l=-1);f=Uc();"false"==b.reslicing||b.reslicing==t?(T(f,0,l,0,0,0),T(f,1,0,e,0,0),T(f,2,0,0,1,0)):(T(f,0,l*this.fa[0][0],l*this.fa[1][0],l*this.fa[2][0],l*this.Sf[0]),T(f,1,e*this.fa[0][1],e*this.fa[1][1],e*this.fa[2][1],e*this.Sf[1]),T(f,2,1*this.fa[0][2],1*this.fa[1][2],
1*this.fa[2][2],1*this.Sf[2]));T(f,3,0,0,0,1);c.cb=f;c.fb=Tc();ed(c.cb,c.fb);e=Sc(0,0,0,1);l=Rc();gd(f,e,l);d=Sc(1,1,1,1);e=Rc();gd(f,d,e);f=Ye(f,b.s);c.Fc=[e[0]-l[0],e[1]-l[1],e[2]-l[2]];c.Dc=[f[1]-f[0]+1,f[3]-f[2]+1,f[5]-f[4]+1];c.Ec=[f[0],f[2],f[4]];b.Kb(c);D.Ba(this.f+".parse");b.hb=gf(this,b);c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};
ig.prototype.Bi={type:function(a){switch(a){case "uchar":case "unsigned char":case "uint8":case "uint8_t":this.Pb=Uint8Array;break;case "signed char":case "int8":case "int8_t":this.Pb=Int8Array;break;case "short":case "short int":case "signed short":case "signed short int":case "int16":case "int16_t":this.Pb=Int16Array;break;case "ushort":case "unsigned short":case "unsigned short int":case "uint16":case "uint16_t":this.Pb=Uint16Array;break;case "int":case "signed int":case "int32":case "int32_t":this.Pb=
Int32Array;break;case "uint":case "unsigned int":case "uint32":case "uint32_t":this.Pb=Uint32Array;break;case "float":this.Pb=Float32Array;break;case "double":this.Pb=Float64Array;break;default:m(Error("Unsupported NRRD data type: "+a))}return this.type=a},endian:function(a){return this.Cl=a},encoding:function(a){return this.encoding=a},dimension:function(a){return this.ac=parseInt(a,10)},sizes:function(a){var b,c,e,d;e=a.split(/\s+/);d=[];b=0;for(c=e.length;b<c;b++)a=e[b],d.push(parseInt(a,10));
return this.Rf=d},space:function(a){return this.Ah=a},"space origin":function(a){return this.Sf=a.split("(")[1].split(")")[0].split(",")},"space directions":function(a){var b,c;a=a.match(/\(.*?\)/g);var e,d,f;f=[];e=0;for(d=a.length;e<d;e++)c=a[e],f.push(function(){var a,d,e,f;e=c.slice(1,-1).split(/,/);f=[];a=0;for(d=e.length;a<d;a++)b=e[a],f.push(parseFloat(b));return f}());return this.fa=f},spacings:function(a){var b;b=a.split(/\s+/);var c,e,d;d=[];c=0;for(e=b.length;c<e;c++)a=b[c],d.push(parseFloat(a));
return this.Tf=d}};A("X.parserNRRD",ig);A("X.parserNRRD.prototype.parse",ig.prototype.parse);function jg(){Ve.call(this);this.f="parserSTL"}C(jg,Ve);
jg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");this.L=c;var e=b.h,d=b.o;if("solid"==Xe(Z(this,"uchar",5))){b.h=e=new W(c.byteLength);b.o=d=new W(c.byteLength);var f=e,e=d,d=Z(this,"uchar",c.byteLength-5);c=d.length;var g=t,h=t,k=0,j;for(j=0;j<c;j++)if(10==d[j]){if(g||h){var l=Xe(d,k,j).split(" "),h=parseFloat(l[0]),n=parseFloat(l[1]),l=parseFloat(l[2]);g?(e.add(h,n,l),e.add(h,n,l),e.add(h,n,l)):f.add(h,n,l);h=g=t}}else 32==d[j-1]&&(102==d[j]?(k=j+=13,g=q):118==d[j]&&(k=j+=7,h=q))}else{this.F=
80;f=Z(this,"uint");b.h=e=new W(9*f);b.o=d=new W(9*f);for(c=c=0;c<f;c++)g=Z(this,"float",12),k=g[0],j=g[1],h=g[2],d.add(k,j,h),d.add(k,j,h),d.add(k,j,h),e.add(g[3],g[4],g[5]),e.add(g[6],g[7],g[8]),e.add(g[9],g[10],g[11]),this.F+=2}D.Ba(this.f+".parse");f=new pd;f.G=b;f.v=a;this.dispatchEvent(f)};A("X.parserSTL",jg);A("X.parserSTL.prototype.parse",jg.prototype.parse);function kg(){Ve.call(this);this.f="parserNII"}C(kg,Ve);
kg.prototype.parse=function(a,b,c){if(!lg(c))try{c=(new ag(new Uint8Array(c))).$b().buffer,lg(c)||(this.Pc=t)}catch(e){this.Pc=t}c=this.zc(c);var d=c.min,f=c.max;b.qa=b.da=d;b.ga=b.ca=f;-Infinity==b.U&&(b.U=d);Infinity==b.W&&(b.W=f);d=Tc();T(d,3,0,0,0,1);if("false"==b.reslicing||b.reslicing==t){var g=f=1,h=1;0<c.ra[1]&&(f=c.ra[1]);0<c.ra[2]&&(g=c.ra[2]);0<c.ra[2]&&(h=c.ra[3]);0>c.ra[0]&&(h=-h);T(d,0,f,0,0,0);T(d,1,0,g,0,0);T(d,2,0,0,h,0)}else if(0<c.Nf){var k=0,j=c.th,l=c.uh,n=c.vh,h=g=f=1,w=c.qh,
r=c.rh,x=c.sh,k=1-(j*j+l*l+n*n);1E-7>k?(k=1/Math.sqrt(j*j+l*l+n*n),j*=k,l*=k,n*=k,k=0):k=Math.sqrt(k);0<c.ra[1]&&(f=c.ra[1]);0<c.ra[2]&&(g=c.ra[2]);0<c.ra[2]&&(h=c.ra[3]);0>c.ra[0]&&(h=-h);T(d,0,(k*k+j*j-l*l-n*n)*f,2*(j*l-k*n)*g,2*(j*n+k*l)*h,w);T(d,1,2*(j*l+k*n)*f,(k*k+l*l-j*j-n*n)*g,2*(l*n-k*j)*h,r);T(d,2,2*(j*n-k*l)*f,2*(l*n+k*j)*g,(k*k+n*n-l*l-j*j)*h,x)}else 0<c.yh?(f=c.Bh,g=c.Ch,h=c.Dh,T(d,0,f[0],f[1],f[2],f[3]),T(d,1,g[0],g[1],g[2],g[3]),T(d,2,h[0],h[1],h[2],h[3])):0==c.Nf?(T(d,0,c.ra[1],0,
0,0),T(d,1,0,c.ra[2],0,0),T(d,2,0,0,c.ra[3],0)):window.console.log("UNKNOWN METHOD IN PARSER NII");c.cb=d;c.fb=Tc();ed(c.cb,c.fb);g=Sc(0,0,0,1);f=Rc();gd(d,g,f);h=Sc(1,1,1,1);g=Rc();gd(d,h,g);h=[c.ac[1],c.ac[2],c.ac[3]];d=Ye(d,h);c.Fc=[g[0]-f[0],g[1]-f[1],g[2]-f[2]];c.Dc=[d[1]-d[0]+1,d[3]-d[2]+1,d[5]-d[4]+1];c.Ec=[d[0],d[2],d[4]];b.s=h;b.Kb(c);b.hb=gf(this,b);c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};
kg.prototype.zc=function(a){this.L=a;a={hk:0,qi:s,ri:s,zi:0,fk:0,$j:0,vi:s,ac:s,Yi:0,Zi:0,$i:0,Wi:0,pf:0,ki:0,mk:0,ra:s,Ih:0,ek:0,dk:0,lk:0,jk:s,xk:s,li:0,mi:0,kk:0,rk:0,Ii:0,Ji:0,ti:s,ii:s,Nf:0,yh:0,th:0,uh:0,vh:0,qh:0,rh:0,sh:0,Bh:s,Ch:s,Dh:s,Xi:s,ej:s,data:s,min:Infinity,max:-Infinity};a.hk=Z(this,"uint");a.qi=Z(this,"uchar",10);a.ri=Z(this,"uchar",18);a.zi=Z(this,"uint");a.fk=Z(this,"ushort");a.$j=Z(this,"uchar");a.vi=Z(this,"uchar");a.ac=Z(this,"ushort",8);a.Yi=Z(this,"float");a.Zi=Z(this,"float");
a.$i=Z(this,"float");a.Wi=Z(this,"ushort");a.pf=Z(this,"ushort");a.ki=Z(this,"ushort");a.mk=Z(this,"ushort");a.ra=Z(this,"float",8);a.Ih=Z(this,"float");a.ek=Z(this,"float");a.dk=Z(this,"float");a.lk=Z(this,"ushort");a.jk=Z(this,"uchar");a.xk=Z(this,"uchar");a.li=Z(this,"float");a.mi=Z(this,"float");a.kk=Z(this,"float");a.rk=Z(this,"float");a.Ii=Z(this,"uint",1);a.Ji=Z(this,"uint",1);a.ti=Z(this,"uchar",80);a.ii=Z(this,"uchar",24);a.Nf=Z(this,"ushort");a.yh=Z(this,"ushort");a.th=Z(this,"float");a.uh=
Z(this,"float");a.vh=Z(this,"float");a.qh=Z(this,"float");a.rh=Z(this,"float");a.sh=Z(this,"float");a.Bh=Z(this,"float",4);a.Ch=Z(this,"float",4);a.Dh=Z(this,"float",4);a.Xi=Z(this,"uchar",16);a.ej=Z(this,"uchar",4);this.F=parseInt(a.Ih,10);var b=a.ac[1]*a.ac[2]*a.ac[3];switch(a.pf){case 2:a.data=Z(this,"uchar",b);break;case 4:a.data=Z(this,"sshort",b);break;case 8:a.data=Z(this,"sint",b);break;case 16:a.data=Z(this,"float",b);break;case 32:a.data=Z(this,"complex",b);break;case 64:a.data=Z(this,"double",
b);break;case 256:a.data=Z(this,"schar",b);break;case 512:a.data=Z(this,"ushort",b);break;case 768:a.data=Z(this,"uint",b);break;default:m(Error("Unsupported NII data type: "+a.pf))}b=We(a.data);a.min=b[0];a.max=b[1];return a};function lg(a){var b=-1,b="undefined"==typeof DataView?(new Int32Array(a,0,1))[0]:(new DataView(a,0)).getInt32(0,q);return 348==b?q:t}A("X.parserNII",kg);A("X.parserNII.prototype.parse",kg.prototype.parse);function mg(){Ve.call(this);this.f="parserTRK"}C(mg,Ve);
mg.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");var e=b.h,d=b.o,f=b.oa;this.L=c;Z(this,"uchar",6);Z(this,"ushort",3);var g=Z(this,"float",3);Z(this,"float",3);var h=Z(this,"ushort");Z(this,"uchar",200);Z(this,"ushort");Z(this,"uchar",200);c=Z(this,"float",16);Z(this,"uchar",444);Z(this,"uchar",4);Z(this,"uchar",4);Z(this,"float",6);Z(this,"uchar",2);Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");Z(this,"uchar");var k=Z(this,"uint");Z(this,"uint");var j=Z(this,
"uint"),l=0===k?Infinity:k,n=[],w=[],k=Infinity,r=-Infinity,x=s,z=s,E=s,H=s,d=e=s,J=Z(this,"uint",(this.L.byteLength-1E3)/4);this.F=j;for(var B=Z(this,"float",(this.L.byteLength-1E3)/4),F=0,j=f=0;j<l;j++){if("undefined"===typeof J[F]){l=j;break}for(var G=J[F],M=new W(3*G),Q=0,N=0;N<G;N++){var U=B[F+3*N+N*h+1],da=B[F+3*N+N*h+2],I=B[F+3*N+N*h+3],U=U/g[0],da=da/g[1],I=I/g[2];M.add(U,da,I);if(0<N)var aa=M.get(N-1),Q=Q+Math.sqrt(Math.pow(U-aa[0],2)+Math.pow(da-aa[1],2)+Math.pow(I-aa[2],2));N<G-1&&(f+=
6)}F+=3*G+G*h+1;N=M.mb;G=M.jb;U=M.nb;da=M.kb;I=M.ob;aa=M.lb;if(!x||N<x)x=N;if(!z||G>z)z=G;if(!E||U<E)E=U;if(!H||da>H)H=da;if(!e||I<e)e=I;if(!d||aa>d)d=aa;n.push(M);w.push(Q)}g=(x+z)/2;h=(E+H)/2;H=(e+d)/2;E=new Float32Array(f);b.h=e=new W(f);b.o=d=new W(f);b.oa=f=new W(f);for(j=x=0;j<l;j++){z=n[j];J=z.count;Q=w[j];k=Math.min(k,Q);r=Math.max(r,Q);for(N=0;N<J-1;N++){F=z.get(N);B=z.get(N+1);e.add(F[0],F[1],F[2]);e.add(B[0],B[1],B[2]);var M=F[0]-g,G=F[1]-h,U=F[2]-H,da=Math.sqrt(M*M+G*G+U*U),I=B[0]-g,aa=
B[1]-h,ma=B[2]-H,S=Math.sqrt(I*I+aa*aa+ma*ma);d.add(M/da,G/da,U/da);d.add(I/S,aa/S,ma/S);B=[Math.abs(B[0]-F[0]),Math.abs(B[1]-F[1]),Math.abs(B[2]-F[2])];F=Math.sqrt(B[0]*B[0]+B[1]*B[1]+B[2]*B[2]);B[0]/=F;B[1]/=F;B[2]/=F;f.add(B[0],B[1],B[2]);f.add(B[0],B[1],B[2]);E[x++]=Q;E[x++]=Q;E[x++]=Q;E[x++]=Q;E[x++]=Q;E[x++]=Q}}b.Ha="LINES";l=new od;l.qa=k;l.ga=r;l.U=k;l.W=r;l.bd=E;l.vg=t;l.j=q;b.H=l;k=t;for(j=0;16>j;j++)if(0!=c[j]){k=q;break}k==t&&(c[0]=c[5]=c[10]=c[15]=1);D.Ba(this.f+".parse");D.g.Wf(c,b.ha.Q);
c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};A("X.parserTRK",mg);A("X.parserTRK.prototype.parse",mg.prototype.parse);function ng(){Ve.call(this);this.f="parserOBJ"}C(ng,Ve);
ng.prototype.parse=function(a,b,c){D.Ia(this.f+".parse");this.L=c;c=c.byteLength;var e=Z(this,"uchar",c),d=[];b.h=new W(c);b.o=new W(c);var f=b.h,g=b.o,h=0,k;for(k=0;k<c;++k)if(10==e[k]){var j=Xe(e,h,k).replace(/\s{2,}/g," ").split(" ");if("v"==j[0])d.push([parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3])]);else if("f"==j[0]){var l=d[parseInt(j[1],10)-1],h=d[parseInt(j[2],10)-1],j=d[parseInt(j[3],10)-1];f.add(l[0],l[1],l[2]);f.add(h[0],h[1],h[2]);f.add(j[0],j[1],j[2]);l=new R(l[0],l[1],l[2]);j=
new R(j[0],j[1],j[2]);h=Kc((new R(h[0],h[1],h[2])).va(l),j.va(l));h.normalize();g.add(h.x,h.y,h.d);g.add(h.x,h.y,h.d);g.add(h.x,h.y,h.d)}h=k+1}D.Ba(this.f+".parse");c=new pd;c.G=b;c.v=a;this.dispatchEvent(c)};A("X.parserOBJ",ng);A("X.parserOBJ.prototype.parse",ng.prototype.parse);function og(){O.call(this);this.f="loader";this.Nc=new Bc;this.sd=0}C(og,O);function pg(a,b){a.sd+=b/a.Nc.sf()/3;a.sd=Math.min(1,a.sd);var c=new Sd;c.zd=a.sd;a.dispatchEvent(c)}function qg(a){a=a.r.Zd;var b=a.split(".").pop().toUpperCase();if(b==a.toUpperCase()||NaN!=parseInt(b))b="";b in rg||m(Error("The "+b+" file format is not supported."));return[a,b,rg[b][0],rg[b][1],rg[b][2]]}
og.prototype.load=function(a,b){(!a||!b)&&m(Error("No container or object to load."));if(!Ec(this.Nc.ea,a.pa)||this.Nc.get(a.pa)){this.Nc.set(a.pa,t);var c=qg(a)[0];if(a.Za!=s)this.parse(s,a,b);else{var e=new XMLHttpRequest;L(e,"abort",this.Jg.bind(this,e,a,b));L(e,"error",this.Jg.bind(this,e,a,b));L(e,"load",this.parse.bind(this,e,a,b));e.open("GET",c,q);e.responseType="arraybuffer";e.send(s)}}};
og.prototype.parse=function(a,b,c){pg(this,1);setTimeout(function(){var e=qg(b),d=e[3],e=new e[2];ac(e,Cd,this.complete.bind(this));var f=b.Za;f==s&&(f=a.response,b.Za=f);e.parse(b,c,f,d)}.bind(this),100)};og.prototype.complete=function(a){pg(this,1);setTimeout(function(){var b=a.v,c=a.G;b.r.j=t;b.j=q;c.q();this.Nc.set(b.pa,q)}.bind(this),100)};og.prototype.Jg=function(a,b,c){m(Error("Loading failed: ",b,c))};
var rg={OBJ:[ng,s],OFF:[qf,s],STL:[jg,s],VTK:[tf,s],TRK:[mg,s],MRC:[hg,s],ST:[hg,s],FSM:[vf,s],INFLATED:[vf,s],SMOOTHWM:[vf,s],SPHERE:[vf,s],PIAL:[vf,s],ORIG:[vf,s],NRRD:[ig,s],NII:[kg,s],GZ:[kg,s],DCM:[rf,s],DICOM:[rf,s],"":[rf,s],CRV:[dg,s],LABEL:[cg,s],MGH:[bg,t],MGZ:[bg,q],RAW:[fg,t],RZ:[fg,q],TXT:[gg,s],LUT:[gg,s],PNG:[hf,"png"],JPG:[hf,"jpeg"],JPEG:[hf,"jpeg"],GIF:[hf,"gif"]};function sg(a){function b(a,b,e){b=2*b*Math.PI;b=za(Aa(k,Math.cos(b)),Aa(j,Math.sin(b)));a=za(za(c,Aa(d,a)),Aa(b,f));e=za(Aa(b,1-Math.abs(e)),Aa(g,e));return new lc(a,e)}this.Z=[];a=a||{};var c=new ya(a.start||[0,-1,0]),e=new ya(a.end||[0,1,0]),d=Ca(e,c),f=a.yb||1;a=a.sa||16;for(var g=Da(d),h=0.5<Math.abs(g.y()),k=Da((new ya(h,!h,0)).wc(g)),j=Da(k.wc(g)),h=new lc(c,Ea(g)),e=new lc(e,Da(g)),l=[],n=0;n<a;n++){var w=n/a,r=(n+1)/a;l.push(new nc([h,b(0,w,-1),b(0,r,-1)]));l.push(new nc([b(0,r,0),b(0,w,
0),b(1,w,0),b(1,r,0)]));l.push(new nc([e,b(1,r,1),b(1,w,1)]))}return wc(l)}C(sg,vc);function tg(){Y.call(this);this.f="cylinder";this.af=[-10,-10,-10];this.Ke=[10,10,10];this.mc=10;this.bb=32;Fa(this,new sd)}C(tg,Y);tg.prototype.__defineGetter__("start",u("af"));tg.prototype.__defineSetter__("start",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid start"));this.af=a});tg.prototype.__defineGetter__("end",u("Ke"));tg.prototype.__defineSetter__("end",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid end"));this.Ke=a});tg.prototype.__defineGetter__("radius",u("mc"));
tg.prototype.__defineSetter__("radius",function(a){y(a)||m(Error("Invalid radius."));this.mc=a});tg.prototype.q=function(){ud(this,new sg({start:this.af,end:this.Ke,yb:this.mc,sa:this.bb}));tg.z.q.call(this)};A("X.cylinder",tg);A("X.cylinder.prototype.modified",tg.prototype.q);function ug(a){function b(a,b){a*=2*Math.PI;b*=Math.PI;var d=new ya(Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b));g.push(new lc(za(c,Aa(d,e)),d))}this.Z=[];a=a||{};var c=new ya(a.lf||[0,0,0]),e=a.yb||1,d=a.sa||16;a=a.nk||8;for(var f=[],g=[],h=0;h<d;h++)for(var k=0;k<a;k++)g=[],b(h/d,k/a),0<k&&b((h+1)/d,k/a),k<a-1&&b((h+1)/d,(k+1)/a),b(h/d,(k+1)/a),f.push(new nc(g));return wc(f)}C(ug,vc);function vg(){Y.call(this);this.f="sphere";this.B=[0,0,0];this.mc=5;this.bb=32;this.ai=16;Fa(this,new sd)}C(vg,Y);vg.prototype.__defineGetter__("center",u("B"));vg.prototype.__defineSetter__("center",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid center"));this.B=a});vg.prototype.__defineGetter__("radius",u("mc"));vg.prototype.__defineSetter__("radius",function(a){y(a)||m(Error("Invalid radius."));this.mc=a});
vg.prototype.q=function(){ud(this,new ug({lf:this.B,yb:this.mc,sa:this.bb,nk:this.ai}));vg.z.q.call(this)};A("X.sphere",vg);A("X.sphere.prototype.modified",vg.prototype.q);function of(a){P.call(this);this.f="labelmap";this.xb=a;this.$e=new Float32Array([-255,-255,-255,-255])}C(of,P);of.prototype.q=function(){var a=new pd;a.G=this;this.dispatchEvent(a);this.xb.q()};of.prototype.__defineSetter__("showOnly",function(a){var b=[-1,-1,-1,-1];a!=s&&(ja(a)&&4==a.length?b=a:(this.wa||m(Error("No colortable assigned.")),b=this.wa.Ja.get(a).slice(1,5)));this.$e=new Float32Array([Math.floor(255*b[0]),Math.floor(255*b[1]),Math.floor(255*b[2]),Math.floor(255*b[3])])});
A("X.labelmap",of);function wg(a){this.Z=[];a=a||{};var b=new ya(a.lf||[0,0,0]),c=!a.yb?[1,1,1]:a.yb.length?a.yb:[a.yb,a.yb,a.yb];return wc([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(a){return new nc(a[0].map(function(d){d=new ya(b.x()+c[0]*(2*!!(d&1)-1),b.y()+c[1]*(2*!!(d&2)-1),b.d()+c[2]*(2*!!(d&4)-1));return new lc(d,new ya(a[1]))}))}))}C(wg,vc);function xg(){Y.call(this);this.f="cube";this.B=[0,0,0];this.Pe=this.Oe=this.Ne=20;this.qc=[0,1,1,1,1,0,0,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,1,1,1,0,1,1,1,0,0,0,1,1,0,0,0,1,0,1,1,1,1,0,0,1,1,0,0,0];Fa(this,new sd)}C(xg,Y);xg.prototype.__defineGetter__("center",u("B"));xg.prototype.__defineSetter__("center",function(a){(a==s||!ja(a)||3!=a.length)&&m(Error("Invalid center"));this.B=a});xg.prototype.__defineGetter__("lengthX",u("Ne"));
xg.prototype.__defineSetter__("lengthX",function(a){y(a)||m(Error("Invalid lengthX."));this.Ne=a});xg.prototype.__defineGetter__("lengthY",u("Oe"));xg.prototype.__defineSetter__("lengthY",function(a){y(a)||m(Error("Invalid lengthY."));this.Oe=a});xg.prototype.__defineGetter__("lengthZ",u("Pe"));xg.prototype.__defineSetter__("lengthZ",function(a){y(a)||m(Error("Invalid lengthZ."));this.Pe=a});xg.prototype.q=function(){ud(this,new wg({lf:this.B,yb:[this.Ne/2,this.Oe/2,this.Pe/2]}));xg.z.q.call(this)};
A("X.cube",xg);A("X.cube.prototype.modified",xg.prototype.q);function Pe(a){Ne.call(this,a);this.f="interactor3D";this.ol=t}C(Pe,Ne);Pe.prototype.Jd=function(a){Pe.z.Jd.call(this,a);var b=new Nd;a.Wc==s&&(a.Wc=0);b.Bb=0>a.Wc;b.ub=q;this.dispatchEvent(b)};function yg(a){O.call(this);this.f="array";this.K=[];this.dg=a}C(yg,O);function zg(a,b,c){for(var e=0;4>e;e++)if(a[e+0]!==b[e+c])return t;return q}yg.prototype.add=function(a){this.K.push(a);return q};yg.prototype.remove=function(a){a=this.K.indexOf(a);-1<a&&this.K.splice(a,1);return q};yg.prototype.clear=function(){this.K.length=0};
function Ag(a,b,c){var e=c-b;if(!(2>e)){e=b+Math.floor(e/2);Ag(a,b,e);for(Ag(a,e,c);b<e;++b)if(0<a.dg(a.K[b],a.K[e])){var d=a.K[b];a.K[b]=a.K[e];for(var f=a,g=e,h=c;g+1<h&&0>f.dg(f.K[g+1],d);){var k=f,j=g+1,l=k.K[g];k.K[g]=k.K[j];k.K[j]=l;++g}f.K[g]=d}}}yg.prototype.sort=function(){Ag(this,0,this.K.length)};function Bg(a){Nb.call(this);this.Lb=a;this.T=[]}C(Bg,Nb);var Cg=[];function Dg(a,b,c,e,d){ja(c)||(Cg[0]=c,c=Cg);for(var f=0;f<c.length;f++){var g=L(b,c[f],e||a,d||t,a.Lb||a);a.T.push(g)}}Bg.prototype.Of=function(){Ib(this.T,cc);this.T.length=0};Bg.prototype.handleEvent=function(){m(Error("EventHandler.handleEvent not implemented"))};function Eg(){}Eg.Lg=function(){return Eg.Tg?Eg.Tg:Eg.Tg=new Eg};Eg.prototype.oj=0;Eg.Lg();function Fg(a){kc.call(this);this.bc=a||ce();this.bk=Gg}C(Fg,kc);Fg.prototype.Ri=Eg.Lg();var Gg=s;v=Fg.prototype;v.Sg=s;v.Yc=t;v.J=s;v.bk=s;v.Kd=s;v.Bd=s;v.mf=s;v.u=u("J");v.Qf=function(a){this.Kd&&this.Kd!=a&&m(Error("Method not supported"));Fg.z.Qf.call(this,a)};v.me=u("bc");v.Vc=function(){this.J=this.bc.createElement("div")};v.ec=function(a){this.fc(a)};
v.fc=function(a,b){this.Yc&&m(Error("Component already rendered"));this.J||this.Vc();a?a.insertBefore(this.J,b||s):this.bc.ia.body.appendChild(this.J);(!this.Kd||this.Kd.Yc)&&this.je()};v.je=function(){function a(a){!a.Yc&&a.u()&&a.je()}this.Yc=q;this.Bd&&Ib(this.Bd,a,p)};v.ke=function(){function a(a){a.Yc&&a.ke()}this.Bd&&Ib(this.Bd,a,p);this.Ki&&this.Ki.Of();this.Yc=t};
v.removeChild=function(a,b){if(a){var c=na(a)?a:a.Sg||(a.Sg=":"+(a.Ri.oj++).toString(36)),e;this.mf&&c?(e=this.mf,e=(c in e?e[c]:p)||s):e=s;a=e;c&&a&&(e=this.mf,c in e&&delete e[c],Lb(this.Bd,a),b&&(a.ke(),a.J&&ke(a.J)),c=a,c==s&&m(Error("Unable to set parent component")),c.Kd=s,Fg.z.Qf.call(c,s))}a||m(Error("Child is not in parent component"));return a};function Hg(){kc.call(this)}C(Hg,kc);v=Hg.prototype;v.Yf=0;v.Fd=0;v.zf=100;v.Ig=0;v.Uf=1;v.aj=t;v.lj=t;v.Nd=function(a){a=Ig(this,a);this.Yf!=a&&(this.Yf=a+this.Ig>this.zf?this.zf-this.Ig:a<this.Fd?this.Fd:a,!this.aj&&!this.lj&&this.dispatchEvent("change"))};v.pe=function(){return Ig(this,this.Yf)};v.oe=function(){return Ig(this,this.Fd)};v.ne=function(){return Ig(this,this.zf)};function Ig(a,b){return a.Uf==s?b:a.Fd+Math.round((b-a.Fd)/a.Uf)*a.Uf};function Jg(a){Fg.call(this,a);this.Ld=new Hg;L(this.Ld,"change",this.Li,t,this)}C(Jg,Fg);var Kg={vertical:"progress-bar-vertical",horizontal:"progress-bar-horizontal"};v=Jg.prototype;v.Vc=function(){this.zb=this.me().Vc("div","progress-bar-thumb");var a=Kg[this.nh];this.J=this.me().Vc("div",a,this.zb);Lg(this);a=this.oe();this.u().setAttribute("aria-valuemin",a);a=this.ne();this.u().setAttribute("aria-valuemax",a)};
v.je=function(){Jg.z.je.call(this);K&&7>tb&&L(this.u(),"resize",this.Ee,t,this);this.Ee();var a=this.u();a.setAttribute("role","progressbar");a.setAttribute("aria-live","polite")};v.ke=function(){Jg.z.ke.call(this);K&&7>tb&&bc(this.u(),"resize",this.Ee,t,this)};v.pe=function(){return this.Ld.pe()};v.Nd=function(a){this.Ld.Nd(a);this.u()&&Lg(this)};function Lg(a){var b=a.pe();a.u().setAttribute("aria-valuenow",b)}v.oe=function(){return this.Ld.oe()};v.ne=function(){return this.Ld.ne()};v.nh="horizontal";
v.Li=function(){this.Ee();this.dispatchEvent("change")};v.Ee=function(){if(this.zb){var a=this.oe(),b=this.ne(),a=(this.pe()-a)/(b-a),b=Math.round(100*a);"vertical"==this.nh?K&&7>tb?(this.zb.style.top=0,this.zb.style.height="100%",b=this.zb.offsetHeight,a=Math.round(a*b),this.zb.style.top=b-a+"px",this.zb.style.height=a+"px"):(this.zb.style.top=100-b+"%",this.zb.style.height=b+"%"):this.zb.style.width=b+"%"}};function Mg(a,b){a==s&&m(Error("No valid parent element."));b==s&&m(Error("Invalid initial value."));Jg.call(this);this.f="progressbar";this.ab=a;this.Ue="";this.Sd=this.Jb=s;this.hc=[];var c;c=".progress-bar-horizontal {\n  position: relative;\n  border: 1px solid #949dad;\n";c+="  background: white;\n";c+="  padding: 1px;\n";c+="  overflow: hidden;\n";c+="  margin: 2px;\n";c+="  width: 100px;\n";c+="  height: 5px;\n";c+="}";var e;e=".progress-bar-thumb {\n  position: relative;\n  background: #F62217;\n";
e+="  overflow: hidden;\n";e+="  width: 0%;\n";e+="  height: 100%;\n";e+="}";var d;d=".progress-bar-thumb-done {\n  background: #57E964;\n}";this.hc=[c,e,d];this.Nd(b);this.uf()}C(Mg,Jg);
Mg.prototype.uf=function(){var a=se(this.ab,"position");if("static"==a||""==a)this.Ue=this.ab.style.position,this.ab.style.position="relative";var a=document.getElementsByTagName("head")[0],b=he("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.hc[0])),e=document.createTextNode(String(this.hc[1])),d=document.createTextNode(String(this.hc[2]));a.appendChild(b);b.appendChild(c);b.appendChild(e);b.appendChild(d);this.Jb=b;this.ec(this.ab);a=this.u();a.style.position=
"absolute";a.style.top=(this.ab.clientHeight-5)/2+"px";a.style.left=(this.ab.clientWidth-100)/2+"px";a.classList.add("xtk-progress-bar")};function Ng(a){var b=a.u().style.top,c=a.u().style.left;ke(a.u());var e=new Mg(a.ab,100),d=e.u();d.style.position="absolute";d.style.top=b;d.style.left=c;d.classList.add("xtk-progress-bar");(d.firstElementChild!=p?d.firstElementChild:le(d.firstChild)).classList.add("progress-bar-thumb-done");a.Sd=e}
Mg.prototype.Ed=function(){this.Jb&&ke(this.Jb);this.u()&&ke(this.u());this.Sd&&ke(this.Sd.u());this.Sd=this.Jb=s;this.Ue&&(this.ab.style.position=this.Ue)};function Og(a,b,c){oa(a)?c&&(a=va(a,c)):a&&"function"==typeof a.handleEvent?a=va(a.handleEvent,a):m(Error("Invalid listener argument"));return 2147483647<b?-1:fa.setTimeout(a,b||0)};function Pg(){O.call(this);this.f="renderer";this.v=window.document.body;this.D=this.v.clientWidth;this.w=this.v.clientHeight;this.ib=this.N=this.cg=this.la=s;this.$a=new yg(rd);this.Ga=[];this.$=s;this.Yd=this.fd=this.Wd=t;this.a=this.Xb=this.Ka=s;this.S={PROGRESSBAR_ENABLED:q,INTERMEDIATE_RENDERING:t,SLICENAVIGATORS:q};this.Ge=-1;window.console.log("XTK release 10 -- 2015-10-02 12:19:53 -- http://www.goXTK.com -- @goXTK")}C(Pg,O);v=Pg.prototype;
v.Ef=function(){window.cancelAnimationFrame(this.Ge);this.S.PROGRESSBAR_ENABLED&&(this.Xb=new Mg(this.v,3))};v.Ff=function(){this.S.PROGRESSBAR_ENABLED&&this.Xb&&(Ng(this.Xb),this.Pd=Og(function(){this.Pd=s;this.Xb&&(this.Xb.Ed(),this.Xb=s);this.fd=this.Yd=q;this.ec()}.bind(this),700))};v.Gf=function(a){this.Xb&&this.Xb.Nd(100*a.zd)};v.Fj=function(a){this.Ka&&this.Ka.Nd(100*a.zd)};v.vj=function(a){a!=s&&a instanceof pd&&a.G&&this.tb(a.G)};v.Gj=function(a){a!=s&&a instanceof qd&&a.G&&this.remove(a.G)};
v.If=function(a){(a==s||!(a instanceof Pd))&&m(Error("Invalid hover event."))};v.ue=function(){this.Na()};v.Na=function(){var a=fe(this.v);this.D=a.clientWidth;this.w=a.clientHeight;a=fe(this.la);a.width=this.D;a.height=this.w;a=fe(this.cg);a.width=this.D;a.height=this.w;"renderer3D"==this.f&&(this.a.viewport(0,0,this.D,this.w),this.N.Ve=D.g.yf(D.g.Dd(),this.N.fg,this.la.width/this.la.height,1,1E4))};v.Jf=function(a){(a==s||!(a instanceof Od))&&m(Error("Invalid scroll event."))};
Pg.prototype.__defineGetter__("config",u("S"));Pg.prototype.__defineGetter__("interactor",u("ib"));Pg.prototype.__defineGetter__("camera",u("N"));Pg.prototype.__defineGetter__("loadingCompleted",u("fd"));Pg.prototype.__defineGetter__("container",u("v"));Pg.prototype.__defineSetter__("container",function(a){a==s&&m(Error("An ID to a valid container (<div>..) is required."));var b=a;na(b)&&(b=fe(a));pa(b)&&1==b.nodeType||m(Error("Could not find the given container."));this.v=b});v=Pg.prototype;
v.Md=function(){this.Na();this.N.reset()};
v.Aa=function(a){var b=he("canvas"),c=he("canvas");this.v.appendChild(b);this.v.appendChild(c);this.D=this.v.clientWidth;"Z"==this.ta?(b.setAttribute("id","canvasXTKP"),c.setAttribute("id","canvasXTKPOver")):"X"==this.ta?(b.setAttribute("id","canvasXTKX"),c.setAttribute("id","canvasXTKXOver")):"Y"==this.ta&&(b.setAttribute("id","canvasXTKY"),c.setAttribute("id","canvasXTKYOver"));this.w=this.v.clientHeight;b.width=this.D;b.height=this.w;c.width=this.D;c.height=this.w;b.getContext("2d").Ui=t;b.style.position=
"absolute";c.getContext("2d").Ui=t;c.style.position="absolute";try{var e=b.getContext(a);e||m(Error())}catch(d){var f="Sorry, "+a+' context is <strong>not supported</strong> on this machine! See <a href="http://crash.goXTK.com" target="_blank">http://crash.goXTK.com</a> for requirements..';this.v.innerHTML='<h3 style="color:red;font-family:sans-serif;">Oooops..</h3><p style="color:red;font-family:sans-serif;">'+f+"</p>";m(Error(f))}this.$=new og;L(this.$,Ed,this.Fj.bind(this));this.la=b;this.cg=c;
this.a=e;b=new Pe(this.la);"2d"==a&&(b=new Re(this.la));b.Aa();L(b,Ad,this.Md.bind(this));L(b,Fd,this.If.bind(this));L(b,zd,this.Jf.bind(this));this.ib=b;b=new Te(this.D,this.w);"2d"==a&&(b=new jf(this.D,this.w));b.observe(this.ib);this.N=b;L(window,"resize",this.ue,t,this)};v.add=function(a){(a instanceof xg||a instanceof vg||a instanceof tg)&&a.q();this.Ga.push(a);this.tb(a)};
v.remove=function(a){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly."));if(a!=s){ec(a);var b=this.Ga.length,c;for(c=0;c<b;c++)if(this.Ga[c].pa==a.pa)return this.Ga[c]=s,this.Ga.splice(c,1),q}return t};v.tb=function(a){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly."));a!=s&&(fc(a,Cd)||L(a,Cd,this.vj.bind(this)),fc(a,Dd)||L(a,Dd,this.Gj.bind(this)),fc(a,Hd)||L(a,Hd,this.Ef.bind(this)),fc(a,Jd)||L(a,Jd,this.Gf.bind(this)),fc(a,Id)||L(a,Id,this.Ff.bind(this)))};
v.get=function(a){a==s&&m(Error("Invalid object id."));for(var b=this.$a.K,c=b.length,e=0,e=0;e<c;e++)if(b[e].pa==a)return b[e];return s};
v.ec=function(){(!this.la||!this.a)&&m(Error("The renderer was not initialized properly."));if(this.ug==s){if(Dc(this.$.Nc)){if(this.S.PROGRESSBAR_ENABLED&&!this.Ka&&(this.Ka=new Mg(this.v,3)),this.Yd=this.fd=t,this.ug=Og(function(){this.ug=s;this.ec()}.bind(this),100),!this.S.INTERMEDIATE_RENDERING)return}else if(!this.fd&&!this.Yd&&(this.Yd=q,eval("this.onShowtime()"),this.fd=q),this.Ka){this.S.PROGRESSBAR_ENABLED&&(this.Ka&&!this.Pd)&&(Ng(this.Ka),this.Pd=Og(function(){this.Pd=s;this.Ka&&(this.Ka.Ed(),
this.Ka=s);this.ec()}.bind(this),700));return}this.Ge=window.requestAnimationFrame(this.ec.bind(this));eval("this.onRender()");this.fc(t,q);eval("this.afterRender()")}};v.mh=ba();v.kh=ba();v.zg=ba();v.fc=ba();
v.Sa=function(){ec(this);bc(window,"resize",this.ue,t,this);window.cancelAnimationFrame(this.Ge);this.$&&(delete this.$,this.$=s);this.Ka&&(this.Ka.Ed(),delete this.Ka,this.Ka=s);this.$a.clear();delete this.$a;this.Ga.length=0;delete this.Ga;delete this.$;this.$=s;delete this.N;this.N=s;delete this.ib;this.ib=s;delete this.a;this.a=s;ke(this.la);delete this.la;this.la=s};function Qg(a,b,c,e,d,f,g,h){var k,j;if(k=c.offsetParent){var l="HTML"==k.tagName||"BODY"==k.tagName;if(!l||"static"!=te(k,"position"))j=ye(k),l||(l=(l=ze(k))&&jb?-k.scrollLeft:l&&(!K||!Ab("8"))&&"visible"!=te(k,"overflowX")?k.scrollWidth-k.clientWidth-k.scrollLeft:k.scrollLeft,j=be(j,new ae(l,k.scrollTop)))}k=j||new ae;j=ye(a);l=De(a);j=new qe(j.x,j.y,l.width,l.height);(l=xe(a))&&j.Ug(new qe(l.left,l.top,l.right-l.left,l.bottom-l.top));var l=ce(a),n=ce(c);if(l.ia!=n.ia){var w=l.ia.body,n=n.ia.parentWindow||
n.ia.defaultView,r=new ae(0,0),x=ee(w)?ee(w).parentWindow||ee(w).defaultView:window,z=w;do{var E=x==n?ye(z):Ae(z);r.x+=E.x;r.y+=E.y}while(x&&x!=n&&(z=x.frameElement)&&(x=x.parent));w=be(r,ye(w));K&&!ne(l)&&(w=be(w,oe(l)));j.left+=w.x;j.top+=w.y}a=(b&4&&ze(a)?b^2:b)&-5;b=new ae(a&2?j.left+j.width:j.left,a&1?j.top+j.height:j.top);b=be(b,k);d&&(b.x+=(a&2?-1:1)*d.x,b.y+=(a&1?-1:1)*d.y);var H;if(g&&(H=xe(c)))H.top-=k.y,H.right-=k.x,H.bottom-=k.y,H.left-=k.x;return Rg(b,c,e,f,H,g,h)}
function Rg(a,b,c,e,d,f,g){a=a.l();var h=0,k=(c&4&&ze(b)?c^2:c)&-5;c=De(b);g=g?g.l():c.l();if(e||0!=k)k&2?a.x-=g.width+(e?e.right:0):e&&(a.x+=e.left),k&1?a.y-=g.height+(e?e.bottom:0):e&&(a.y+=e.top);if(f){if(d){h=a;e=0;if(65==(f&65)&&(h.x<d.left||h.x>=d.right))f&=-2;if(132==(f&132)&&(h.y<d.top||h.y>=d.bottom))f&=-5;h.x<d.left&&f&1&&(h.x=d.left,e|=1);h.x<d.left&&(h.x+g.width>d.right&&f&16)&&(g.width=Math.max(g.width-(h.x+g.width-d.right),0),e|=4);h.x+g.width>d.right&&f&1&&(h.x=Math.max(d.right-g.width,
d.left),e|=1);f&2&&(e|=(h.x<d.left?16:0)|(h.x+g.width>d.right?32:0));h.y<d.top&&f&4&&(h.y=d.top,e|=2);h.y<=d.top&&(h.y+g.height<d.bottom&&f&32)&&(g.height=Math.max(g.height-(d.top-h.y),0),h.y=0,e|=8);h.y>=d.top&&(h.y+g.height>d.bottom&&f&32)&&(g.height=Math.max(g.height-(h.y+g.height-d.bottom),0),e|=8);h.y+g.height>d.bottom&&f&4&&(h.y=Math.max(d.bottom-g.height,d.top),e|=2);f&8&&(e|=(h.y<d.top?64:0)|(h.y+g.height>d.bottom?128:0));h=e}else h=256;if(h&496)return h}f=a;d=jb&&(ab||rb)&&Ab("1.9");f instanceof
ae?(a=f.x,f=f.y):(a=f,f=p);b.style.left=Ce(a,d);b.style.top=Ce(f,d);if(!(c==g||(!c||!g?0:c.width==g.width&&c.height==g.height)))a=ne(ce(ee(b))),K&&(!a||!Ab("8"))?(c=b.style,a?(K?(a=He(b,"paddingLeft"),d=He(b,"paddingRight"),f=He(b,"paddingTop"),e=He(b,"paddingBottom"),a=new pe(f,d,e,a)):(a=se(b,"paddingLeft"),d=se(b,"paddingRight"),f=se(b,"paddingTop"),e=se(b,"paddingBottom"),a=new pe(parseFloat(f),parseFloat(d),parseFloat(e),parseFloat(a))),K?(d=Je(b,"borderLeft"),f=Je(b,"borderRight"),e=Je(b,"borderTop"),
b=Je(b,"borderBottom"),b=new pe(e,f,b,d)):(d=se(b,"borderLeftWidth"),f=se(b,"borderRightWidth"),e=se(b,"borderTopWidth"),b=se(b,"borderBottomWidth"),b=new pe(parseFloat(e),parseFloat(f),parseFloat(b),parseFloat(d))),c.pixelWidth=g.width-b.left-a.left-a.right-b.right,c.pixelHeight=g.height-b.top-a.top-a.bottom-b.bottom):(c.pixelWidth=g.width,c.pixelHeight=g.height)):(b=b.style,jb?b.MozBoxSizing="border-box":mb?b.WebkitBoxSizing="border-box":b.boxSizing="border-box",b.width=Math.max(g.width,0)+"px",
b.height=Math.max(g.height,0)+"px");return h};function Sg(){}Sg.prototype.sb=ba();function Tg(a,b){this.nf=a instanceof ae?a:new ae(a,b)}C(Tg,Sg);Tg.prototype.sb=function(a,b,c,e){Qg(ue(a),0,a,b,this.nf,c,s,e)};function Ug(a,b,c){this.element=a;this.Gg=b;this.Vj=c}C(Ug,Sg);Ug.prototype.sb=function(a,b,c){Qg(this.element,this.Gg,a,b,p,c,this.Vj)};function Vg(a,b){kc.call(this);this.Lb=new Bg(this);this.Pf(a||s);b&&(this.Zc=b)}C(Vg,kc);v=Vg.prototype;v.J=s;v.hi=q;v.Ag=s;v.La=t;v.gk=t;v.wf=-1;v.Xg=-1;v.Qi=t;v.xi=q;v.Zc="toggle_display";v.u=u("J");v.Pf=function(a){this.La&&m(Error("Can not change this state of the popup while showing."));this.J=a};
function Wg(a,b){a.De&&a.De.stop();a.qe&&a.qe.stop();if(b){if(!a.La&&a.Df()){a.J||m(Error("Caller must call setElement before trying to show the popup"));a.sb();var c=ee(a.J);a.Qi&&Dg(a.Lb,c,"keydown",a.tj,q);if(a.hi)if(Dg(a.Lb,c,"mousedown",a.ih,q),K){var e;try{e=c.activeElement}catch(d){}for(;e&&"IFRAME"==e.nodeName;){try{var f=e.contentDocument||e.contentWindow.document}catch(g){break}c=f;e=c.activeElement}Dg(a.Lb,c,"mousedown",a.ih,q);Dg(a.Lb,c,"deactivate",a.hh)}else Dg(a.Lb,c,"blur",a.hh);"toggle_display"==
a.Zc?(a.J.style.visibility="visible",Fe(a.J,q)):"move_offscreen"==a.Zc&&a.sb();a.La=q;a.De?(ac(a.De,"end",a.lh,t,a),a.De.play()):a.lh()}}else Xg(a)}v.sb=ga;function Xg(a,b){if(!a.La||!a.dispatchEvent({type:"beforehide",target:b}))return t;a.Lb&&a.Lb.Of();a.La=t;a.Xg=xa();a.qe?(ac(a.qe,"end",wa(a.Fg,b),t,a),a.qe.play()):a.Fg(b);return q}v.Fg=function(a){"toggle_display"==this.Zc?this.gk?Og(this.Pg,0,this):this.Pg():"move_offscreen"==this.Zc&&(this.J.style.top="-10000px");this.Hf(a)};
v.Pg=function(){this.J.style.visibility="hidden";Fe(this.J,t)};v.Df=function(){return this.dispatchEvent("beforeshow")};v.lh=function(){this.wf=xa();this.Xg=-1;this.dispatchEvent("show")};v.Hf=function(a){this.dispatchEvent({type:"hide",target:a})};v.ih=function(a){a=a.target;!me(this.J,a)&&((!this.Ag||me(this.Ag,a))&&!(150>xa()-this.wf))&&Xg(this,a)};v.tj=function(a){27==a.keyCode&&Xg(this,a.target)&&(a.preventDefault(),a.stopPropagation())};
v.hh=function(a){if(this.xi){var b=ee(this.J);if(K||ib){if(a=b.activeElement,!a||me(this.J,a)||"BODY"==a.tagName)return}else if(a.target!=b)return;150>xa()-this.wf||Xg(this)}};function Yg(a,b){this.Zj=4;this.ve=b||p;Vg.call(this,a)}C(Yg,Vg);Yg.prototype.sb=function(){if(this.ve){var a=!this.La&&"move_offscreen"!=this.Zc,b=this.u();a&&(b.style.visibility="hidden",Fe(b,q));this.ve.sb(b,this.Zj,this.Ml);a&&Fe(b,t)}};function Zg(a){this.ea=new Bc;a&&this.df(a)}function $g(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+qa(a):b.substr(0,1)+a}v=Zg.prototype;v.sf=function(){return this.ea.sf()};v.add=function(a){this.ea.set($g(a),a)};v.df=function(a){a=Ac(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};v.Of=function(a){a=Ac(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};v.remove=function(a){return this.ea.remove($g(a))};v.clear=function(){this.ea.clear()};
v.contains=function(a){a=$g(a);return Ec(this.ea.ea,a)};v.Ug=function(a){var b=new Zg;a=Ac(a);for(var c=0;c<a.length;c++){var e=a[c];this.contains(e)&&b.add(e)}return b};v.Cd=function(){return this.ea.Cd()};v.l=function(){return new Zg(this)};function ah(a,b,c){this.bc=c||(a?ce(fe(a)):ce());Yg.call(this,this.bc.Vc("div",{style:"position:absolute;display:none;"}));this.of=new ae(1,1);this.ie=new Zg;a&&bh(this,a);if(b!=s)if(a=this.u(),"textContent"in a)a.textContent=b;else if(a.firstChild&&3==a.firstChild.nodeType){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{for(;c=a.firstChild;)a.removeChild(c);a.appendChild(ee(a).createTextNode(String(b)))}}C(ah,Yg);var ch=[];v=ah.prototype;v.Ra=s;v.className="goog-tooltip";
v.zh=500;v.Pi=0;v.me=u("bc");function bh(a,b){b=fe(b);a.ie.add(b);L(b,"mouseover",a.Oi,t,a);L(b,"mouseout",a.Mg,t,a);L(b,"mousemove",a.Ni,t,a);L(b,"focus",a.Mi,t,a);L(b,"blur",a.Mg,t,a)}v.Pf=function(a){var b=this.u();b&&ke(b);ah.z.Pf.call(this,a);a&&(b=this.bc.ia.body,b.insertBefore(a,b.lastChild))};
v.Df=function(){if(!Vg.prototype.Df.call(this))return t;if(this.anchor)for(var a,b=0;a=ch[b];b++)me(a.u(),this.anchor)||Wg(a,t);0<=Gb(ch,this)||ch.push(this);a=this.u();a.className=this.className;dh(this);L(a,"mouseover",this.Og,t,this);L(a,"mouseout",this.Ng,t,this);eh(this);return q};
v.Hf=function(){Lb(ch,this);for(var a=this.u(),b,c=0;b=ch[c];c++)b.anchor&&me(a,b.anchor)&&Wg(b,t);this.oh&&fh(this.oh);bc(a,"mouseover",this.Og,t,this);bc(a,"mouseout",this.Ng,t,this);this.anchor=p;if(0==(this.Nb?this.La?4:1:this.Xc?3:this.La?2:0))this.Ae=t;Vg.prototype.Hf.call(this)};v.ah=function(a,b){this.anchor==a&&this.ie.contains(this.anchor)&&(this.Ae||!this.Wl?(Wg(this,t),this.La||(this.anchor=a,this.ve=b||gh(this,0)||p,this.La&&this.sb(),Wg(this,q))):this.anchor=p);this.Nb=p};
v.kj=function(a){this.Xc=p;a==this.anchor&&(this.Ra==s||this.Ra!=this.u()&&!this.ie.contains(this.Ra))&&(!this.Cg||!this.Cg.Ra)&&Wg(this,t)};function hh(a,b){var c=oe(a.bc);a.of.x=b.clientX+c.x;a.of.y=b.clientY+c.y}v.Oi=function(a){var b=ih(this,a.target);this.Ra=b;dh(this);b!=this.anchor&&(this.anchor=b,this.Nb||(this.Nb=Og(va(this.ah,this,b,p),this.zh)),jh(this),hh(this,a))};function ih(a,b){try{for(;b&&!a.ie.contains(b);)b=b.parentNode;return b}catch(c){return s}}
v.Ni=function(a){hh(this,a);this.Ae=q};v.Mi=function(a){this.Ra=a=ih(this,a.target);this.Ae=q;if(this.anchor!=a){this.anchor=a;var b=gh(this,1);dh(this);this.Nb||(this.Nb=Og(va(this.ah,this,a,b),this.zh));jh(this)}};function gh(a,b){if(0==b){var c=a.of.l();return new kh(c)}return new lh(a.Ra)}function jh(a){if(a.anchor)for(var b,c=0;b=ch[c];c++)me(b.u(),a.anchor)&&(b.Cg=a,a.oh=b)}
v.Mg=function(a){var b=ih(this,a.target),c=ih(this,a.relatedTarget);b!=c&&(b==this.Ra&&(this.Ra=s),eh(this),this.Ae=t,this.La&&(!a.relatedTarget||!me(this.u(),a.relatedTarget))?fh(this):this.anchor=p)};v.Og=function(){var a=this.u();this.Ra!=a&&(dh(this),this.Ra=a)};v.Ng=function(a){var b=this.u();if(this.Ra==b&&(!a.relatedTarget||!me(b,a.relatedTarget)))this.Ra=s,fh(this)};function eh(a){a.Nb&&(fa.clearTimeout(a.Nb),a.Nb=p)}
function fh(a){if(2==(a.Nb?a.La?4:1:a.Xc?3:a.La?2:0))a.Xc=Og(va(a.kj,a,a.anchor),a.Pi)}function dh(a){a.Xc&&(fa.clearTimeout(a.Xc),a.Xc=p)}function kh(a,b){Tg.call(this,a,b)}C(kh,Tg);kh.prototype.sb=function(a,b,c){b=ue(a);b=xe(b);c=c?new pe(c.top+10,c.right,c.bottom,c.left+10):new pe(10,0,0,10);Rg(this.nf,a,4,c,b,9)&496&&Rg(this.nf,a,4,c,b,5)};function lh(a){Ug.call(this,a,3)}C(lh,Ug);
lh.prototype.sb=function(a,b,c){var e=new ae(10,0);Qg(this.element,this.Gg,a,b,e,c,9)&496&&Qg(this.element,2,a,1,e,c,5)};function mh(a,b,c,e){a==s&&m(Error("No valid parent element."));(!y(b)||!y(c))&&m(Error("Invalid coordinates."));(e==s||!(e instanceof Ne))&&m(Error("Invalid interactor."));ah.call(this);this.f="caption";this.ab=a;this.ee=b;this.fe=c;this.ib=e;this.Jb=s;this.hc=[];a=".x-tooltip {\n  background: #C0C0FF;\n  color: #000000;\n";a+="  border: 1px solid infotext;\n";a+="  padding: 1px;\n";a+="  font-family: sans-serif;\n";a+="}";this.hc=[a];ac(e,Gd,this.Ed.bind(this));this.uf()}C(mh,ah);
mh.prototype.uf=function(){var a=se(this.ab,"position");if("static"==a||""==a)this.ab.style.position="relative";var a=document.getElementsByTagName("head")[0],b=he("style");b.type="text/css";b.media="screen";var c=document.createTextNode(String(this.hc[0]));a.appendChild(b);b.appendChild(c);this.Jb=b;this.ve=new Tg(this.ee,this.fe)||p;this.La&&this.sb();Wg(this,q);bh(this,this.ab);this.u().classList.add("x-tooltip")};
mh.prototype.Ed=function(){Wg(this,t);this.Jb&&ke(this.Jb);this.u()&&ke(this.u());this.Jb=s};function nh(){Pg.call(this);this.f="renderer3D";this.kd=this.nd=this.jd=this.md=this.hd=this.ld=this.Ye=this.Ze=s;this.B=[0,0,0];this.ad=[0,0,0];this.sg=s;this.He=new Bc;this.wd=new Bc;this.sc=new Bc;this.pd=new Bc;this.Ic=new Bc;this.Tc=new Bc;this.rc=new Bc;this.vd=new Bc;this.S={PROGRESSBAR_ENABLED:q,PICKING_ENABLED:q,ORDERING_ENABLED:q,STATISTICS_ENABLED:t,INTERMEDIATE_RENDERING:t}}C(nh,Pg);nh.prototype.__defineGetter__("config",u("S"));v=nh.prototype;
v.ak=function(){this.kd=this.nd=this.jd=this.md=this.hd=this.ld=s;this.B=[0,0,0]};v.If=function(a){nh.z.If.call(this,a);var b=a.ee;a=a.fe;var c=this.Mf(b,a);if(c=this.get(c))if(c=c.Hc){var e=Ae(this.v);(new mh(this.v,e.x+b+10,e.y+a+10,this.ib)).u().innerHTML=c}};
v.Aa=function(){nh.z.Aa.call(this,"experimental-webgl");try{if(this.a.viewport(0,0,this.D,this.w),this.a.clearColor(this.ad[0],this.ad[1],this.ad[2],0),this.a.enable(this.a.BLEND),this.a.blendEquation(this.a.FUNC_ADD),this.a.blendFunc(this.a.SRC_ALPHA,this.a.ONE_MINUS_SRC_ALPHA),this.a.enable(this.a.DEPTH_TEST),this.a.depthFunc(this.a.LEQUAL),this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT),this.S.PICKING_ENABLED){var a=this.a.createFramebuffer(),b=this.a.createRenderbuffer(),c=this.a.createTexture();
this.a.bindTexture(this.a.TEXTURE_2D,c);this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGB,this.D,this.w,0,this.a.RGB,this.a.UNSIGNED_BYTE,s);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,this.a.CLAMP_TO_EDGE);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST);this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST);this.a.bindFramebuffer(this.a.FRAMEBUFFER,
a);this.a.bindRenderbuffer(this.a.RENDERBUFFER,b);this.a.renderbufferStorage(this.a.RENDERBUFFER,this.a.DEPTH_COMPONENT16,this.D,this.w);this.a.bindRenderbuffer(this.a.RENDERBUFFER,s);this.a.framebufferTexture2D(this.a.FRAMEBUFFER,this.a.COLOR_ATTACHMENT0,this.a.TEXTURE_2D,c,0);this.a.framebufferRenderbuffer(this.a.FRAMEBUFFER,this.a.DEPTH_ATTACHMENT,this.a.RENDERBUFFER,b);this.a.bindFramebuffer(this.a.FRAMEBUFFER,s);this.sg=a}}catch(e){m(Error("Exception while accessing GL Context!\n"+e))}a=new kf;
(this.la==s||this.a==s||this.N==s)&&m(Error("Renderer was not initialized properly."));(a==s||!(a instanceof kf))&&m(Error("Could not add shaders."));b=Object.keys(mf);Object.keys(lf).every(function(a){a=lf[a];return-1!=this.be.search(a)||-1!=this.Td.search(a)}.bind(a))||m(Error("Could not find all attributes in the shader sources."));b.every(function(a){a=mf[a];return-1!=this.be.search(a)||-1!=this.Td.search(a)}.bind(a))||m(Error("Could not find all uniforms in the shader sources."));b=this.a.createShader(this.a.FRAGMENT_SHADER);
c=this.a.createShader(this.a.VERTEX_SHADER);this.a.shaderSource(b,a.Td);this.a.shaderSource(c,a.be);this.a.compileShader(b);this.a.compileShader(c);this.a.getShaderParameter(b,this.a.COMPILE_STATUS)||m(Error("Fragement Shader compilation failed!\n"+this.a.getShaderInfoLog(b)));this.a.getShaderParameter(c,this.a.COMPILE_STATUS)||m(Error("Vertex Shader compilation failed!\n"+this.a.getShaderInfoLog(c)));var d=this.a.createProgram();this.a.attachShader(d,c);this.a.attachShader(d,b);this.a.linkProgram(d);
this.a.getProgramParameter(d,this.a.LINK_STATUS)||m(Error("Could not create shader program!\n"+this.a.getShaderInfoLog(b)+"\n"+this.a.getShaderInfoLog(c)+"\n"+this.a.getProgramInfoLog(d)));this.a.useProgram(d);this.Ye=d;Object.keys(lf).forEach(function(a){a=lf[a];this.He.set(a,this.a.getAttribLocation(this.Ye,a));this.a.enableVertexAttribArray(this.He.get(a))}.bind(this));Object.keys(mf).forEach(function(a){a=mf[a];this.wd.set(a,this.a.getUniformLocation(this.Ye,a))}.bind(this));this.Ze=a};
v.tb=function(a){nh.z.tb.call(this,a);var b=t;if(a!=s){this.get(a.pa)&&(b=q);var c=a.pa,e=a.h,d=a.o,f=a.oa,g=a.I,h=a.r,k=a.ha,j=a.wa,l=a.e,n=a.H;if(l!=s&&l.r!=s&&l.r.j)this.tb(l);else if(l!=s&&l.j&&this.tb(l),j!=s&&j.r!=s&&j.r.j)this.$.load(j,a);else if(g!=s&&g.r!=s&&g.r.j)this.$.load(g,a);else{if(h!=s&&ja(h))if(a.Cc!=s){if(a.Cc.xf!=h.length||!a.j)return}else{b=0;c=h.length;for(b=0;b<c;b++)this.$.load(h[b],a);return}else{if(h!=s&&h.j){this.$.load(a,a);return}if(n!=s&&n.r!=s&&n.r.j){this.$.load(n,
a);return}}if(0<a.c.length){h=a.c;j=h.length;for(l=l=0;l<j;l++)this.tb(h[l])}if(e){for(h=0;this.Wd;)h++,window.console.log("Possible thread lock avoided: "+h);this.Wd=q;j=a instanceof cf&&a.xb instanceof of;b&&(g!=s&&g.j)&&(h=this.rc.get(c),h!=s&&this.a.isBuffer(h.P)&&this.a.deleteBuffer(h.P));h=s;g!=s&&(!b||g.j?(h=a.qc,h==s&&m(Error("Can not add an object and texture without valid coordinate mapping! Set the textureCoordinateMap!")),l=t,g.Yb&&(l=q),this.a.pixelStorei(this.a.UNPACK_FLIP_Y_WEBGL,l),
l=this.a.createTexture(),l.Ti=g.hb,this.vd.set(g.pa,l),this.a.bindTexture(this.a.TEXTURE_2D,l),g.Yb?(l=this.a.RGBA,g.ig&&(l=this.a.LUMINANCE,this.a.pixelStorei(this.a.UNPACK_ALIGNMENT,1)),this.a.texImage2D(this.a.TEXTURE_2D,0,l,g.Xe,g.We,0,l,this.a.UNSIGNED_BYTE,g.Yb)):this.a.texImage2D(this.a.TEXTURE_2D,0,this.a.RGBA,this.a.RGBA,this.a.UNSIGNED_BYTE,l.Ti),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_S,this.a.CLAMP_TO_EDGE),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_WRAP_T,
this.a.CLAMP_TO_EDGE),j?(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.NEAREST),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.NEAREST)):(this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MAG_FILTER,this.a.LINEAR),this.a.texParameteri(this.a.TEXTURE_2D,this.a.TEXTURE_MIN_FILTER,this.a.LINEAR)),this.a.bindTexture(this.a.TEXTURE_2D,s),l=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,l),this.a.bufferData(this.a.ARRAY_BUFFER,new Float32Array(h),
this.a.STATIC_DRAW),h=new Wd(l,h.length,2),this.rc.set(c,h),g.j=t):h=this.rc.get(c));pg(this.$,0.1);if(j)this.Wd=t,D.Ba(this.f+".update"),pg(this.$,0.9);else{if(!b||e.j||k.j){j=k.Q;g=D.g.aa(j,e.mb,e.nb,e.ob);j=D.g.aa(j,e.jb,e.kb,e.lb);if(this.ld===s||g.x<this.ld)this.ld=g.x;if(this.hd===s||j.x>this.hd)this.hd=j.x;if(this.md===s||g.y<this.md)this.md=g.y;if(this.jd===s||j.y>this.jd)this.jd=j.y;if(this.nd===s||g.d<this.nd)this.nd=g.d;if(this.kd===s||j.d>this.kd)this.kd=j.d;this.B=[(this.ld+this.hd)/
2,(this.md+this.jd)/2,(this.nd+this.kd)/2];k.j=t}b&&e.j&&(k=this.sc.get(c),k!=s&&this.a.isBuffer(k.P)&&this.a.deleteBuffer(k.P));k=s;!b||e.j?(k=this.a.createBuffer(),e.Na(),this.a.bindBuffer(this.a.ARRAY_BUFFER,k),this.a.bufferData(this.a.ARRAY_BUFFER,e.ba,this.a.STATIC_DRAW),k=new Wd(k,e.count,3),e.j=t):k=this.sc.get(c);pg(this.$,0.3);b&&d.j&&(g=this.sc.get(c),g!=s&&this.a.isBuffer(g.P)&&this.a.deleteBuffer(g.P));g=s;!b||d.j?(g=this.a.createBuffer(),d.Na(),this.a.bindBuffer(this.a.ARRAY_BUFFER,g),
this.a.bufferData(this.a.ARRAY_BUFFER,d.ba,this.a.STATIC_DRAW),g=new Wd(g,d.count,3),d.j=t):g=this.pd.get(c);pg(this.$,0.3);b&&(f&&f.j)&&(d=this.Ic.get(c),d!=s&&this.a.isBuffer(d.P)&&this.a.deleteBuffer(d.P));d=s;f&&(!b||f.j?(f.length!=e.length&&m(Error("Mismatch between points and point colors.")),d=this.a.createBuffer(),f.Na(),this.a.bindBuffer(this.a.ARRAY_BUFFER,d),this.a.bufferData(this.a.ARRAY_BUFFER,f.ba,this.a.STATIC_DRAW),d=new Wd(d,f.count,3),f.j=t):d=this.Ic.get(c));pg(this.$,0.2);b&&(n&&
n.j)&&(f=this.Tc.get(c),f!=s&&this.a.isBuffer(f.P)&&this.a.deleteBuffer(f.P));f=s;n&&(f=n.bd,!b||n.j?(f.length!=e.length&&m(Error("Mismatch between points and scalars.")),e=this.a.createBuffer(),this.a.bindBuffer(this.a.ARRAY_BUFFER,e),this.a.bufferData(this.a.ARRAY_BUFFER,f,this.a.STATIC_DRAW),f=new Wd(e,f.length,3),n.j=t):f=this.Tc.get(c));pg(this.$,0.1);b||this.$a.add(a);this.sc.set(c,k);this.pd.set(c,g);this.Ic.set(c,d);this.rc.set(c,h);this.Tc.set(c,f);this.Wd=a.j=t}}else a.j=t}}};
v.Mf=function(a,b){if(this.S.PICKING_ENABLED){this.fc(q,t);var c=new Uint8Array(4);this.a.readPixels(a,this.w-b,1,1,this.a.RGBA,this.a.UNSIGNED_BYTE,c);return c[0]+255*c[1]+65025*c[2]}return-1};
v.fc=function(a,b){nh.z.fc.call(this,a,b);this.a.viewport(0,0,this.D,this.w);this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);var c=this.$a.K,e=c.length;if(0!=e){a?this.a.bindFramebuffer(this.a.FRAMEBUFFER,this.sg):this.a.bindFramebuffer(this.a.FRAMEBUFFER,s);var d=this.N.Ve,f=this.N.p;this.a.uniformMatrix4fv(this.wd.get("perspective"),t,d);this.a.uniformMatrix4fv(this.wd.get("view"),t,f);d=this.B;this.a.uniform3f(this.wd.get("center"),parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]));
f=this.Ga.length;for(d=0;d<f;++d){var g=this.Ga[d];if(g instanceof P){var h=D.g.aa(this.N.p,g.t[0]+g.b[0].i[0],g.t[1]+g.b[0].i[1],g.t[2]+g.b[0].i[2]),k=D.g.aa(this.N.p,g.t[0]-g.b[0].i[0],g.t[1]-g.b[0].i[1],g.t[2]-g.b[0].i[2]),j=Math.abs(h.d-k.d),h=D.g.aa(this.N.p,g.t[0]+g.b[1].i[0],g.t[1]+g.b[1].i[1],g.t[2]+g.b[1].i[2]),k=D.g.aa(this.N.p,g.t[0]-g.b[1].i[0],g.t[1]-g.b[1].i[1],g.t[2]+-g.b[1].i[2]),l=Math.abs(h.d-k.d),h=D.g.aa(this.N.p,g.t[0]+g.b[2].i[0],g.t[1]+g.b[2].i[1],g.t[2]+g.b[2].i[2]),k=D.g.aa(this.N.p,
g.t[0]-g.b[2].i[0],g.t[1]-g.b[2].i[1],g.t[2]-g.b[2].i[2]),h=Math.max(j,l,Math.abs(h.d-k.d));h==j?nf(g,0):h==l?nf(g,1):nf(g,2)}}if(this.S.ORDERING_ENABLED){j=t;f=this.Ga;g=f.length-1;do if(d=f[g],d instanceof P&&d.Qa&&-1!=d.X){var j=d.c[d.X].c,l=d.X,h=D.g.aa(this.N.p,d.t[0]+d.b[l].C[0],d.t[1]+d.b[l].C[1],d.t[2]+d.b[l].C[2]),k=D.g.aa(this.N.p,d.t[0]-d.b[l].C[0],d.t[1]-d.b[l].C[1],d.t[2]-d.b[l].C[2]),h=h.d-k.d,k=Math.max(d.Gc[d.X],Math.max(d.Gc[d.X+4],d.Gc[d.X+8])),n=Math.min(d.Gc[d.X],Math.min(d.Gc[d.X+
4],d.Gc[d.X+8]));if(0>h*(k+n))for(h=h=0;h<d.td[l]-1;h++)j[h]&&(j[h].xa=d.xa,j[h].Da=d.b[l].Uc*h);else for(h=d.td[l]-1;0<=h;h--)j[h]&&(j[h].xa=d.xa,j[h].Da=(d.td[l]-1)*d.b[l].Uc-d.b[l].Uc*h);j=q}while(g--);f=this.$a.K;g=f.length-1;do if(d=f[g],d.O&&!(1==d.xa||d instanceof cf))j=d,l=d.h.Qd,d=D.g.aa(d.ha.Q,l[0],l[1],l[2]),d=D.g.aa(this.N.p,d.x,d.y,d.d),d=D.m.rf(this.N.lc,d),d=Math.round(1E3*d)/1E3,j.Da=d,j=q;while(g--);j&&this.$a.sort()}if(f=!a&&b!=s&&b&&this.S.STATISTICS_ENABLED)var w=0;var d=this.He,
g=d.get("vertexPosition"),j=d.get("vertexNormal"),l=d.get("vertexColor"),h=d.get("vertexTexturePos"),k=d.get("vertexScalar"),d=this.wd,n=d.get("usePicking"),r=d.get("useObjectColor"),x=d.get("objectColor"),z=d.get("useScalars"),E=d.get("scalarsReplaceMode"),H=d.get("scalarsMin"),J=d.get("scalarsMax"),B=d.get("scalarsMinColor"),F=d.get("scalarsMaxColor"),G=d.get("scalarsInterpolation"),M=d.get("scalarsMinThreshold"),Q=d.get("scalarsMaxThreshold"),N=d.get("objectOpacity"),U=d.get("labelmapOpacity"),
da=d.get("labelmapColor"),I=d.get("useTexture"),aa=d.get("useLabelMapTexture"),ma=d.get("textureSampler"),S=d.get("textureSampler2"),V=d.get("volumeLowerThreshold"),Pa=d.get("volumeUpperThreshold"),Rb=d.get("volumeScalarMin"),Sb=d.get("volumeScalarMax"),Tb=d.get("volumeWindowLow"),kb=d.get("volumeWindowHigh"),lb=d.get("volumeScalarMinColor"),Zc=d.get("volumeScalarMaxColor"),sc=d.get("volumeTexture"),$c=d.get("objectTransform"),ad=d.get("pointSize"),d=e;do{var ea=c[e-d];if(ea){var ka=s;ea instanceof
cf&&ea.xb&&(ka=ea.xb);if(ea.O&&(!ka||ka.O)&&(!a||ea.qd)){var Ba=ea.pa,cb=ea.gd,ob=this.sc.get(Ba),pb=this.pd.get(Ba),df=this.Ic.get(Ba),Hb=this.Tc.get(Ba),ef=this.rc.get(Ba);this.a.bindBuffer(this.a.ARRAY_BUFFER,ob.P);this.a.vertexAttribPointer(g,ob.Rb,this.a.FLOAT,t,0,0);this.a.bindBuffer(this.a.ARRAY_BUFFER,pb.P);this.a.vertexAttribPointer(j,pb.Rb,this.a.FLOAT,t,0,0);a?this.a.uniform1i(n,q):this.a.uniform1i(n,t);df&&!a&&!cb?(this.a.uniform1i(r,t),this.a.bindBuffer(this.a.ARRAY_BUFFER,df.P),this.a.vertexAttribPointer(l,
df.Rb,this.a.FLOAT,t,0,0)):(pb=1,cb&&!a&&(pb=0),this.a.uniform1i(r,pb),pb=ea.A,a&&(pb=[Math.floor(Ba%65025%255)/255,Math.floor(Ba%65025/255)/255,Math.floor(Ba/65025)/255]),this.a.uniform3f(x,parseFloat(pb[0]),parseFloat(pb[1]),parseFloat(pb[2])),this.a.vertexAttribPointer(l,ob.Rb,this.a.FLOAT,t,0,0));Hb&&!a&&!cb?(this.a.uniform1i(z,q),this.a.uniform1i(E,ea.H.vg),Ba=ea.H.Ub,cb=ea.H.Sb,this.a.uniform3f(B,parseFloat(Ba[0]),parseFloat(Ba[1]),parseFloat(Ba[2])),this.a.uniform3f(F,parseFloat(cb[0]),parseFloat(cb[1]),
parseFloat(cb[2])),this.a.uniform1f(M,parseFloat(ea.H.U)),this.a.uniform1f(Q,parseFloat(ea.H.W)),this.a.uniform1f(H,parseFloat(ea.H.qa)),this.a.uniform1f(J,parseFloat(ea.H.ga)),this.a.uniform1i(G,parseInt(ea.H.Le,10)),this.a.bindBuffer(this.a.ARRAY_BUFFER,Hb.P),this.a.vertexAttribPointer(k,Hb.Rb,this.a.FLOAT,t,0,0)):(this.a.uniform1i(z,t),this.a.vertexAttribPointer(k,ob.Rb,this.a.FLOAT,t,0,0));this.a.uniform1f(N,parseFloat(ea.xa));ea.I&&ef&&!a?(this.a.uniform1i(I,q),this.a.activeTexture(this.a.TEXTURE0),
this.a.bindTexture(this.a.TEXTURE_2D,this.vd.get(ea.I.pa)),this.a.uniform1i(ma,0),this.a.bindBuffer(this.a.ARRAY_BUFFER,ef.P),this.a.vertexAttribPointer(h,ef.Rb,this.a.FLOAT,t,0,0),this.a.uniform1i(sc,t)):(this.a.uniform1i(I,t),this.a.vertexAttribPointer(h,ob.Rb,this.a.FLOAT,t,0,0));ka&&(this.a.uniform1i(sc,q),this.a.uniform1f(V,ka.U),this.a.uniform1f(Pa,ka.W),this.a.uniform1f(Rb,ka.qa),this.a.uniform1f(Sb,ka.ga),Ba=ka.Ub,cb=ka.Sb,this.a.uniform3f(lb,parseFloat(Ba[0]),parseFloat(Ba[1]),parseFloat(Ba[2])),
this.a.uniform3f(Zc,parseFloat(cb[0]),parseFloat(cb[1]),parseFloat(cb[2])),this.a.uniform1f(Tb,ka.da),this.a.uniform1f(kb,ka.ca),Hb=ka.e,this.a.uniform1i(aa,t),ka.Qa?this.a.uniform1f(N,parseFloat(ka.xa)):Hb&&Hb.O&&(ka=ea.e.pa,this.a.uniform1i(aa,q),this.a.activeTexture(this.a.TEXTURE1),this.a.bindTexture(this.a.TEXTURE_2D,this.vd.get(ka)),this.a.uniform1i(S,1),this.a.uniform1f(U,Hb.xa),this.a.uniform4fv(da,Hb.$e)));this.a.uniformMatrix4fv($c,t,ea.ha.Q);ka=1;"POINTS"==ea.Ha&&(ka=ea.rd);this.a.uniform1f(ad,
ka);ka=-1;ea.Ha==md?(ka=this.a.TRIANGLES,f&&(w+=ob.cd/3)):"LINES"==ea.Ha?(this.a.lineWidth(ea.Oc),ka=this.a.LINES):"POINTS"==ea.Ha?ka=this.a.POINTS:"TRIANGLE_STRIPS"==ea.Ha?(ka=this.a.TRIANGLE_STRIP,f&&(w+=ob.cd/3)):"POLYGONS"==ea.Ha&&(ka=0==ob.cd%3?this.a.TRIANGLES:this.a.TRIANGLE_FAN,f&&(w+=ob.cd/3));this.a.drawArrays(ka,0,ob.cd)}}}while(--d);f&&Math.round(w)}};
v.remove=function(a){nh.z.remove.call(this,a);if(0<a.c.length)for(var b=a.c,c=b.length,e=0,e=0;e<c;e++)"undefined"!=typeof b[e]&&this.remove(b[e]);b=a.pa;c=this.rc.get(b);c!=s&&this.a.isBuffer(c.P)&&this.a.deleteBuffer(c.P);if(a.I&&(c=this.vd.get(a.I.pa)))this.a.deleteTexture(c),this.vd.remove(a.I.pa);c=this.sc.get(b);c!=s&&this.a.isBuffer(c.P)&&this.a.deleteBuffer(c.P);c=this.pd.get(b);c!=s&&this.a.isBuffer(c.P)&&this.a.deleteBuffer(c.P);c=this.Ic.get(b);c!=s&&this.a.isBuffer(c.P)&&this.a.deleteBuffer(c.P);
c=this.Tc.get(b);c!=s&&this.a.isBuffer(c.P)&&this.a.deleteBuffer(c.P);this.sc.remove(b);this.pd.remove(b);this.Ic.remove(b);this.rc.remove(b);this.Tc.remove(b);this.$a.remove(a);return q};v.Sa=function(){this.Ze=s;delete this.Ze;this.a.clear(this.a.COLOR_BUFFER_BIT|this.a.DEPTH_BUFFER_BIT);nh.z.Sa.call(this)};nh.prototype.__defineGetter__("bgColor",u("ad"));nh.prototype.__defineSetter__("bgColor",ca("ad"));
nh.prototype.Xj=function(a,b,c,e,d){c!=s||(c=4);e!=s||(e=2);if(d==s){d=this.Mf(a,b);if(-1==d)return s;d=this.get(d);if(!d)return s}var f=Ue(this.N,2*(a/this.D)-1,2*((this.w-b)/this.w)-1,0);a=Ue(this.N,2*(a/this.D)-1,2*((this.w-b)/this.w)-1,1);f[0]+=this.B[0];f[1]+=this.B[1];f[2]+=this.B[2];a[0]+=this.B[0];a[1]+=this.B[1];a[2]+=this.B[2];b=[d.h.mb,d.h.nb,d.h.ob];var g=[d.h.jb,d.h.nb,d.h.ob],h=[d.h.jb,d.h.kb,d.h.ob],k=[d.h.mb,d.h.kb,d.h.ob],j=[d.h.mb,d.h.kb,d.h.lb],l=[d.h.mb,d.h.nb,d.h.lb],n=[d.h.jb,
d.h.kb,d.h.lb],w=[d.h.jb,d.h.nb,d.h.lb];b=[D.g.aa(d.ha.Q,b[0],b[1],b[2]),D.g.aa(d.ha.Q,g[0],g[1],g[2]),D.g.aa(d.ha.Q,h[0],h[1],h[2]),D.g.aa(d.ha.Q,k[0],k[1],k[2]),D.g.aa(d.ha.Q,j[0],j[1],j[2]),D.g.aa(d.ha.Q,l[0],l[1],l[2]),D.g.aa(d.ha.Q,n[0],n[1],n[2]),D.g.aa(d.ha.Q,w[0],w[1],w[2])];var g=[Infinity,-Infinity,Infinity,-Infinity,Infinity,-Infinity],r;for(r in b)r=b[r],g=[Math.min(g[0],r.x),Math.max(g[1],r.x),Math.min(g[2],r.y),Math.max(g[3],r.y),Math.min(g[4],r.d),Math.max(g[5],r.d)];r=g;b=[];g=[];
for(h=0;6>h;h++){var k=Math.floor(h/2),j=(k+1)%3,l=(k+2)%3,w=(2+2*k)%6,x=(4+2*k)%6,z=(r[h]-f[k])*(1/a[k]);Infinity!=z&&-Infinity!=z&&(n=f[j]+a[j]*z,z=f[l]+a[l]*z,n>=r[w]&&n<=r[w+1]&&z>=r[x]&&z<=r[x+1]?(w=[],w[k]=r[h],w[j]=n,w[l]=z,b.push(w)):(w=[],w[k]=r[h],w[j]=n,w[l]=z,g.push(w)))}a=[b,g];a=a[0];if(0==a.length)return s;g=Array(2);for(r=0;2>r;r++)b=a[r],g[r]=Math.sqrt((b[0]-f[0])*(b[0]-f[0])+(b[1]-f[1])*(b[1]-f[1])+(b[2]-f[2])*(b[2]-f[2]));f=b=r=s;g[0]<g[1]?(r=a[0],b=a[1]):(r=a[1],b=a[0]);f=Math.sqrt((r[0]-
b[0])*(r[0]-b[0])+(r[1]-b[1])*(r[1]-b[1])+(r[2]-b[2])*(r[2]-b[2]));f/=c;a=r;r=[b[0]-r[0],b[1]-r[1],b[2]-r[2]];b=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);g=[r[0]/b,r[1]/b,r[2]/b];h=d.h.ba;k=h.length;for(r=0;r<f;r+=c){a=[a[0]+c*g[0],a[1]+c*g[1],a[2]+c*g[2]];for(b=0;b<k;b+=3)if(j=h[b],l=h[b+1],n=h[b+2],w=new D.m(j,l,n),w=D.g.aa(d.ha.Q,j,l,n),Math.sqrt((a[0]-w.x)*(a[0]-w.x)+(a[1]-w.y)*(a[1]-w.y)+(a[2]-w.d)*(a[2]-w.d))<=e)return[w.x,w.y,w.d]}return s};A("X.renderer3D",nh);
A("X.renderer3D.prototype.init",nh.prototype.Aa);A("X.renderer3D.prototype.add",nh.prototype.add);A("X.renderer3D.prototype.onShowtime",nh.prototype.mh);A("X.renderer3D.prototype.onRender",nh.prototype.kh);A("X.renderer3D.prototype.get",nh.prototype.get);A("X.renderer3D.prototype.render",nh.prototype.ec);A("X.renderer3D.prototype.destroy",nh.prototype.Sa);A("X.renderer3D.prototype.remove",nh.prototype.remove);A("X.renderer3D.prototype.resetBoundingBox",nh.prototype.ak);
A("X.renderer3D.prototype.resetViewAndRender",nh.prototype.Md);A("X.renderer3D.prototype.pick",nh.prototype.Mf);A("X.renderer3D.prototype.pick3d",nh.prototype.Xj);A("X.renderer3D.prototype.afterRender",nh.prototype.zg);A("X.renderer3D.prototype.resize",nh.prototype.Na);function oh(){Y.call(this);this.f="mesh";Fa(this,new zc)}C(oh,Y);A("X.mesh",oh);function ph(){Y.call(this);this.f="fibers";Fa(this,new zc)}C(ph,Y);A("X.fibers",ph);function qh(){Pg.call(this);this.f="renderer2D";this.ta=s;this.Ea=-1;this.Qc=[];this.lg=this.dd=this.gg=this.Ud=s;this.Gb=this.Ib=this.Fb=this.Hb=0;this.ca=this.da=this.W=this.U=this.Je=-1;this.mg=new Float32Array([-255,-255,-255,-255]);this.tg=q;this.wb=1}C(qh,Pg);v=qh.prototype;v.remove=function(a){qh.z.remove.call(this,a);this.$a.remove(a);return q};v.Ij=ba();v.Sj=ba();
v.Jf=function(a){qh.z.Jf.call(this,a);var b=this.Ga[0];if(b){var c="",c=0==this.Ea?"indexX":1==this.Ea?"indexY":"indexZ";b[c]=a.V?b[c]+1:b[c]-1;eval("this.onScroll();")}};v.Tj=function(a){var b=this.Ga[0];if(b){var c=b.ca-b.da,e=c/2,d=parseInt(c+c/15*-a.cf,10);a=parseInt(e+e/15*a.Qe,10);c==d&&d++;e==a&&a++;b.da-=parseInt(e-a,10);b.da-=parseInt(c-d,10);b.da=Math.max(b.da,b.qa);b.ca-=parseInt(e-a,10);b.ca+=parseInt(c-d,10);b.ca=Math.min(b.ca,b.ga);eval("this.onWindowLevel();")}};
qh.prototype.__defineGetter__("orientation",u("ta"));qh.prototype.__defineSetter__("orientation",function(a){a=a.toUpperCase();"AXIAL"==a?(a="Z",this.Ea=2):"SAGITTAL"==a?(a="X",this.Ea=0):"CORONAL"==a&&(a="Y",this.Ea=1);"X"!=a&&("Y"!=a&&"Z"!=a)&&m(Error("Invalid orientation."));this.ta=a});qh.prototype.__defineGetter__("radiological",u("tg"));qh.prototype.__defineGetter__("normalizedScale",u("wb"));qh.prototype.__defineGetter__("canvasWidth",function(){return this.la.width});
qh.prototype.__defineGetter__("canvasHeight",function(){return this.la.height});qh.prototype.__defineGetter__("sliceWidth",u("Hb"));qh.prototype.__defineGetter__("sliceHeight",u("Fb"));qh.prototype.__defineSetter__("radiological",ca("tg"));v=qh.prototype;
v.Aa=function(){this.ta||m(Error("No 2D orientation set."));qh.z.Aa.call(this,"2d");this.a.fillStyle="rgba(50,50,50,0)";this.a.fillRect(0,0,this.la.width,this.la.height);this.Ud=he("canvas");this.dd=he("canvas");this.dd.style.El="pixelated";L(this.N,Bd,this.Tj.bind(this))};v.ue=function(){qh.z.ue.call(this);rh(this)};v.Md=function(){qh.z.Md.call(this);rh(this);var a=this.Ga[0];a&&(a.ca=a.ga,a.da=a.qa)};v.update=function(a){this.tb(a);this.Je=-1};
v.tb=function(a){qh.z.tb.call(this,a);var b=t;this.get(a.pa)&&(b=q);if(a instanceof P){var c=a.r,e=a.e,d=a.wa;if(e!=s&&e.r!=s&&e.r.j)this.tb(e);else if(d!=s&&d.r!=s&&d.r.j)this.$.load(d,a);else{if(c!=s&&ja(c))if(a.Cc!=s){if(a.Cc.xf!=c.length)return}else{b=0;e=c.length;for(b=0;b<e;b++)this.$.load(c[b],a);return}else if(c!=s&&c.j){this.$.load(a,a);return}this.Ea="X"==this.ta?0:"Y"==this.ta?1:2;this.bb=a.c[this.Ea].c;d=s;d=0==this.Ea?a.indexX:1==this.Ea?a.indexY:a.indexZ;c=a.c[this.Ea].c[d].kg;e=a.c[this.Ea].c[d].jg;
this.Ib=a.c[this.Ea].c[d].tc;this.Gb=a.c[this.Ea].c[d].kc;this.Hb=c;this.Fb=e;d=this.Ud;d.width=c;d.height=e;var f=this.dd;f.width=c;f.height=e;this.gg=d.getContext("2d");this.lg=f.getContext("2d");b||(this.$a.add(a),rh(this))}}};function rh(a){if("X"==a.ta){var b=a.Hb;a.Hb=a.Fb;a.Fb=b;b=a.Ib;a.Ib=a.Gb;a.Gb=b}var b=Math.min(a.D/(a.Hb*a.Ib),a.w/(a.Fb*a.Gb)),c=a.N.p;window.console.log(a.D+" "+a.Hb+" "+a.Ib);window.console.log(a.w+" "+a.Fb+" "+a.Gb);c[14]=b}v.Jj=ba();
v.Jh=function(a,b){var c=this.Ga[0],e=this.N.p,d=s,f=this.Hb,g=this.Fb,h=s,k=s;if("Y"==this.ta)d=this.bb[parseInt(c.indexY,10)],h=d.tc,k=d.kc,this.Qc[0]="rgba(255,255,255,.3)",this.Qc[1]="rgba(255,255,255,.3)";else if("Z"==this.ta)d=this.bb[parseInt(c.indexZ,10)],h=d.tc,k=d.kc,this.Qc[0]="rgba(255,255,255,.3)",this.Qc[1]="rgba(255,255,255,.3)";else{d=this.bb[parseInt(c.indexX,10)];h=d.kc;k=d.tc;this.Qc[0]="rgba(255,255,255,.3)";this.Qc[1]="rgba(255,255,255,.3)";var j=f,f=g,g=j}var l=1*e[12],e=-1*
e[13],j=[this.D/2,this.w/2],h=f*h*this.wb,k=g*k*this.wb,n=j[0]-h/2,j=j[1]-k/2,n=n+l*this.wb,j=j+e*this.wb;return a>n&&a<n+h&&b>j&&b<j+k?(l=(a-n)/h*f,e=(b-j)/k*g,k=d.fi[4],"X"==this.ta?(j=f-l,l=e,e=j):"Y"==this.ta?l=f-l:"Z"==this.ta&&(l=f-l,e=g-e),l=d.ei+l*d.tc,e=d.Zh+e*d.kc,l=Sc(l,e,k,1),f=Tc(),gd(d.Sh,l,f),f=[Math.floor(f[0]),Math.floor(f[1]),Math.floor(f[2])],g=Tc(),gd(d.Th,l,g),d=Math.round((c.b[0].i[0]*g[0]+c.b[0].i[1]*g[1]+c.b[0].i[2]*g[2]+c.b[0].Te)/c.b[0].Uc),d>=c.b[0].n?d=c.b[0].n-1:0>d&&
(d=0),l=Math.round((c.b[1].i[0]*g[0]+c.b[1].i[1]*g[1]+c.b[1].i[2]*g[2]+c.b[1].Te)/c.b[1].Uc),l>=c.b[1].n?l=c.b[1].n-1:0>l&&(l=0),e=Math.round((c.b[2].i[0]*g[0]+c.b[2].i[1]*g[1]+c.b[2].i[2]*g[2]+c.b[2].Te)/c.b[2].Uc),e>=c.b[2].n?e=c.b[2].n-1:0>e&&(e=0),[[d,l,e],[f[0],f[1],f[2]],[g[0],g[1],g[2]]]):s};
v.fc=function(a,b){qh.z.fc.call(this,a,b);if(0!=this.$a.K.length){var c=this.Ga[0],e=s,e=0==this.Ea?c.indexX:1==this.Ea?c.indexY:c.indexZ,d=this.bb[parseInt(e,10)].kg,f=this.bb[parseInt(e,10)].jg;this.Ib=this.bb[parseInt(e,10)].tc;this.Gb=this.bb[parseInt(e,10)].kc;this.Hb=d;this.Fb=f;var g=this.D,h=this.w,k=this.N.p;this.a.save();this.a.clearRect(-g,-h,2*g,2*h);this.a.restore();this.wb=Math.max(k[14],1E-4);this.a.setTransform(this.wb,0,0,this.wb,0,0);var j=1*k[12],k=-1*k[13],l=s;c.e&&(l=c.e.$e);
var n=this.bb[parseInt(e,10)],w=n.I.Yb,n=n.e,r=s;n&&(r=n.Yb);var x=this.Hb,z=this.Fb,E=this.gg,H=this.lg,J=E.getImageData(0,0,x,z),B=H.getImageData(0,0,x,z),F=J.data,G=B.data,M=F.length,Q=c.U,N=c.W,U=c.da,da=c.ca;if(this.Je!=e||this.U!=Q||this.W!=N||this.da!=U||this.ca!=da||l&&!zg(l,this.mg,0)){var I=this.Ud;I.width=d;I.height=f;I=this.dd;I.width=d;I.height=f;d=0;do{var I=[0,0,0,0],f=[0,0,0,0],aa=w[d]/255*(c.ga-c.qa)+c.qa,ma=da-U,S=ma/2+U,V=0,V=aa<S-ma/2?0:aa>S+ma/2?255:255*(aa-(S-ma/2))/ma;aa>=Q&&
aa<=N&&(I=new R(c.Ub[0],c.Ub[1],c.Ub[2]),I=(new R(c.Sb[0],c.Sb[1],c.Sb[2])).scale(V).add(I.scale(255-V)),I=[Math.floor(I.x),Math.floor(I.y),Math.floor(I.d),255],n&&(-255==l[3]?f=[r[d],r[d+1],r[d+2],r[d+3]]:zg(l,r,d)&&(f=[r[d],r[d+1],r[d+2],r[d+3]])));"X"==this.ta?(F[d]=I[0],F[d+1]=I[1],F[d+2]=I[2],F[d+3]=I[3],G[d]=f[0],G[d+1]=f[1],G[d+2]=f[2],G[d+3]=f[3]):"Y"==this.ta?(V=Math.floor(d/(4*x)),V=4*V*x+(4*(x-1)-(d-4*V*x)),F[V]=I[0],F[V+1]=I[1],F[V+2]=I[2],F[V+3]=I[3],G[V]=f[0],G[V+1]=f[1],G[V+2]=f[2],
G[V+3]=f[3]):(V=M-1-d,F[V-3]=I[0],F[V-2]=I[1],F[V-1]=I[2],F[V]=I[3],G[V-3]=f[0],G[V-2]=f[1],G[V-1]=f[2],G[V]=f[3]);d+=4}while(d<M);E.putImageData(J,0,0);H.putImageData(B,0,0);this.Je=e;this.U=Q;this.W=N;this.da=U;this.ca=da;n&&(this.mg=l)}this.a.globalAlpha=1;this.a.translate(g/2/this.wb,h/2/this.wb);"X"==this.ta&&(this.a.rotate(0.5*Math.PI),e=j,j=k,k=-e);j=-x*this.Ib/2+j;k=-z*this.Gb/2+k;this.a.drawImage(this.Ud,j,k,x*this.Ib,z*this.Gb);n&&c.e.O&&(this.a.globalAlpha=1,this.a.drawImage(this.dd,j,
k,x*this.Ib,z*this.Gb));if(this.S.SLICENAVIGATORS)if(this.la.style.cursor="none",this.ib.Xd&&this.ib.xg&&!this.ib.vb){if(j=this.ib.od,window.console.log(this),window.console.log(j),j=this.Jh(j[0],j[1]))c.Cb=j[0][0],c.Db=j[0][1],c.Eb=j[0][2],c.q(t),window.console.log(j),this.onSliceNavigation(),c=document.getElementById("canvasXTKPOver"),x=c.height,n=c.width,k=c.getContext("2d"),k.clearRect(0,0,c.width,c.height),window.console.log(c),k.setTransform(1,0,0,1,0,0),k.beginPath(),k.moveTo(j[0][0],0),k.lineTo(j[0][0],
j[0][1]-1),k.moveTo(j[0][0],j[0][1]+1),k.lineTo(j[0][0],c.height),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath(),k.beginPath(),k.moveTo(0,j[0][1]),k.lineTo(j[0][0]-1,j[0][1]),k.moveTo(j[0][0]+1,j[0][1]),k.lineTo(c.width,j[0][1]),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath(),c=document.getElementById("canvasXTKXOver"),k=c.getContext("2d"),z=Math.round(j[0][1]*c.width/x),x=Math.round(j[0][2]*c.height/c.getAttribute("nbslices")),x=c.height-x,k.clearRect(0,0,c.width,c.height),
window.console.log(c),k.setTransform(1,0,0,1,0,0),k.beginPath(),k.moveTo(z,0),k.lineTo(z,x-1),k.moveTo(z,x+1),k.lineTo(z,c.height),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath(),k.beginPath(),k.moveTo(0,x),k.lineTo(z-1,x),k.moveTo(z+1,x),k.lineTo(c.width,x),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath(),c=document.getElementById("canvasXTKYOver"),k=c.getContext("2d"),n=Math.round(j[0][0]*c.width/n),x=Math.round(j[0][2]*c.height/c.getAttribute("nbslices")),x=c.height-x,
k.clearRect(0,0,c.width,c.height),window.console.log(c),window.console.log(this.$a),k.setTransform(1,0,0,1,0,0),k.beginPath(),k.moveTo(n,0),k.lineTo(n,x-1),k.moveTo(n,x+1),k.lineTo(n,c.height),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath(),k.beginPath(),k.moveTo(0,x),k.lineTo(n-1,x),k.moveTo(n+1,x),k.lineTo(c.width,x),k.strokeStyle="rgba(255,255,255,1)",k.stroke(),k.closePath()}else this.la.style.cursor="default"}};A("X.renderer2D",qh);A("X.renderer2D.prototype.init",qh.prototype.Aa);
A("X.renderer2D.prototype.add",qh.prototype.add);A("X.renderer2D.prototype.onShowtime",qh.prototype.mh);A("X.renderer2D.prototype.onRender",qh.prototype.kh);A("X.renderer2D.prototype.onScroll",qh.prototype.Ij);A("X.renderer2D.prototype.onWindowLevel",qh.prototype.Sj);A("X.renderer2D.prototype.get",qh.prototype.get);A("X.renderer2D.prototype.resetViewAndRender",qh.prototype.Md);A("X.renderer2D.prototype.xy2ijk",qh.prototype.Jh);A("X.renderer2D.prototype.render",qh.prototype.ec);
A("X.renderer2D.prototype.destroy",qh.prototype.Sa);A("X.renderer2D.prototype.onSliceNavigation",qh.prototype.Jj);A("X.renderer2D.prototype.afterRender",qh.prototype.zg);A("X.renderer2D.prototype.resize",qh.prototype.Na);
